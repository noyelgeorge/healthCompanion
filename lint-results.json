[{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\server.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\components\\BottomNav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\components\\ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\components\\FoodScanner.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[367,370],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[367,370],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":107,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5201,5204],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5201,5204],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { Camera, Upload, Loader2, AlertCircle, CheckCircle2 } from 'lucide-react';\r\nimport { scanAndSearchFood } from '../services/medicine';\r\nimport { toast } from 'sonner';\r\n\r\nexport const FoodScanner: React.FC = () => {\r\n    const [isScanning, setIsScanning] = useState(false);\r\n    const [results, setResults] = useState<any>(null);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = event.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        await processFile(file);\r\n    };\r\n\r\n    const processFile = async (file: File) => {\r\n        setIsScanning(true);\r\n        setError(null);\r\n        setResults(null);\r\n\r\n        try {\r\n            const data = await scanAndSearchFood(file);\r\n            setResults(data);\r\n            if (data.medicineResults.length === 0) {\r\n                toast.info('No matching products found in FDA database.');\r\n            } else {\r\n                toast.success('Scan complete!');\r\n            }\r\n        } catch (err) {\r\n            const message = err instanceof Error ? err.message : 'Scan failed';\r\n            setError(message);\r\n            toast.error(message);\r\n        } finally {\r\n            setIsScanning(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"p-4 max-w-2xl mx-auto space-y-6\">\r\n            <div className=\"text-center space-y-2\">\r\n                <h1 className=\"text-3xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent\">\r\n                    Food & Medicine Scanner\r\n                </h1>\r\n                <p className=\"text-gray-500\">Scan packaging to reveal purpose and usage</p>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <label className=\"flex flex-col items-center justify-center h-48 border-2 border-dashed border-gray-300 rounded-2xl hover:border-blue-500 hover:bg-blue-50 transition-all cursor-pointer group\">\r\n                    <div className=\"flex flex-col items-center space-y-2\">\r\n                        <Camera className=\"w-10 h-10 text-gray-400 group-hover:text-blue-500 transition-colors\" />\r\n                        <span className=\"font-medium text-gray-600 group-hover:text-blue-600\">Take Photo</span>\r\n                    </div>\r\n                    <input\r\n                        type=\"file\"\r\n                        accept=\"image/*\"\r\n                        capture=\"environment\"\r\n                        className=\"hidden\"\r\n                        onChange={handleFileUpload}\r\n                        disabled={isScanning}\r\n                    />\r\n                </label>\r\n\r\n                <label className=\"flex flex-col items-center justify-center h-48 border-2 border-dashed border-gray-300 rounded-2xl hover:border-indigo-500 hover:bg-indigo-50 transition-all cursor-pointer group\">\r\n                    <div className=\"flex flex-col items-center space-y-2\">\r\n                        <Upload className=\"w-10 h-10 text-gray-400 group-hover:text-indigo-500 transition-colors\" />\r\n                        <span className=\"font-medium text-gray-600 group-hover:text-indigo-600\">Upload Image</span>\r\n                    </div>\r\n                    <input\r\n                        type=\"file\"\r\n                        accept=\"image/*\"\r\n                        className=\"hidden\"\r\n                        onChange={handleFileUpload}\r\n                        disabled={isScanning}\r\n                    />\r\n                </label>\r\n            </div>\r\n\r\n            {isScanning && (\r\n                <div className=\"flex flex-col items-center justify-center py-12 space-y-4\">\r\n                    <Loader2 className=\"w-12 h-12 text-blue-500 animate-spin\" />\r\n                    <p className=\"text-blue-600 font-medium animate-pulse\">Processing image with OCR...</p>\r\n                </div>\r\n            )}\r\n\r\n            {error && (\r\n                <div className=\"bg-red-50 border border-red-200 rounded-xl p-4 flex items-start gap-3\">\r\n                    <AlertCircle className=\"w-5 h-5 text-red-500 shrink-0\" />\r\n                    <p className=\"text-red-700 text-sm font-medium\">{error}</p>\r\n                </div>\r\n            )}\r\n\r\n            {results && (\r\n                <div className=\"space-y-4 animate-in fade-in slide-in-from-bottom-4 duration-500\">\r\n                    <div className=\"bg-white rounded-2xl p-4 shadow-sm border border-gray-100 italic text-gray-600 text-sm\">\r\n                        <h3 className=\"font-semibold text-gray-900 not-italic mb-1\">Scanned Text:</h3>\r\n                        \"{results.scannedText.substring(0, 200)}{results.scannedText.length > 200 ? '...' : ''}\"\r\n                    </div>\r\n\r\n                    <div className=\"space-y-3\">\r\n                        <h2 className=\"text-xl font-bold flex items-center gap-2\">\r\n                            <CheckCircle2 className=\"w-6 h-6 text-green-500\" />\r\n                            Found {results.medicineResults.length} Matches\r\n                        </h2>\r\n\r\n                        {results.medicineResults.map((item: any, idx: number) => (\r\n                            <div key={idx} className=\"bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-shadow\">\r\n                                <h3 className=\"text-lg font-bold text-blue-700 border-b pb-2 mb-3\">\r\n                                    {item.name}\r\n                                </h3>\r\n                                <div className=\"space-y-3\">\r\n                                    <div>\r\n                                        <span className=\"text-xs font-bold uppercase tracking-wider text-gray-400 block mb-1\">Purpose</span>\r\n                                        <p className=\"text-gray-700 text-sm leading-relaxed\">{item.purpose}</p>\r\n                                    </div>\r\n                                    {item.usage && (\r\n                                        <div>\r\n                                            <span className=\"text-xs font-bold uppercase tracking-wider text-gray-400 block mb-1\">Usage / Dosage</span>\r\n                                            <p className=\"text-gray-700 text-sm leading-relaxed\">{item.usage}</p>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\components\\Layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\components\\NotificationManager.tsx","messages":[{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":79,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":79,"endColumn":24,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3543,3544],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":82,"column":21,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":82,"endColumn":34,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[3676,3689],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":84,"column":25,"nodeType":"BlockStatement","messageId":"unexpected","endLine":84,"endColumn":28,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3771,3772],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { useEffect, useRef } from 'react'\r\nimport { useAppStore } from '../store/useAppStore'\r\nimport { toast } from 'sonner'\r\n\r\nexport default function NotificationManager() {\r\n    const reminders = useAppStore(state => state.reminders || [])\r\n\r\n    useEffect(() => {\r\n        if (!(\"Notification\" in window)) {\r\n            return;\r\n        }\r\n\r\n        if (Notification.permission === \"default\") {\r\n            Notification.requestPermission();\r\n        }\r\n    }, []);\r\n\r\n    const notifiedRef = useRef<Set<string>>(new Set());\r\n\r\n    useEffect(() => {\r\n        const supportsTriggers = typeof Notification !== 'undefined' && 'showTrigger' in Notification.prototype && 'serviceWorker' in navigator;\r\n\r\n        if (supportsTriggers) {\r\n            (async () => {\r\n                try {\r\n                    const reg = await navigator.serviceWorker.getRegistration();\r\n                    if (!reg) return;\r\n                    type TimestampTriggerCtor = new (timestamp: number) => object;\r\n                    const Trigger = (window as unknown as { TimestampTrigger?: TimestampTriggerCtor }).TimestampTrigger;\r\n                    if (!Trigger) return;\r\n                    const now = new Date();\r\n                    const todayKey = `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}`;\r\n\r\n                    for (const reminder of reminders) {\r\n                        if (!reminder.enabled) continue;\r\n                        const [h, m] = reminder.time.split(':').map(Number);\r\n\r\n                        const nextTime = new Date();\r\n                        nextTime.setHours(h, m, 0, 0);\r\n                        if (nextTime.getTime() < Date.now() - 5 * 60 * 1000) {\r\n                            nextTime.setDate(nextTime.getDate() + 1);\r\n                        }\r\n\r\n                        const preTime = new Date(nextTime.getTime() - 15 * 60 * 1000);\r\n\r\n                        const tagPre = `med-pre-${reminder.id}-${todayKey}`;\r\n                        const tagNow = `med-now-${reminder.id}-${todayKey}`;\r\n\r\n                        const preOptions: Record<string, unknown> = {\r\n                            body: `Take at ${reminder.time}.`,\r\n                            icon: '/pwa-192x192.png',\r\n                            tag: tagPre,\r\n                            showTrigger: new Trigger(preTime.getTime())\r\n                        };\r\n                        await reg.showNotification(`Upcoming Medicine: ${reminder.medicineName}`, preOptions as NotificationOptions);\r\n\r\n                        const nowOptions: Record<string, unknown> = {\r\n                            body: `It is ${reminder.time}.`,\r\n                            icon: '/pwa-192x192.png',\r\n                            tag: tagNow,\r\n                            showTrigger: new Trigger(nextTime.getTime())\r\n                        };\r\n                        await reg.showNotification(`TIME TO TAKE: ${reminder.medicineName}`, nowOptions as NotificationOptions);\r\n                    }\r\n                } catch (e) {\r\n                    console.error('Scheduled notification setup failed', e);\r\n                }\r\n            })();\r\n        }\r\n\r\n        const send = async (title: string, options: NotificationOptions) => {\r\n            try {\r\n                const reg = await navigator.serviceWorker.getRegistration();\r\n                if (reg) {\r\n                    await reg.showNotification(title, options);\r\n                    return;\r\n                }\r\n            } catch { }\r\n            if (\"Notification\" in window && Notification.permission === \"granted\") {\r\n                try {\r\n                    // @ts-ignore\r\n                    new Notification(title, options);\r\n                } catch { }\r\n            }\r\n        };\r\n\r\n        const checkReminders = () => {\r\n            const now = new Date();\r\n            const currentHours = now.getHours();\r\n            const currentMinutes = now.getMinutes();\r\n            const currentTimeInMinutes = currentHours * 60 + currentMinutes;\r\n            const dateKey = now.getDate();\r\n\r\n            reminders.forEach(reminder => {\r\n                if (!reminder.enabled) return;\r\n\r\n                const [rHours, rMinutes] = reminder.time.split(':').map(Number);\r\n                const reminderTimeInMinutes = rHours * 60 + rMinutes;\r\n                const diffMinutes = reminderTimeInMinutes - currentTimeInMinutes;\r\n\r\n                if (diffMinutes > 0 && diffMinutes <= 15) {\r\n                    const tag = `med-pre-${reminder.id}-${dateKey}`;\r\n                    if (!notifiedRef.current.has(tag)) {\r\n                        void send(`Upcoming Medicine: ${reminder.medicineName}`, {\r\n                            body: `Take in ${diffMinutes} mins (at ${reminder.time}).`,\r\n                            icon: '/pwa-192x192.png',\r\n                            tag: tag\r\n                        });\r\n                        toast.info(`Upcoming: ${reminder.medicineName}`, {\r\n                            description: `Take in ${diffMinutes} mins (at ${reminder.time})`\r\n                        });\r\n                        notifiedRef.current.add(tag);\r\n                    }\r\n                }\r\n\r\n                if (diffMinutes <= 0 && diffMinutes >= -5) {\r\n                    const tag = `med-now-${reminder.id}-${dateKey}`;\r\n                    if (!notifiedRef.current.has(tag)) {\r\n                        void send(`TIME TO TAKE: ${reminder.medicineName}`, {\r\n                            body: `It is ${reminder.time}.`,\r\n                            icon: '/pwa-192x192.png',\r\n                            tag: tag\r\n                        });\r\n                        toast.success(`TIME TO TAKE: ${reminder.medicineName}`, {\r\n                            description: `It is time!`,\r\n                            duration: 10000\r\n                        });\r\n                        notifiedRef.current.add(tag);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        const intervalId = setInterval(checkReminders, 10 * 1000);\r\n        checkReminders();\r\n\r\n        return () => clearInterval(intervalId);\r\n    }, [reminders]);\r\n\r\n    return null;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\components\\ShareCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\components\\home\\BMIGauge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\components\\home\\MacroProgress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\components\\home\\MotivationHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\components\\home\\StreakCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\components\\log\\AddFoodForm.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nD:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\components\\log\\AddFoodForm.tsx:35:13\n  33 |     useEffect(() => {\n  34 |         if (initialValues) {\n> 35 |             setName(initialValues.name || \"\")\n     |             ^^^^^^^ Avoid calling setState() directly within an effect\n  36 |             setCalories(initialValues.calories !== undefined ? initialValues.calories.toString() : \"\")\n  37 |             setProtein(initialValues.protein !== undefined ? initialValues.protein.toString() : \"\")\n  38 |             setCarbs(initialValues.carbs !== undefined ? initialValues.carbs.toString() : \"\")","line":35,"column":13,"nodeType":null,"endLine":35,"endColumn":20},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadRecipeBook'. Either include it or remove the dependency array.","line":55,"column":8,"nodeType":"ArrayExpression","endLine":55,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [loadRecipeBook, mode]","fix":{"range":[2346,2352],"text":"[loadRecipeBook, mode]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3740,3743],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3740,3743],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { useState, useEffect } from \"react\"\r\nimport { Button } from \"../ui/Button\"\r\nimport { Card } from \"../ui/Card\"\r\nimport { useAppStore, type MealEntry } from \"../../store/useAppStore\"\r\n\r\nimport { X, Check, BookOpen, PenTool, Brain } from \"lucide-react\"\r\nimport { cn } from \"../../lib/utils\"\r\n\r\ninterface AddFoodFormProps {\r\n    mealType: MealEntry['mealType']\r\n    initialValues?: Partial<MealEntry>\r\n    onClose: () => void\r\n    onSubmit: (entry: Omit<MealEntry, 'id' | 'timestamp'> & { id?: string }) => void\r\n}\r\n\r\nexport function AddFoodForm({ mealType, initialValues, onClose, onSubmit }: AddFoodFormProps) {\r\n    const [mode, setMode] = useState<'manual' | 'recipe'>('manual')\r\n\r\n    // REAL STORE CONNECTION (Safe Selectors)\r\n    const recipeBook = useAppStore(state => state.recipeBook || [])\r\n    const loadRecipeBook = useAppStore(state => state.loadRecipeBook)\r\n\r\n\r\n    const [name, setName] = useState(initialValues?.name || \"\")\r\n    const [calories, setCalories] = useState(initialValues?.calories?.toString() || \"\")\r\n    const [protein, setProtein] = useState(initialValues?.protein?.toString() || \"\")\r\n    const [carbs, setCarbs] = useState(initialValues?.carbs?.toString() || \"\")\r\n    const [fat, setFat] = useState(initialValues?.fat?.toString() || \"\")\r\n    const [ingredientsStr, setIngredientsStr] = useState(initialValues?.ingredients?.join(', ') || \"\")\r\n    const [errors, setErrors] = useState<Record<string, string>>({})\r\n\r\n    useEffect(() => {\r\n        if (initialValues) {\r\n            setName(initialValues.name || \"\")\r\n            setCalories(initialValues.calories !== undefined ? initialValues.calories.toString() : \"\")\r\n            setProtein(initialValues.protein !== undefined ? initialValues.protein.toString() : \"\")\r\n            setCarbs(initialValues.carbs !== undefined ? initialValues.carbs.toString() : \"\")\r\n            setFat(initialValues.fat !== undefined ? initialValues.fat.toString() : \"\")\r\n            setIngredientsStr(initialValues.ingredients?.join(', ') || \"\")\r\n        } else {\r\n            setName(\"\")\r\n            setCalories(\"\")\r\n            setProtein(\"\")\r\n            setCarbs(\"\")\r\n            setFat(\"\")\r\n            setIngredientsStr(\"\")\r\n        }\r\n    }, [initialValues])\r\n\r\n    useEffect(() => {\r\n        if (mode === 'recipe') {\r\n            loadRecipeBook()\r\n        }\r\n    }, [mode])\r\n\r\n    const validate = () => {\r\n        const newErrors: Record<string, string> = {}\r\n        if (!name.trim()) newErrors.name = \"Name is required\"\r\n\r\n        const cals = Number(calories)\r\n        if (!calories || isNaN(cals) || cals <= 0) newErrors.calories = \"Must be > 0\"\r\n\r\n        const p = Number(protein)\r\n        if (protein && (isNaN(p) || p < 0)) newErrors.protein = \"Invalid\"\r\n\r\n        const c = Number(carbs)\r\n        if (carbs && (isNaN(c) || c < 0)) newErrors.carbs = \"Invalid\"\r\n\r\n        const f = Number(fat)\r\n        if (fat && (isNaN(f) || f < 0)) newErrors.fat = \"Invalid\"\r\n\r\n        setErrors(newErrors)\r\n        return Object.keys(newErrors).length === 0\r\n    }\r\n\r\n    const handleSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault()\r\n        if (!validate()) return\r\n\r\n        onSubmit({\r\n            id: (initialValues as MealEntry)?.id,\r\n            mealType,\r\n            name: name.trim(),\r\n            calories: Number(calories),\r\n            protein: Number(protein) || 0,\r\n            carbs: Number(carbs) || 0,\r\n            fat: Number(fat) || 0,\r\n            healthScore: initialValues?.healthScore,\r\n            reasoning: initialValues?.reasoning,\r\n            ingredients: ingredientsStr ? ingredientsStr.split(',').map(s => s.trim()).filter(Boolean) : []\r\n        })\r\n\r\n        onClose()\r\n    }\r\n\r\n    const handleRecipeSelect = (recipe: any) => {\r\n        onSubmit({\r\n            mealType,\r\n            name: recipe.name,\r\n            calories: recipe.calories,\r\n            protein: recipe.protein,\r\n            carbs: recipe.carbs,\r\n            fat: recipe.fat,\r\n            ingredients: recipe.ingredients || []\r\n        })\r\n        onClose()\r\n    }\r\n\r\n    return (\r\n        <Card className=\"dark:bg-slate-900 border-none\">\r\n            <div className=\"flex justify-between items-center mb-4\">\r\n                <h3 className=\"font-semibold text-lg text-slate-800 dark:text-white\">\r\n                    {(initialValues as MealEntry)?.id ? `Edit ${mealType}` : `Add ${mealType.charAt(0).toUpperCase() + mealType.slice(1)}`}\r\n                </h3>\r\n                <button onClick={onClose} className=\"text-slate-400 dark:text-slate-500 hover:text-slate-600 dark:hover:text-slate-300\">\r\n                    <X size={20} />\r\n                </button>\r\n            </div>\r\n\r\n            {/* Mode Tabs */}\r\n            <div className=\"flex bg-slate-100 dark:bg-slate-800 p-1 rounded-xl mb-4\">\r\n                <button\r\n                    type=\"button\"\r\n                    onClick={() => setMode('manual')}\r\n                    className={cn(\r\n                        \"flex-1 py-1.5 px-3 rounded-lg text-sm font-medium transition-all flex items-center justify-center gap-2\",\r\n                        mode === 'manual' ? \"bg-white dark:bg-slate-700 text-slate-800 dark:text-white shadow-sm\" : \"text-slate-500 hover:text-slate-700 dark:text-slate-400\"\r\n                    )}\r\n                >\r\n                    <PenTool size={14} />\r\n                    Manual\r\n                </button>\r\n                <button\r\n                    type=\"button\"\r\n                    onClick={() => setMode('recipe')}\r\n                    className={cn(\r\n                        \"flex-1 py-1.5 px-3 rounded-lg text-sm font-medium transition-all flex items-center justify-center gap-2\",\r\n                        mode === 'recipe' ? \"bg-white dark:bg-slate-700 text-slate-800 dark:text-white shadow-sm\" : \"text-slate-500 hover:text-slate-700 dark:text-slate-400\"\r\n                    )}\r\n                >\r\n                    <BookOpen size={14} />\r\n                    Recipe Book\r\n                </button>\r\n            </div>\r\n\r\n\r\n            {mode === 'manual' ? (\r\n                <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">\r\n                            Food Name\r\n                        </label>\r\n                        <input\r\n                            value={name} onChange={e => setName(e.target.value)}\r\n                            className={cn(\r\n                                \"w-full p-3 rounded-xl border focus:outline-none focus:ring-2 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white\",\r\n                                errors.name ? \"border-rose-500 focus:ring-rose-500/20\" : \"border-slate-200 dark:border-slate-700 focus:ring-blue-500\"\r\n                            )}\r\n                            placeholder=\"e.g. Avocado Toast\"\r\n                            autoFocus\r\n                        />\r\n                        {errors.name && <span className=\"text-[10px] text-rose-500 mt-1 ml-1 font-bold italic\">{errors.name}</span>}\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">Calories</label>\r\n                            <input\r\n                                type=\"number\"\r\n                                value={calories} onChange={e => setCalories(e.target.value)}\r\n                                className={cn(\r\n                                    \"w-full p-3 rounded-xl border focus:outline-none focus:ring-2 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white\",\r\n                                    errors.calories ? \"border-rose-500 focus:ring-rose-500/20\" : \"border-slate-200 dark:border-slate-700 focus:ring-blue-500\"\r\n                                )}\r\n                                placeholder=\"0\"\r\n                            />\r\n                            {errors.calories && <span className=\"text-[10px] text-rose-500 mt-1 ml-1 font-bold italic\">{errors.calories}</span>}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">\r\n                            Ingredients\r\n                        </label>\r\n                        <textarea\r\n                            value={ingredientsStr}\r\n                            onChange={e => setIngredientsStr(e.target.value)}\r\n                            className=\"w-full p-3 rounded-xl border border-slate-200 dark:border-slate-700 focus:outline-none focus:ring-2 focus:ring-blue-500 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white min-h-[80px]\"\r\n                            placeholder=\"e.g. 2 eggs, 1tsp salt, spinach...\"\r\n                        />\r\n                        <p className=\"text-[10px] text-slate-400 mt-1 ml-1 font-medium\">Separate items with commas</p>\r\n                    </div>\r\n\r\n                    {/* AI Insight Section */}\r\n                    {initialValues?.healthScore && (\r\n                        <div className=\"glass p-4 rounded-2xl border-indigo-100 dark:border-indigo-900/30 bg-indigo-50/30 dark:bg-indigo-950/20\">\r\n                            <div className=\"flex items-center gap-3 mb-2\">\r\n                                <div className={cn(\r\n                                    \"w-10 h-10 rounded-xl flex items-center justify-center font-black text-lg shadow-sm ring-2 relative\",\r\n                                    initialValues.healthScore >= 8 ? \"bg-emerald-500 text-white ring-emerald-200\" :\r\n                                        initialValues.healthScore >= 5 ? \"bg-amber-500 text-white ring-amber-200\" :\r\n                                            \"bg-rose-500 text-white ring-rose-200\"\r\n                                )}>\r\n                                    <Brain size={12} className=\"absolute -top-1 -right-1 text-white/40\" />\r\n                                    {initialValues.healthScore}\r\n                                </div>\r\n                                <div>\r\n                                    <div className=\"text-[10px] font-black uppercase tracking-widest text-indigo-500 dark:text-indigo-400\">Health Score</div>\r\n                                    <div className=\"text-xs font-bold text-slate-800 dark:text-slate-200\">AI Analysis</div>\r\n                                </div>\r\n                            </div>\r\n                            <p className=\"text-[11px] text-slate-500 dark:text-slate-400 italic font-medium leading-relaxed\">\r\n                                \"{initialValues.reasoning}\"\r\n                            </p>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"grid grid-cols-3 gap-3\">\r\n                        <div>\r\n                            <label className=\"block text-xs font-medium text-slate-500 dark:text-slate-400 mb-1\">Protein (g)</label>\r\n                            <input type=\"number\" value={protein} onChange={e => setProtein(e.target.value)}\r\n                                className={cn(\r\n                                    \"w-full p-2 rounded-lg border bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white text-sm\",\r\n                                    errors.protein ? \"border-rose-500\" : \"border-slate-200 dark:border-slate-700\"\r\n                                )}\r\n                                placeholder=\"0\"\r\n                            />\r\n                            {errors.protein && <div className=\"text-[8px] text-rose-500 mt-1 font-bold\">{errors.protein}</div>}\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-xs font-medium text-slate-500 dark:text-slate-400 mb-1\">Carbs (g)</label>\r\n                            <input type=\"number\" value={carbs} onChange={e => setCarbs(e.target.value)}\r\n                                className={cn(\r\n                                    \"w-full p-2 rounded-lg border bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white text-sm\",\r\n                                    errors.carbs ? \"border-rose-500\" : \"border-slate-200 dark:border-slate-700\"\r\n                                )}\r\n                                placeholder=\"0\"\r\n                            />\r\n                            {errors.carbs && <div className=\"text-[8px] text-rose-500 mt-1 font-bold\">{errors.carbs}</div>}\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-xs font-medium text-slate-500 dark:text-slate-400 mb-1\">Fat (g)</label>\r\n                            <input type=\"number\" value={fat} onChange={e => setFat(e.target.value)}\r\n                                className={cn(\r\n                                    \"w-full p-2 rounded-lg border bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white text-sm\",\r\n                                    errors.fat ? \"border-rose-500\" : \"border-slate-200 dark:border-slate-700\"\r\n                                )}\r\n                                placeholder=\"0\"\r\n                            />\r\n                            {errors.fat && <div className=\"text-[8px] text-rose-500 mt-1 font-bold\">{errors.fat}</div>}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <Button\r\n                        type=\"submit\"\r\n                        fullWidth\r\n                        variant=\"outline\"\r\n                        className={cn(\r\n                            \"mt-2 transition-all active:scale-[0.98]\",\r\n                            \"bg-white dark:bg-slate-800 text-black dark:text-white hover:text-orange-500 hover:border-orange-500 dark:hover:text-orange-400 dark:hover:border-orange-500 font-black uppercase tracking-widest text-xs\"\r\n                        )}\r\n                    >\r\n                        <Check size={18} className=\"mr-2\" />\r\n                        {(initialValues as MealEntry)?.id ? \"Confirm & Update\" : \"Confirm & Add\"}\r\n                    </Button>\r\n                </form>\r\n            ) : (\r\n                <div className=\"space-y-3 max-h-[300px] overflow-y-auto\">\r\n                    {recipeBook.length === 0 ? (\r\n                        <div className=\"text-center py-8 text-slate-400\">\r\n                            <BookOpen size={24} className=\"mx-auto mb-2 opacity-50\" />\r\n                            <p className=\"text-sm\">No saved recipes yet</p>\r\n                        </div>\r\n                    ) : (\r\n                        recipeBook.map(recipe => (\r\n                            <div\r\n                                key={recipe.id}\r\n                                onClick={() => handleRecipeSelect(recipe)}\r\n                                className=\"p-3 bg-slate-50 dark:bg-slate-800 rounded-xl flex justify-between items-center cursor-pointer hover:bg-orange-50 dark:hover:bg-slate-700 transition-colors group\"\r\n                            >\r\n                                <div>\r\n                                    <div className=\"font-semibold text-slate-800 dark:text-white text-sm group-hover:text-orange-600 dark:group-hover:text-orange-400\">{recipe.name}</div>\r\n                                    <div className=\"text-xs text-slate-500 dark:text-slate-400 mt-1 flex items-center gap-2\">\r\n                                        <span>P: {recipe.protein}g • C: {recipe.carbs}g • F: {recipe.fat}g</span>\r\n                                        {recipe.healthScore && (\r\n                                            <span className={cn(\r\n                                                \"px-1.5 py-0.5 rounded-md text-[8px] font-black text-white\",\r\n                                                recipe.healthScore >= 8 ? \"bg-emerald-500\" :\r\n                                                    recipe.healthScore >= 5 ? \"bg-amber-500\" :\r\n                                                        \"bg-rose-500\"\r\n                                            )}>\r\n                                                {recipe.healthScore}/10\r\n                                            </span>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"font-bold text-slate-700 dark:text-gray-200 text-sm\">\r\n                                    {recipe.calories} Cal\r\n                                </div>\r\n                            </div>\r\n                        ))\r\n                    )}\r\n                </div>\r\n            )}\r\n        </Card>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\components\\log\\CameraCapture.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'startCamera'. Either include it or remove the dependency array.","line":45,"column":8,"nodeType":"ArrayExpression","endLine":45,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [startCamera]","fix":{"range":[1313,1315],"text":"[startCamera]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1893,1896],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1893,1896],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useRef, useEffect, useState } from \"react\";\r\nimport { Camera, X, RefreshCw } from \"lucide-react\";\r\nimport { Button } from \"../ui/Button\";\r\n\r\ninterface CameraCaptureProps {\r\n    onCapture: (file: File) => void;\r\n    onClose: () => void;\r\n    label?: string;\r\n}\r\n\r\nexport function CameraCapture({ onCapture, onClose, label }: CameraCaptureProps) {\r\n    const videoRef = useRef<HTMLVideoElement>(null);\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n    const [stream, setStream] = useState<MediaStream | null>(null);\r\n    const streamRef = useRef<MediaStream | null>(null);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [isStarting, setIsStarting] = useState(true);\r\n\r\n    const stopCamera = () => {\r\n        if (streamRef.current) {\r\n            streamRef.current.getTracks().forEach(track => {\r\n                track.stop();\r\n            });\r\n            streamRef.current = null;\r\n        }\r\n        setStream(null);\r\n    };\r\n\r\n    useEffect(() => {\r\n        let isMounted = true;\r\n\r\n        const init = async () => {\r\n            await startCamera();\r\n            if (!isMounted) {\r\n                stopCamera();\r\n            }\r\n        };\r\n\r\n        init();\r\n\r\n        return () => {\r\n            isMounted = false;\r\n            stopCamera();\r\n        };\r\n    }, []);\r\n\r\n    const startCamera = async () => {\r\n        stopCamera(); // Stop any existing streams before starting\r\n        setIsStarting(true);\r\n        setError(null);\r\n        try {\r\n            const mediaStream = await navigator.mediaDevices.getUserMedia({\r\n                video: { facingMode: \"environment\" },\r\n                audio: false\r\n            });\r\n            setStream(mediaStream);\r\n            streamRef.current = mediaStream;\r\n            if (videoRef.current) {\r\n                videoRef.current.srcObject = mediaStream;\r\n            }\r\n        } catch (err: any) {\r\n            console.error(\"Error accessing camera:\", err);\r\n            setError(err.name === \"NotAllowedError\"\r\n                ? \"Camera permission denied. Please enable it in your browser settings.\"\r\n                : \"Could not access camera. Please check your device.\");\r\n        } finally {\r\n            setIsStarting(false);\r\n        }\r\n    };\r\n\r\n    const capturePhoto = () => {\r\n        if (videoRef.current && canvasRef.current) {\r\n            const video = videoRef.current;\r\n            const canvas = canvasRef.current;\r\n            const context = canvas.getContext(\"2d\");\r\n\r\n            if (context) {\r\n                // Set canvas dimensions to match video\r\n                canvas.width = video.videoWidth;\r\n                canvas.height = video.videoHeight;\r\n\r\n                // Draw current frame to canvas\r\n                context.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n\r\n                // Convert canvas to blob then file\r\n                canvas.toBlob((blob) => {\r\n                    if (blob) {\r\n                        const file = new File([blob], \"camera-capture.jpg\", { type: \"image/jpeg\" });\r\n                        onCapture(file);\r\n                    }\r\n                }, \"image/jpeg\", 0.8);\r\n            }\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-slate-900/90 backdrop-blur-md z-[110] flex flex-col items-center justify-center p-4\">\r\n            <div className=\"w-full max-w-lg bg-black rounded-3xl overflow-hidden shadow-2xl relative\">\r\n                {/* Header */}\r\n                <div className=\"absolute top-4 left-4 right-4 z-20 flex justify-between items-center\">\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"p-2 bg-white/20 hover:bg-white/30 backdrop-blur-md rounded-full text-white transition-colors\"\r\n                    >\r\n                        <X size={24} />\r\n                    </button>\r\n                    <div className=\"px-3 py-1 bg-white/20 backdrop-blur-md rounded-full text-white text-xs font-medium uppercase tracking-widest\">\r\n                        Live Scanner\r\n                    </div>\r\n                    <div className=\"w-10\"></div> {/* Spacer */}\r\n                </div>\r\n\r\n                {/* Video Preview */}\r\n                <div className=\"aspect-[3/4] sm:aspect-video bg-slate-800 flex items-center justify-center relative\">\r\n                    {isStarting && (\r\n                        <div className=\"flex flex-col items-center gap-3 text-white/60\">\r\n                            <RefreshCw size={32} className=\"animate-spin\" />\r\n                            <span className=\"text-sm font-medium\">Starting camera...</span>\r\n                        </div>\r\n                    )}\r\n\r\n                    {error && (\r\n                        <div className=\"p-8 text-center\">\r\n                            <p className=\"text-white font-medium mb-4\">{error}</p>\r\n                            <Button variant=\"outline\" onClick={startCamera} className=\"bg-white/10 border-white/20 text-white hover:bg-white/20\">\r\n                                Try Again\r\n                            </Button>\r\n                        </div>\r\n                    )}\r\n\r\n                    <video\r\n                        ref={videoRef}\r\n                        autoPlay\r\n                        playsInline\r\n                        muted\r\n                        className={`w-full h-full object-cover ${stream ? 'block' : 'hidden'}`}\r\n                    />\r\n\r\n                    {/* Scan Overlay Overlay */}\r\n                    <div className=\"absolute inset-0 border-[40px] border-black/20 pointer-events-none\">\r\n                        <div className=\"w-full h-full border-2 border-white/20 rounded-xl\"></div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Footer Controls */}\r\n                <div className=\"p-8 pb-10 flex flex-col items-center gap-6 bg-zinc-900\">\r\n                    <p className=\"text-white/60 text-xs text-center max-w-[240px] font-medium leading-relaxed\">\r\n                        {label || \"Position your meal in the center of the frame and tap the capture button.\"}\r\n                    </p>\r\n\r\n                    <button\r\n                        onClick={capturePhoto}\r\n                        disabled={!stream}\r\n                        className=\"w-20 h-20 rounded-full border-4 border-white/30 p-1 active:scale-90 transition-transform disabled:opacity-50\"\r\n                    >\r\n                        <div className=\"w-full h-full rounded-full bg-white flex items-center justify-center\">\r\n                            <Camera size={32} className=\"text-black\" />\r\n                        </div>\r\n                    </button>\r\n                </div>\r\n\r\n                <canvas ref={canvasRef} className=\"hidden\" />\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\components\\plans\\WeeklyCalendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\components\\social\\CreatePostModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\components\\social\\Feed.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\components\\social\\PostCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":81,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":81,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":101,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":101,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":117,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":117,"endColumn":23}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\"\r\nimport { type Post, toggleLikePost, deletePost } from \"../../services/social\"\r\nimport { useAppStore } from \"../../store/useAppStore\"\r\nimport {\r\n    Heart,\r\n    Trash2,\r\n    BookOpen,\r\n    Package,\r\n    Loader2,\r\n    ChefHat,\r\n    Pencil,\r\n    Flame,\r\n    Droplets,\r\n    Wheat,\r\n    Cookie,\r\n    Brain\r\n} from \"lucide-react\"\r\nimport { toast } from \"sonner\"\r\nimport { cn } from \"../../lib/utils\"\r\n\r\ninterface PostCardProps {\r\n    post: Post\r\n    onDelete?: () => void\r\n    onEdit?: (post: Post) => void\r\n}\r\n\r\nexport function PostCard({ post, onDelete, onEdit }: PostCardProps) {\r\n    const user = useAppStore(state => state.user)\r\n    const recipeBook = useAppStore(state => state.recipeBook)\r\n    const addToRecipeBook = useAppStore(state => state.addToRecipeBook)\r\n    const removeFromRecipeBook = useAppStore(state => state.removeFromRecipeBook)\r\n\r\n    // Check if already saved\r\n    const savedItem = recipeBook.find(item => item.originalPostId === post.id)\r\n    const isSaved = !!savedItem\r\n\r\n    const isOwner = user.uid === post.authorId || user.email === post.authorId\r\n\r\n    const [isSaving, setIsSaving] = useState(false)\r\n    const [isDeleting, setIsDeleting] = useState(false)\r\n    const [isLiked, setIsLiked] = useState(\r\n        (user.uid && post.likedBy?.includes(user.uid)) ||\r\n        post.likedBy?.includes(user.email) ||\r\n        false\r\n    )\r\n    const [likeCount, setLikeCount] = useState(post.likes)\r\n    const [isExpanded, setIsExpanded] = useState(false)\r\n\r\n    const handleSaveToggle = async () => {\r\n        if (!user.isAuthenticated) {\r\n            toast.error(\"Please login to save recipes\")\r\n            return\r\n        }\r\n\r\n        setIsSaving(true)\r\n        try {\r\n            if (isSaved) {\r\n                // Unsave\r\n                if (savedItem) {\r\n                    await removeFromRecipeBook(savedItem.id)\r\n                    toast.success(\"Removed\", { description: \"Removed from your saved items.\" })\r\n                }\r\n            } else {\r\n                // Save\r\n                await addToRecipeBook({\r\n                    originalPostId: post.id,\r\n                    name: post.title,\r\n                    calories: post.calories,\r\n                    protein: post.macros.protein,\r\n                    carbs: post.macros.carbs,\r\n                    fat: post.macros.fat,\r\n                    healthScore: post.healthScore,\r\n                    reasoning: post.reasoning,\r\n                    ingredients: post.ingredients || [],\r\n                    source: \"community\"\r\n                });\r\n                toast.success(\"Saved!\", {\r\n                    description: `${post.title} has been saved.`\r\n                })\r\n            }\r\n        } catch (error) {\r\n            toast.error(isSaved ? \"Failed to remove\" : \"Failed to save\")\r\n        } finally {\r\n            setIsSaving(false)\r\n        }\r\n    }\r\n\r\n    const handleLikeToggle = async () => {\r\n        if (!user.isAuthenticated) {\r\n            toast.error(\"Please login to like posts\")\r\n            return\r\n        }\r\n\r\n        // Optimistic update\r\n        const newIsLiked = !isLiked\r\n        setIsLiked(newIsLiked)\r\n        setLikeCount((prev: number) => newIsLiked ? prev + 1 : prev - 1)\r\n\r\n        try {\r\n            await toggleLikePost(post.id, user.uid || user.email, !newIsLiked)\r\n        } catch (error) {\r\n            // Revert on error\r\n            setIsLiked(!newIsLiked)\r\n            setLikeCount((prev: number) => !newIsLiked ? prev + 1 : prev - 1)\r\n            toast.error(\"Failed to update like\")\r\n        }\r\n    }\r\n\r\n    const handleDelete = async () => {\r\n        if (!window.confirm(\"Are you sure you want to delete this post?\")) return\r\n\r\n        setIsDeleting(true)\r\n        try {\r\n            await deletePost(post.id)\r\n            toast.success(\"Post deleted\")\r\n            onDelete?.()\r\n        } catch (error) {\r\n            toast.error(\"Failed to delete post\")\r\n        } finally {\r\n            setIsDeleting(false)\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"group relative\">\r\n            {/* Glow effect on hover */}\r\n            <div className=\"absolute -inset-0.5 bg-gradient-to-r from-orange-500 to-indigo-500 rounded-[2.5rem] opacity-0 group-hover:opacity-20 blur-xl transition duration-700\"></div>\r\n\r\n            <div className=\"relative overflow-hidden rounded-[2.5rem] glass dark:glass-dark border-white/40 dark:border-slate-800/50 shadow-2xl hover:shadow-orange-500/10 transition-all duration-500 hover:-translate-y-1.5 flex flex-col\">\r\n                {/* Header */}\r\n                <div className=\"px-6 pt-6 pb-4 flex items-center gap-4 relative z-10\">\r\n                    <div className=\"relative\">\r\n                        <div className=\"w-14 h-14 rounded-2xl bg-gradient-to-br from-orange-400 via-orange-500 to-rose-600 flex items-center justify-center text-white font-black text-xl shadow-xl shadow-orange-500/20 ring-4 ring-white dark:ring-slate-900 group-hover:scale-105 transition-transform duration-500\">\r\n                            {post.authorName.charAt(0).toUpperCase()}\r\n                        </div>\r\n                        <div className=\"absolute -bottom-1 -right-1 w-6 h-6 bg-white dark:bg-slate-900 rounded-full border-2 border-orange-500 flex items-center justify-center shadow-lg\">\r\n                            <ChefHat size={12} className=\"text-orange-600\" />\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex-1\">\r\n                        <div className=\"font-black text-slate-800 dark:text-white text-lg tracking-tight\">{post.authorName}</div>\r\n                        <p className=\"text-[10px] text-slate-400 dark:text-slate-500 font-bold uppercase tracking-widest flex items-center gap-1.5\">\r\n                            <span className=\"w-1 h-1 rounded-full bg-orange-500 animate-pulse\"></span>\r\n                            Shared Recipe\r\n                        </p>\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center gap-2\">\r\n                        {post.healthScore && (\r\n                            <div className={cn(\r\n                                \"h-10 px-3 rounded-2xl flex items-center gap-2 ring-1 shadow-lg\",\r\n                                post.healthScore >= 8 ? \"bg-emerald-500/10 text-emerald-600 ring-emerald-500/20\" :\r\n                                    post.healthScore >= 5 ? \"bg-amber-500/10 text-amber-600 ring-amber-500/20\" :\r\n                                        \"bg-rose-500/10 text-rose-600 ring-rose-500/20\"\r\n                            )}>\r\n                                <Brain size={14} className=\"fill-current opacity-50\" />\r\n                                <span className=\"font-black text-sm\">{post.healthScore}</span>\r\n                            </div>\r\n                        )}\r\n\r\n                        {isOwner && (\r\n                            <div className=\"flex items-center gap-1 glass dark:bg-slate-800/30 p-1.5 rounded-2xl border-white/20 dark:border-slate-700/50\">\r\n                                <button\r\n                                    onClick={() => onEdit?.(post)}\r\n                                    className=\"p-2 text-slate-400 hover:text-orange-500 transition-colors\"\r\n                                    title=\"Edit Post\"\r\n                                >\r\n                                    <Pencil size={18} />\r\n                                </button>\r\n                                <div className=\"w-px h-4 bg-slate-200 dark:bg-slate-700/50 mx-1\"></div>\r\n                                <button\r\n                                    onClick={handleDelete}\r\n                                    disabled={isDeleting}\r\n                                    className=\"p-2 text-slate-400 hover:text-red-500 transition-colors disabled:opacity-50\"\r\n                                    title=\"Delete Post\"\r\n                                >\r\n                                    {isDeleting ? <Loader2 size={18} className=\"animate-spin\" /> : <Trash2 size={18} />}\r\n                                </button>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Content */}\r\n                <div className=\"px-7 pb-4 pt-2 relative z-10\">\r\n                    <h3 className=\"text-2xl font-black bg-gradient-to-r from-slate-900 to-slate-700 dark:from-white dark:to-slate-300 bg-clip-text text-transparent mb-3 leading-tight tracking-tight\">\r\n                        {post.title}\r\n                    </h3>\r\n                    {post.description && (\r\n                        <div className=\"relative\">\r\n                            <p className={cn(\r\n                                \"text-slate-600 dark:text-slate-400 text-sm leading-relaxed transition-all duration-300 font-medium\",\r\n                                !isExpanded && \"line-clamp-2\"\r\n                            )}>\r\n                                {post.description}\r\n                            </p>\r\n                            {post.description.length > 80 && (\r\n                                <button\r\n                                    onClick={() => setIsExpanded(!isExpanded)}\r\n                                    className=\"text-orange-600 dark:text-orange-400 font-black text-[10px] mt-2 uppercase tracking-[0.2em] transition-all hover:translate-x-1\"\r\n                                >\r\n                                    {isExpanded ? \"Collapse Intel\" : \"Read Full Stream\"}\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Image */}\r\n                {post.image && (\r\n                    <div className=\"relative w-[calc(100%-1.5rem)] mx-3 aspect-video bg-slate-100 dark:bg-slate-950 rounded-[1.5rem] overflow-hidden mb-6 shadow-inner ring-1 ring-white/10\">\r\n                        <img\r\n                            src={post.image}\r\n                            alt={post.title}\r\n                            className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-1000\"\r\n                            loading=\"lazy\"\r\n                        />\r\n                        <div className=\"absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-transparent\"></div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Footer Content */}\r\n                <div className=\"px-7 pb-7\">\r\n                    {/* Macros Grid */}\r\n                    {post.calories > 0 && (\r\n                        <div className=\"grid grid-cols-4 gap-3 mb-8\">\r\n                            <div className=\"glass dark:bg-slate-950/40 p-3.5 rounded-2xl text-center border-white/20 dark:border-white/5 shadow-sm group/macro hover:scale-105 transition-transform duration-300\">\r\n                                <Flame size={18} className=\"mx-auto text-orange-500 mb-2\" />\r\n                                <div className=\"text-base font-black text-slate-900 dark:text-white tabular-nums\">{post.calories}</div>\r\n                                <div className=\"text-[8px] text-slate-400 font-black uppercase tracking-widest mt-1\">Kcal</div>\r\n                            </div>\r\n                            <div className=\"glass dark:bg-slate-950/40 p-3.5 rounded-2xl text-center border-white/20 dark:border-white/5 shadow-sm group/macro hover:scale-105 transition-transform duration-300\">\r\n                                <Droplets size={18} className=\"mx-auto text-indigo-500 mb-2\" />\r\n                                <div className=\"text-base font-black text-slate-900 dark:text-white tabular-nums\">{post.macros.protein}g</div>\r\n                                <div className=\"text-[8px] text-slate-400 font-black uppercase tracking-widest mt-1\">Prot</div>\r\n                            </div>\r\n                            <div className=\"glass dark:bg-slate-950/40 p-3.5 rounded-2xl text-center border-white/20 dark:border-white/5 shadow-sm group/macro hover:scale-105 transition-transform duration-300\">\r\n                                <Wheat size={18} className=\"mx-auto text-emerald-500 mb-2\" />\r\n                                <div className=\"text-base font-black text-slate-900 dark:text-white tabular-nums\">{post.macros.carbs}g</div>\r\n                                <div className=\"text-[8px] text-slate-400 font-black uppercase tracking-widest mt-1\">Carb</div>\r\n                            </div>\r\n                            <div className=\"glass dark:bg-slate-950/40 p-3.5 rounded-2xl text-center border-white/20 dark:border-white/5 shadow-sm group/macro hover:scale-105 transition-transform duration-300\">\r\n                                <Cookie size={18} className=\"mx-auto text-amber-500 mb-2\" />\r\n                                <div className=\"text-base font-black text-slate-900 dark:text-white tabular-nums\">{post.macros.fat}g</div>\r\n                                <div className=\"text-[8px] text-slate-400 font-black uppercase tracking-widest mt-1\">Fat</div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Ingredients */}\r\n                    {post.ingredients && post.ingredients.length > 0 && (\r\n                        <div className=\"mb-8\">\r\n                            <div className=\"flex items-center gap-3 mb-3\">\r\n                                <div className=\"p-1.5 bg-orange-100 dark:bg-orange-900/30 rounded-lg text-orange-600 dark:text-orange-400\">\r\n                                    <Package size={14} />\r\n                                </div>\r\n                                <h4 className=\"text-[10px] font-black uppercase tracking-[0.2em] text-slate-400\">Ingredients</h4>\r\n                            </div>\r\n                            <div className=\"flex flex-wrap gap-2\">\r\n                                {post.ingredients.slice(0, 4).map((ing, i) => (\r\n                                    <span key={i} className=\"text-[10px] px-4 py-2 glass dark:bg-slate-800/50 rounded-xl text-slate-600 dark:text-slate-300 font-black uppercase tracking-wide border-white/20 dark:border-slate-700/50\">\r\n                                        {ing}\r\n                                    </span>\r\n                                ))}\r\n                                {post.ingredients.length > 4 && (\r\n                                    <span className=\"text-[10px] px-4 py-2 bg-orange-500 text-white rounded-xl font-black uppercase tracking-wide shadow-lg shadow-orange-500/20\">\r\n                                        +{post.ingredients.length - 4} More\r\n                                    </span>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Actions */}\r\n                    <div className=\"flex items-center gap-3 pt-6 border-t border-slate-100 dark:border-slate-800/50\">\r\n                        <button\r\n                            onClick={handleLikeToggle}\r\n                            className={cn(\r\n                                \"flex items-center gap-3 px-6 py-3 rounded-2xl text-sm font-black transition-all hover:scale-105 active:scale-95\",\r\n                                isLiked\r\n                                    ? \"bg-rose-500 text-white shadow-xl shadow-rose-500/30\"\r\n                                    : \"glass dark:bg-slate-800 text-slate-500 dark:text-slate-400 border-white/20 dark:border-slate-700/50 shadow-md\"\r\n                            )}\r\n                        >\r\n                            <Heart size={18} className={cn(isLiked && \"fill-current\")} />\r\n                            <span className=\"tabular-nums\">{likeCount}</span>\r\n                        </button>\r\n\r\n                        <div className=\"flex-1\" />\r\n\r\n                        {(post.calories > 0 || (post.ingredients && post.ingredients.length > 0)) && (\r\n                            <button\r\n                                onClick={handleSaveToggle}\r\n                                disabled={isSaving}\r\n                                className={cn(\r\n                                    \"flex items-center gap-3 px-8 py-3 rounded-2xl text-[10px] font-black uppercase tracking-widest transition-all hover:scale-105 active:scale-95 shadow-xl disabled:opacity-50\",\r\n                                    isSaved\r\n                                        ? \"bg-slate-900 text-white dark:bg-white dark:text-black\"\r\n                                        : \"bg-gradient-to-r from-orange-500 to-rose-600 text-white shadow-orange-500/30\"\r\n                                )}\r\n                            >\r\n                                {isSaving ? (\r\n                                    <Loader2 size={16} className=\"animate-spin\" />\r\n                                ) : (\r\n                                    <>\r\n                                        <BookOpen size={16} />\r\n                                        <span className=\"text-xs font-black uppercase tracking-widest\">\r\n                                            {isSaved ? \"Saved\" : \"Save Recipe\"}\r\n                                        </span>\r\n                                    </>\r\n                                )}\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\components\\ui\\Button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\components\\ui\\Card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\components\\workout\\ExerciseModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\lib\\ai.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[559,562],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[559,562],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":77,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":77,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":145,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":145,"endColumn":23},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":145,"column":25,"nodeType":"BlockStatement","messageId":"unexpected","endLine":145,"endColumn":28,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[5590,5591],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":169,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":169,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6470,6473],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6470,6473],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":198,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":198,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7804,7807],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7804,7807],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":198,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":198,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7824,7827],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7824,7827],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":228,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":228,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":237,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":237,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9699,9702],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9699,9702],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":282,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":282,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12103,12106],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12103,12106],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":286,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":286,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12240,12243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12240,12243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":303,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":303,"endColumn":15}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useAppStore, type MealEntry } from \"../store/useAppStore\"\r\n\r\n// We'll use the Gemini 1.5 Flash API via REST to avoid package installation issues\r\n// Pin model version to avoid breaking changes\r\nconst GEMINI_MODEL = \"gemini-1.5-flash-002\"\r\nconst GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent`\r\n\r\n/**\r\n * Robust fetch wrapper with exponential backoff retry logic.\r\n */\r\nasync function fetchWithRetry(url: string, options: RequestInit, maxRetries = 2): Promise<Response> {\r\n    let lastError: any;\r\n\r\n    for (let i = 0; i <= maxRetries; i++) {\r\n        try {\r\n            const response = await fetch(url, options);\r\n\r\n            // Success OR client error (4xx) that shouldn't be retried\r\n            if (response.ok || (response.status >= 400 && response.status < 500)) {\r\n                return response;\r\n            }\r\n\r\n            throw new Error(`Server returned ${response.status}`);\r\n        } catch (err) {\r\n            lastError = err;\r\n            if (i < maxRetries) {\r\n                const delay = Math.pow(2, i) * 1000; // 1s, 2s\r\n                await new Promise(resolve => setTimeout(resolve, delay));\r\n            }\r\n        }\r\n    }\r\n\r\n    throw lastError || new Error(\"Fetch failed after retries\");\r\n}\r\n\r\n// Helper to convert File to base64\r\nconst fileToBase64 = (file: File): Promise<string> => {\r\n    return new Promise((resolve, reject) => {\r\n        const reader = new FileReader();\r\n        reader.readAsDataURL(file);\r\n        reader.onload = () => {\r\n            const base64String = (reader.result as string).split(',')[1];\r\n            resolve(base64String);\r\n        };\r\n        reader.onerror = error => reject(error);\r\n    });\r\n};\r\n\r\nconst sanitizeJSON = (text: string) => {\r\n    try {\r\n        // First try to find a JSON block between backticks\r\n        const match = text.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\r\n        if (match && match[1]) {\r\n            return match[1].trim();\r\n        }\r\n\r\n        // If no backticks, find the first balance of brackets/braces\r\n        const firstBracket = text.indexOf('[');\r\n        const firstBrace = text.indexOf('{');\r\n        let start = -1;\r\n        if (firstBracket !== -1 && (firstBrace === -1 || firstBracket < firstBrace)) start = firstBracket;\r\n        else if (firstBrace !== -1) start = firstBrace;\r\n\r\n        if (start !== -1) {\r\n            const lastBracket = text.lastIndexOf(']');\r\n            const lastBrace = text.lastIndexOf('}');\r\n            let end = -1;\r\n            if (lastBracket !== -1 && (lastBrace === -1 || lastBracket > lastBrace)) end = lastBracket;\r\n            else if (lastBrace !== -1) end = lastBrace;\r\n\r\n            if (end !== -1 && end > start) {\r\n                return text.substring(start, end + 1).trim();\r\n            }\r\n        }\r\n\r\n        return text.trim();\r\n    } catch (e) {\r\n        return text.trim();\r\n    }\r\n};\r\n\r\n/**\r\n * Unified helper to retrieve the Gemini API Key.\r\n * Priority: 1. User's custom key (Profile) -> 2. Environment Variable -> 3. Shared App Key\r\n * Returns null if no key is configured anywhere.\r\n */\r\nexport const getApiKey = () => {\r\n    const state = useAppStore.getState();\r\n    const envKey = import.meta.env.VITE_GEMINI_API_KEY as string | undefined;\r\n    return state.apiKey || envKey || state.sharedApiKey || null;\r\n};\r\n\r\nexport async function analyzeImage(file: File): Promise<Omit<MealEntry, 'id' | 'timestamp' | 'mealType'>> {\r\n    const apiKey = getApiKey();\r\n\r\n    if (!apiKey) {\r\n        return getMockResult(file.name);\r\n    }\r\n\r\n    try {\r\n        const base64Image = await fileToBase64(file);\r\n\r\n        const response = await fetchWithRetry(`${GEMINI_API_URL}?key=${apiKey}`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({\r\n                contents: [{\r\n                    parts: [\r\n                        {\r\n                            text: `IDENTIFY: Precisely name all food items in the image.\r\n                        ESTIMATE: Total calories, protein, carbs, and fat (grams).\r\n                        ANALYZE: Assign a 'healthScore' (1-10) based on nutritional density and typical ingredients.\r\n                        EXPLAIN: Provide a 1-sentence 'reasoning' for the score.\r\n                        \r\n                        Return ONLY JSON:\r\n                        {\r\n                          \"name\": \"Detailed name of meal\",\r\n                          \"calories\": number,\r\n                          \"protein\": number,\r\n                          \"carbs\": number,\r\n                          \"fat\": number,\r\n                          \"healthScore\": number,\r\n                          \"reasoning\": \"Your brief explanation\",\r\n                          \"ingredients\": [\"string\", \"string\"]\r\n                        }`\r\n                        },\r\n                        {\r\n                            inline_data: {\r\n                                mime_type: file.type,\r\n                                data: base64Image\r\n                            }\r\n                        }\r\n                    ]\r\n                }]\r\n            })\r\n        });\r\n\r\n        if (!response.ok) {\r\n            const errorText = await response.text().catch(() => \"Unknown error\");\r\n            console.error(\"Gemini API Error Raw:\", errorText);\r\n            let errorMsg = `API error: ${response.status}`;\r\n            try {\r\n                const errorData = JSON.parse(errorText);\r\n                errorMsg = errorData.error?.message || errorMsg;\r\n            } catch (e) { }\r\n            throw new Error(errorMsg);\r\n        }\r\n\r\n        const result = await response.json();\r\n\r\n        if (!result.candidates || result.candidates.length === 0) {\r\n            throw new Error(\"Gemini returned no results. The image might be unclear or unsupported.\");\r\n        }\r\n\r\n        const content = result.candidates[0].content.parts[0].text;\r\n        const data = JSON.parse(sanitizeJSON(content));\r\n\r\n        return {\r\n            name: data.name || \"Unknown Food\",\r\n            calories: Math.round(data.calories || 0),\r\n            protein: Math.round(data.protein || 0),\r\n            carbs: Math.round(data.carbs || 0),\r\n            fat: Math.round(data.fat || 0),\r\n            healthScore: data.healthScore || 5,\r\n            reasoning: data.reasoning || \"Balanced meal.\",\r\n            ingredients: data.ingredients || []\r\n        };\r\n\r\n    } catch (error: any) {\r\n        console.error(\"Gemini Scan failed:\", error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n// Fallback Mock Logic (Original logic preserved as fallback)\r\nfunction getMockResult(filename: string) {\r\n    const FOOD_DATABASE = [\r\n        { keywords: ['avocado', 'toast', 'bread'], data: { name: \"Avocado Toast\", calories: 350, protein: 12, carbs: 45, fat: 18 } },\r\n        { keywords: ['salad', 'chicken', 'greens', 'lettuce'], data: { name: \"Grilled Chicken Salad\", calories: 420, protein: 45, carbs: 12, fat: 20 } },\r\n        { keywords: ['oat', 'porridge', 'berry', 'berries'], data: { name: \"Oatmeal with Berries\", calories: 280, protein: 8, carbs: 54, fat: 6 } },\r\n        { keywords: ['burger', 'beef', 'cheeseburger', 'bun'], data: { name: \"Double Cheeseburger\", calories: 850, protein: 50, carbs: 40, fat: 55 } },\r\n        { keywords: ['salmon', 'fish', 'rice', 'sushi'], data: { name: \"Salmon and Rice\", calories: 550, protein: 40, carbs: 60, fat: 15 } },\r\n    ];\r\n\r\n    const match = FOOD_DATABASE.find(item =>\r\n        item.keywords.some(keyword => filename.toLowerCase().includes(keyword))\r\n    );\r\n\r\n    return match ? match.data : {\r\n        name: \"Identified Food\",\r\n        calories: 300,\r\n        protein: 15,\r\n        carbs: 35,\r\n        fat: 10\r\n    };\r\n}\r\n\r\nexport async function getAIHealthInsights(weeklyData: any[], userProfile: any): Promise<{ wins: string, watchOut: string, focusThisWeek: string } | string> {\r\n    const apiKey = getApiKey();\r\n    if (!apiKey) return \"Log your meals daily to unlock personalized AI health insights and coaching.\";\r\n\r\n    try {\r\n        const response = await fetchWithRetry(`${GEMINI_API_URL}?key=${apiKey}`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({\r\n                contents: [{\r\n                    parts: [{\r\n                        text: `Act as a professional nutritionist. Analyze this user's weekly health data:\r\n                        Weekly Data: ${JSON.stringify(weeklyData)}\r\n                        User Goal: ${userProfile.goal}\r\n                        \r\n                        Return ONLY a JSON object with exactly these fields:\r\n                        {\r\n                          \"wins\": \"One positive thing the user did this week (1 short sentence)\",\r\n                          \"watchOut\": \"One potential issue or area for improvement (1 short sentence)\",\r\n                          \"focusThisWeek\": \"One specific actionable goal for next week (1 short sentence)\"\r\n                        }`\r\n                    }]\r\n                }]\r\n            })\r\n        });\r\n\r\n        if (!response.ok) throw new Error(\"API call failed\");\r\n        const result = await response.json();\r\n        const content = result.candidates[0].content.parts[0].text;\r\n        return JSON.parse(sanitizeJSON(content));\r\n    } catch (e) {\r\n        return {\r\n            wins: \"You're consistently tracking your progress—that's the first step!\",\r\n            watchOut: \"Watch your weekend calorie intake to stay on track.\",\r\n            focusThisWeek: \"Aim for more protein in your breakfast next week.\"\r\n        };\r\n    }\r\n}\r\n\r\nexport async function generateMealPlan(userProfile: any, availableIngredients?: string): Promise<Omit<MealEntry, 'id' | 'timestamp'>[]> {\r\n    const apiKey = getApiKey();\r\n    if (!apiKey) throw new Error(\"AI features require a configured API key in Profile.\");\r\n\r\n    try {\r\n        const ingredientsContext = availableIngredients\r\n            ? `IMPORTANT: The user has these ingredients available: ${availableIngredients}. Prioritize using these in the meals.`\r\n            : \"Generate a diverse and nutritionally balanced plan.\";\r\n\r\n        const response = await fetchWithRetry(`${GEMINI_API_URL}?key=${apiKey}`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({\r\n                contents: [{\r\n                    parts: [{\r\n                        text: `Act as a professional meal planner. ${ingredientsContext}\r\n                        User Stats: Goal: ${userProfile.goal}, Height: ${userProfile.height}cm, Weight: ${userProfile.weight}kg, Age: ${userProfile.age}.\r\n                        IMPORTANT: Every meal object MUST include a non-empty \"ingredients\" array. Provide a COMPREHENSIVE and DETAILED list of every specific ingredient and quantity (e.g., '2 Large Eggs', '100g Baby Spinach').\r\n                        Structure: [{\"mealType\": \"breakfast\"|\"lunch\"|\"dinner\"|\"snack\", \"name\": \"meal name\", \"calories\": number, \"protein\": number, \"carbs\": number, \"fat\": number, \"ingredients\": [\"string\"]}]`\r\n                    }]\r\n                }]\r\n            })\r\n        });\r\n\r\n        if (!response.ok) {\r\n            const errorText = await response.text();\r\n            throw new Error(`AI generation failed: ${response.status}. ${errorText}`);\r\n        }\r\n\r\n        const result = await response.json();\r\n        if (!result.candidates?.[0]?.content?.parts?.[0]?.text) {\r\n            throw new Error(\"AI returned empty content\");\r\n        }\r\n\r\n        const content = result.candidates[0].content.parts[0].text;\r\n        const sanitized = sanitizeJSON(content);\r\n        let meals;\r\n        try {\r\n            meals = JSON.parse(sanitized);\r\n        } catch (e) {\r\n            console.error(\"AI JSON Parse Error:\", e, \"Raw:\", content);\r\n            throw new Error(\"AI returned unreadable data. Please try again.\");\r\n        }\r\n\r\n        // Defensive validation: ensure ingredients exists for all meals\r\n        return (Array.isArray(meals) ? meals : []).map((m: any) => ({\r\n            ...m,\r\n            ingredients: Array.isArray(m.ingredients) ? m.ingredients : []\r\n        }));\r\n    } catch (e: any) {\r\n        console.error(\"Meal planning failed:\", e);\r\n        throw e;\r\n    }\r\n}\r\n\r\nexport async function testGeminiKey(apiKey: string): Promise<boolean> {\r\n    if (!apiKey) return false;\r\n    try {\r\n        const response = await fetchWithRetry(`${GEMINI_API_URL}?key=${apiKey}`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({\r\n                contents: [{ parts: [{ text: \"hi\" }] }]\r\n            })\r\n        });\r\n        return response.ok;\r\n    } catch (e) {\r\n        return false;\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\lib\\calories.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\lib\\firebase.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1184,1187],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1184,1187],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { initializeApp } from \"firebase/app\";\r\nimport { getAuth } from \"firebase/auth\";\r\nimport { getAnalytics, isSupported } from \"firebase/analytics\";\nimport { getFirestore } from \"firebase/firestore\";\r\nimport { getStorage } from \"firebase/storage\";\r\n\r\n// Your web app's Firebase configuration\r\nconst firebaseConfig = {\r\n  apiKey: import.meta.env.VITE_FIREBASE_API_KEY || \"AIzaSyDscYUonnvEW7fsST60Cjw7gG5Rdu07S3o\",\r\n  authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN || \"calorietracking-d41e8.firebaseapp.com\",\r\n  projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID || \"calorietracking-d41e8\",\r\n  storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET || \"calorietracking-d41e8.firebasestorage.app\",\r\n  messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID || \"190065413740\",\r\n  appId: import.meta.env.VITE_FIREBASE_APP_ID || \"1:190065413740:web:50ec4f564732d034755249\",\r\n  measurementId: import.meta.env.VITE_FIREBASE_MEASUREMENT_ID || \"G-T96KKESFBM\"\r\n};\r\n\r\n// Initialize Firebase\r\nconst app = initializeApp(firebaseConfig);\r\nexport const auth = getAuth(app);\r\nexport const db = getFirestore(app);\r\nexport const storage = getStorage(app);\r\nlet _analytics: any = null;\nif (typeof window !== 'undefined') {\n  try {\n    _analytics = await isSupported().then(s => (s ? getAnalytics(app) : null)).catch(() => null);\n  } catch {\n    _analytics = null;\n  }\n}\nexport const analytics = _analytics;\n\r\nexport default app;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\pages\\Auth.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'quotes.length'. Either include it or remove the dependency array.","line":54,"column":8,"nodeType":"ArrayExpression","endLine":54,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [quotes.length]","fix":{"range":[2095,2097],"text":"[quotes.length]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2699,2702],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2699,2702],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":104,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3922,3925],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3922,3925],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":170,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6262,6265],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6262,6265],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":367,"column":98,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":367,"endColumn":101,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20102,20105],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20102,20105],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":413,"column":101,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":413,"endColumn":104,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23944,23947],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23944,23947],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":431,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":431,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25533,25536],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25533,25536],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { Eye, EyeOff, ArrowRight, ArrowLeft, Activity, Calendar, User as UserIcon } from \"lucide-react\";\r\nimport { cn } from \"../lib/utils\";\r\n\r\nimport { toast } from \"sonner\";\r\nimport { auth } from \"../lib/firebase\";\r\nimport {\r\n    signInWithEmailAndPassword,\r\n    createUserWithEmailAndPassword,\r\n    updateProfile,\r\n    sendPasswordResetEmail\r\n} from \"firebase/auth\";\r\nimport { useAppStore, type UserProfile } from \"../store/useAppStore\";\r\nimport { Button } from \"../components/ui/Button\";\r\n\r\nexport default function Auth() {\r\n    const [isLogin, setIsLogin] = useState(true);\r\n    const [signupStep, setSignupStep] = useState(1); // 1 = Auth, 2 = Profile\r\n    const [showPassword, setShowPassword] = useState(false);\r\n\r\n    // Auth State\r\n    const [email, setEmail] = useState(\"\");\r\n    const [password, setPassword] = useState(\"\");\r\n    const [fullName, setFullName] = useState(\"\");\r\n\r\n    // Profile State\r\n    const [gender, setGender] = useState<UserProfile['gender']>('male');\r\n    const [activityLevel, setActivityLevel] = useState<UserProfile['activityLevel']>('moderate');\r\n    const [age, setAge] = useState<string>(\"\");\r\n    const [height, setHeight] = useState<string>(\"\");\r\n    const [weight, setWeight] = useState<string>(\"\");\r\n    const [goal, setGoal] = useState<UserProfile['goal']>('maintain');\r\n\r\n    const navigate = useNavigate();\r\n    const setUser = useAppStore(state => state.setUser);\r\n\r\n    // Motivational Quotes\r\n    const quotes = [\r\n        \"Health is the greatest wealth. 🏃‍♂️\",\r\n        \"Small steps every day. 🌱\",\r\n        \"Invest in yourself. ✨\",\r\n        \"Your body hears everything your mind says. 🧠\",\r\n        \"Eat better, not less. 🍎\",\r\n        \"Progress, not perfection. 🚀\"\r\n    ];\r\n    const [currentQuote, setCurrentQuote] = useState(0);\r\n\r\n    useEffect(() => {\r\n        const interval = setInterval(() => {\r\n            setCurrentQuote((prev) => (prev + 1) % quotes.length);\r\n        }, 4000);\r\n        return () => clearInterval(interval);\r\n    }, []);\r\n\r\n    const login = async () => {\r\n        if (!email || !password) {\r\n            toast.error(\"Missing Info\", {\r\n                description: \"Please enter both email and password 🥺\"\r\n            });\r\n            return;\r\n        }\r\n\r\n        try {\r\n            await signInWithEmailAndPassword(auth, email, password);\r\n            setUser({ isAuthenticated: true, email: email });\r\n            toast.success(\"Welcome back! 👋\", {\r\n                description: \"It's great to see you again!\",\r\n                duration: 2000,\r\n            });\r\n            navigate(\"/\");\r\n        } catch (error: any) {\r\n            console.error(\"Login error:\", error);\r\n            let message = \"Something went wrong during login.\";\r\n            if (error.code === \"auth/user-not-found\" || error.code === \"auth/wrong-password\" || error.code === \"auth/invalid-credential\") {\r\n                message = \"Invalid email or password. Please try again.\";\r\n            }\r\n            toast.error(\"Oops!\", {\r\n                description: message\r\n            });\r\n        }\r\n    };\r\n\r\n    const signup = async () => {\r\n        if (!fullName || !email || !password) {\r\n            toast.error(\"Hold up!\", {\r\n                description: \"We need all your details to get started ✨\"\r\n            });\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const userCredential = await createUserWithEmailAndPassword(auth, email, password);\r\n            await updateProfile(userCredential.user, {\r\n                displayName: fullName\r\n            });\r\n\r\n            // Advance to profile step instead of navigating immediately\r\n            setSignupStep(2);\r\n            toast.success(\"Account Created! 🎉\", {\r\n                description: \"Now let's set up your profile for better tracking.\"\r\n            });\r\n\r\n        } catch (error: any) {\r\n            console.error(\"Signup error:\", error);\r\n            let message = \"Something went wrong during signup.\";\r\n            if (error.code === \"auth/email-already-in-use\") {\r\n                message = \"This email is already registered.\";\r\n            } else if (error.code === \"auth/weak-password\") {\r\n                message = \"Password should be at least 6 characters.\";\r\n            }\r\n            toast.error(\"Signup Failed\", {\r\n                description: message\r\n            });\r\n        }\r\n    };\r\n\r\n    const handleProfileComplete = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n\r\n        if (!age || !height || !weight) {\r\n            toast.error(\"Missing Details\", {\r\n                description: \"Please fill in all fields so we can personalize your plan.\"\r\n            });\r\n            return;\r\n        }\r\n\r\n        const profile: Partial<UserProfile> = {\r\n            isAuthenticated: true,\r\n            email: email,\r\n            name: fullName,\r\n            age: Number(age),\r\n            height: Number(height),\r\n            weight: Number(weight),\r\n            gender: gender,\r\n            activityLevel: activityLevel,\r\n            goal: goal,\r\n            onboardingCompleted: true\r\n        };\r\n\r\n        // Save complete profile to store and Firestore (via setUser sync)\r\n        try {\r\n            await setUser(profile);\r\n            toast.success(\"You're all set! 🚀\", {\r\n                description: \"Welcome to your new health journey!\"\r\n            });\r\n            navigate(\"/\");\r\n        } catch (error) {\r\n            console.error(\"Profile save error:\", error);\r\n            toast.error(\"Cloud Sync Error\", {\r\n                description: \"Account created but couldn't sync profile to cloud. We'll try again later.\"\r\n            });\r\n            navigate(\"/\"); // Continue anyway\r\n        }\r\n    };\r\n\r\n    const handleForgotPassword = async () => {\r\n        if (!email) {\r\n            toast.error(\"Email Required\", {\r\n                description: \"Please enter your email to reset password 📧\"\r\n            });\r\n            return;\r\n        }\r\n\r\n        try {\r\n            await sendPasswordResetEmail(auth, email);\r\n            toast.success(\"Reset email sent! 🎉\", {\r\n                description: \"Check your inbox for instructions.\"\r\n            });\r\n        } catch (error: any) {\r\n            console.error(\"Password reset error:\", error);\r\n            toast.error(\"Reset Failed\", {\r\n                description: error.message || \"Failed to send reset email.\"\r\n            });\r\n        }\r\n    };\r\n\r\n    const handleAuth = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (isLogin) {\r\n            login();\r\n        } else {\r\n            signup();\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"min-h-screen flex items-center justify-center p-4 overflow-hidden relative bg-slate-50 dark:bg-slate-950\">\r\n            {/* Soft Background */}\r\n            <div className=\"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-orange-50/50 via-white to-orange-50 dark:from-slate-900 dark:via-slate-950 dark:to-black\"></div>\r\n\r\n            {/* Warm Blobs */}\r\n            <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[150%] h-[150%] -z-10\">\r\n                <div className=\"absolute top-0 left-0 w-[40rem] h-[40rem] bg-orange-200/40 dark:bg-orange-600/10 rounded-full blur-[120px] animate-blob\"></div>\r\n                <div className=\"absolute bottom-0 right-0 w-[40rem] h-[40rem] bg-rose-200/40 dark:bg-rose-600/10 rounded-full blur-[120px] animate-blob animation-delay-2000\"></div>\r\n            </div>\r\n\r\n            {/* Grid Overlay */}\r\n            <div className=\"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 pointer-events-none\"></div>\r\n\r\n            <div className=\"w-full max-w-lg space-y-8 relative z-10 py-10\">\r\n                {/* Header */}\r\n                <div className=\"text-center space-y-3\">\r\n                    <div className=\"relative group mx-auto w-20 h-20 mb-6\">\r\n                        <div className=\"absolute -inset-2 bg-gradient-to-r from-orange-400 to-rose-400 rounded-3xl blur-xl opacity-20 group-hover:opacity-40 transition duration-1000\"></div>\r\n                        <div className=\"relative glass dark:glass-dark rounded-3xl p-4 border-white dark:border-white/10 shadow-2xl animate-bounce-slight overflow-hidden\">\r\n                            <img src=\"/logo.png\" alt=\"Health Companion Logo\" className=\"w-full h-full object-contain\" />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"animate-in fade-in slide-in-from-bottom-4 duration-700\">\r\n                        <h2 className=\"text-4xl font-black text-slate-900 dark:text-white tracking-tight leading-none\">\r\n                            {isLogin ? \"Welcome Back\" : signupStep === 1 ? \"Hello there!\" : \"Tell us more\"}\r\n                        </h2>\r\n                        <p className=\"mt-3 text-xs font-bold text-slate-500 dark:text-slate-400 max-w-[280px] mx-auto leading-relaxed\">\r\n                            {isLogin\r\n                                ? \"Sign in to access your Health Companion\"\r\n                                : signupStep === 1\r\n                                    ? \"Join us on your path to better health\"\r\n                                    : \"Help us personalize your experience\"\r\n                            }\r\n                        </p>\r\n                    </div>\r\n\r\n                    {/* Rotating Quote container - refined */}\r\n                    <div className=\"mt-6 h-6 flex items-center justify-center overflow-hidden\">\r\n                        <p key={currentQuote} className=\"text-slate-400 dark:text-slate-500 text-[10px] font-bold italic animate-fade-in-up\">\r\n                            \"{quotes[currentQuote]}\"\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"glass dark:glass-dark p-8 md:p-10 rounded-[2.5rem] shadow-2xl border-white dark:border-slate-800/50 backdrop-blur-3xl relative overflow-hidden\">\r\n                    <div className=\"absolute -top-24 -right-24 w-48 h-48 bg-orange-500/5 rounded-full blur-3xl\"></div>\r\n\r\n                    {/* Toggle - Only show on Step 1 */}\r\n                    {signupStep === 1 && (\r\n                        <div className=\"flex bg-slate-100/50 dark:bg-slate-900/50 p-1.5 rounded-2xl border border-white dark:border-white/5 mb-10 relative z-10\">\r\n                            <button\r\n                                onClick={() => setIsLogin(true)}\r\n                                className={cn(\r\n                                    \"flex-1 relative z-10 py-3 text-xs font-black transition-all duration-300 rounded-xl uppercase tracking-wider\",\r\n                                    isLogin ? \"bg-white dark:bg-slate-800 text-orange-600 dark:text-orange-400 shadow-xl translate-x-0\" : \"text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200\"\r\n                                )}\r\n                            >\r\n                                Login\r\n                            </button>\r\n                            <button\r\n                                onClick={() => setIsLogin(false)}\r\n                                className={cn(\r\n                                    \"flex-1 relative z-10 py-3 text-xs font-black transition-all duration-300 rounded-xl uppercase tracking-wider\",\r\n                                    !isLogin ? \"bg-white dark:bg-slate-800 text-orange-600 dark:text-orange-400 shadow-xl translate-x-0\" : \"text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200\"\r\n                                )}\r\n                            >\r\n                                Sign Up\r\n                            </button>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"relative z-10\">\r\n                        {signupStep === 1 ? (\r\n                            <form onSubmit={handleAuth} className=\"space-y-6\">\r\n                                {!isLogin && (\r\n                                    <div className=\"space-y-1.5 group\">\r\n                                        <label className=\"text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-widest ml-1\">\r\n                                            Your Name\r\n                                        </label>\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={fullName}\r\n                                            onChange={(e) => setFullName(e.target.value)}\r\n                                            placeholder=\"John Doe\"\r\n                                            className=\"w-full px-5 py-4 bg-white/50 dark:bg-slate-950/50 border border-slate-200 dark:border-slate-800/50 rounded-2xl focus:outline-none focus:ring-4 focus:ring-orange-500/10 transition-all font-bold text-slate-800 dark:text-white shadow-sm\"\r\n                                        />\r\n                                    </div>\r\n                                )}\r\n\r\n                                <div className=\"space-y-1.5\">\r\n                                    <label className=\"text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-widest ml-1\">\r\n                                        Email Address\r\n                                    </label>\r\n                                    <input\r\n                                        type=\"email\"\r\n                                        value={email}\r\n                                        onChange={(e) => setEmail(e.target.value)}\r\n                                        placeholder=\"john@example.com\"\r\n                                        className=\"w-full px-5 py-4 bg-white/50 dark:bg-slate-950/50 border border-slate-200 dark:border-slate-800/50 rounded-2xl focus:outline-none focus:ring-4 focus:ring-orange-500/10 transition-all font-bold text-slate-800 dark:text-white shadow-sm\"\r\n                                    />\r\n                                </div>\r\n\r\n                                <div className=\"space-y-1.5\">\r\n                                    <label className=\"text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-widest ml-1\">\r\n                                        Password\r\n                                    </label>\r\n                                    <div className=\"relative\">\r\n                                        <input\r\n                                            type={showPassword ? \"text\" : \"password\"}\r\n                                            value={password}\r\n                                            onChange={(e) => setPassword(e.target.value)}\r\n                                            placeholder=\"••••••••\"\r\n                                            className=\"w-full px-5 py-4 bg-white/50 dark:bg-slate-950/50 border border-slate-200 dark:border-slate-800/50 rounded-2xl focus:outline-none focus:ring-4 focus:ring-orange-500/10 transition-all font-bold text-slate-800 dark:text-white shadow-sm\"\r\n                                        />\r\n                                        <button\r\n                                            type=\"button\"\r\n                                            onClick={() => setShowPassword(!showPassword)}\r\n                                            className=\"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-orange-500 transition-colors\"\r\n                                        >\r\n                                            {showPassword ? <EyeOff size={18} /> : <Eye size={18} />}\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {isLogin && (\r\n                                    <div className=\"flex justify-end\">\r\n                                        <button\r\n                                            type=\"button\"\r\n                                            onClick={handleForgotPassword}\r\n                                            className=\"text-[10px] font-black text-orange-600 dark:text-orange-400 uppercase tracking-widest hover:underline transition-colors\"\r\n                                        >\r\n                                            Forgot password?\r\n                                        </button>\r\n                                    </div>\r\n                                )}\r\n\r\n                                <Button\r\n                                    type=\"submit\"\r\n                                    fullWidth\r\n                                    className=\"h-14 bg-gradient-to-r from-orange-500 via-rose-500 to-rose-600 text-white rounded-2xl font-black uppercase tracking-widest text-xs shadow-xl shadow-orange-500/20 hover:shadow-orange-500/40\"\r\n                                >\r\n                                    {isLogin ? \"Log In\" : \"Create Account\"}\r\n                                </Button>\r\n                            </form>\r\n                        ) : (\r\n                            // Step 2: Profile Setup\r\n                            <div className=\"space-y-8 animate-in fade-in slide-in-from-right-12 duration-500\">\r\n                                <button\r\n                                    onClick={() => setSignupStep(1)}\r\n                                    className=\"w-10 h-10 glass dark:glass-dark rounded-2xl flex items-center justify-center text-slate-500 hover:text-orange-500 transition-all hover:scale-105 active:scale-95 shadow-md\"\r\n                                >\r\n                                    <ArrowLeft size={18} />\r\n                                </button>\r\n                                <form onSubmit={handleProfileComplete} className=\"space-y-8\">\r\n                                    <div className=\"grid grid-cols-2 gap-6\">\r\n                                        <div className=\"space-y-1.5\">\r\n                                            <label className=\"text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-widest ml-1\">\r\n                                                How old are you?\r\n                                            </label>\r\n                                            <div className=\"relative\">\r\n                                                <Calendar className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400\" size={16} />\r\n                                                <input\r\n                                                    type=\"number\"\r\n                                                    value={age}\r\n                                                    onChange={(e) => setAge(e.target.value)}\r\n                                                    placeholder=\"25\"\r\n                                                    className=\"w-full pl-12 pr-4 py-4 bg-white/50 dark:bg-slate-950/50 border border-slate-200 dark:border-slate-800/50 rounded-2xl focus:outline-none focus:ring-4 focus:ring-orange-500/10 transition-all font-bold text-slate-800 dark:text-white\"\r\n                                                />\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"space-y-1.5\">\r\n                                            <label className=\"text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-widest ml-1\">\r\n                                                Gender\r\n                                            </label>\r\n                                            <div className=\"relative\">\r\n                                                <UserIcon className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400\" size={16} />\r\n                                                <select\r\n                                                    value={gender}\r\n                                                    onChange={(e) => setGender(e.target.value as any)}\r\n                                                    className=\"w-full pl-12 pr-4 py-4 bg-white/50 dark:bg-slate-950/50 border border-slate-200 dark:border-slate-800/50 rounded-2xl focus:outline-none focus:ring-4 focus:ring-orange-500/10 transition-all font-bold appearance-none text-slate-800 dark:text-white\"\r\n                                                >\r\n                                                    <option value=\"male\">Male</option>\r\n                                                    <option value=\"female\">Female</option>\r\n                                                    <option value=\"other\">Other</option>\r\n                                                </select>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"grid grid-cols-2 gap-6\">\r\n                                        <div className=\"space-y-1.5\">\r\n                                            <label className=\"text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-widest ml-1\">\r\n                                                Height (cm)\r\n                                            </label>\r\n                                            <input\r\n                                                type=\"number\"\r\n                                                value={height}\r\n                                                onChange={(e) => setHeight(e.target.value)}\r\n                                                placeholder=\"175\"\r\n                                                className=\"w-full px-5 py-4 bg-white/50 dark:bg-slate-950/50 border border-slate-200 dark:border-slate-800/50 rounded-2xl focus:outline-none focus:ring-4 focus:ring-orange-500/10 transition-all font-bold text-slate-800 dark:text-white\"\r\n                                            />\r\n                                        </div>\r\n                                        <div className=\"space-y-1.5\">\r\n                                            <label className=\"text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-widest ml-1\">\r\n                                                Weight (kg)\r\n                                            </label>\r\n                                            <input\r\n                                                type=\"number\"\r\n                                                value={weight}\r\n                                                onChange={(e) => setWeight(e.target.value)}\r\n                                                placeholder=\"70\"\r\n                                                className=\"w-full px-5 py-4 bg-white/50 dark:bg-slate-950/50 border border-slate-200 dark:border-slate-800/50 rounded-2xl focus:outline-none focus:ring-4 focus:ring-orange-500/10 transition-all font-bold text-slate-800 dark:text-white\"\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"space-y-1.5\">\r\n                                        <label className=\"text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-widest ml-1\">\r\n                                            Activity Level\r\n                                        </label>\r\n                                        <div className=\"relative\">\r\n                                            <Activity className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400\" size={16} />\r\n                                            <select\r\n                                                value={activityLevel}\r\n                                                onChange={(e) => setActivityLevel(e.target.value as any)}\r\n                                                className=\"w-full pl-12 pr-4 py-4 bg-white/50 dark:bg-slate-950/50 border border-slate-200 dark:border-slate-800/50 rounded-2xl focus:outline-none focus:ring-4 focus:ring-orange-500/10 transition-all font-bold appearance-none text-slate-800 dark:text-white\"\r\n                                            >\r\n                                                <option value=\"sedentary\">Sedentary (Little to no exercise)</option>\r\n                                                <option value=\"light\">Light (Exercise 1-3 times/week)</option>\r\n                                                <option value=\"moderate\">Moderate (Exercise 3-5 times/week)</option>\r\n                                                <option value=\"active\">Active (Daily exercise)</option>\r\n                                                <option value=\"athlete\">Athlete (Intense daily training)</option>\r\n                                            </select>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"space-y-1.5\">\r\n                                        <label className=\"text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-widest ml-1\">\r\n                                            Goal\r\n                                        </label>\r\n                                        <select\r\n                                            value={goal}\r\n                                            onChange={(e) => setGoal(e.target.value as any)}\r\n                                            className=\"w-full px-5 py-4 bg-white/50 dark:bg-slate-950/50 border border-slate-200 dark:border-slate-800/50 rounded-2xl focus:outline-none focus:ring-4 focus:ring-orange-500/10 transition-all font-bold appearance-none text-slate-800 dark:text-white\"\r\n                                        >\r\n                                            <option value=\"lose\">Weight Reduction</option>\r\n                                            <option value=\"maintain\">Maintain Equilibrium</option>\r\n                                            <option value=\"gain\">Gain Muscle</option>\r\n                                        </select>\r\n                                    </div>\r\n\r\n                                    <Button\r\n                                        type=\"submit\"\r\n                                        fullWidth\r\n                                        className=\"h-14 bg-gradient-to-r from-orange-500 via-rose-500 to-rose-600 text-white rounded-2xl font-black uppercase tracking-widest text-xs shadow-xl shadow-orange-500/20 flex items-center justify-center gap-3\"\r\n                                    >\r\n                                        Complete Profile <ArrowRight size={18} />\r\n                                    </Button>\r\n                                </form>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"text-center\">\r\n                    <p className=\"text-[10px] font-bold text-slate-400 dark:text-slate-600 uppercase tracking-widest\">\r\n                        Health Companion v2.0.4 Secure Link\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\pages\\Home.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\pages\\Log.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":95,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3621,3624],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3621,3624],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef } from \"react\"\r\nimport { format } from \"date-fns\"\r\nimport { useAppStore, type MealEntry } from \"../store/useAppStore\"\r\nimport { Plus, Trash2, Loader2, Camera, X, Pencil } from \"lucide-react\"\r\nimport { AddFoodForm } from \"../components/log/AddFoodForm\"\r\nimport { CameraCapture } from \"../components/log/CameraCapture\"\r\nimport { cn } from \"../lib/utils\"\r\nimport { calculateTDEE } from \"../lib/calories\"\r\nimport { analyzeImage } from \"../lib/ai\"\r\nimport { toast } from \"sonner\"\r\n\r\nexport default function Log() {\r\n    // Dynamic Tabs\r\n    const TABS: MealEntry['mealType'][] = ['breakfast', 'lunch', 'dinner', 'snack']\r\n\r\n    const [activeTab, setActiveTab] = useState<MealEntry['mealType']>('breakfast')\r\n    const [isAddingMode, setIsAddingMode] = useState(false)\r\n    const [isScanning, setIsScanning] = useState(false)\r\n    const [showScanModal, setShowScanModal] = useState(false)\r\n    const [showWebCamera, setShowWebCamera] = useState(false)\r\n    const [scannedData, setScannedData] = useState<Partial<MealEntry> | undefined>(undefined)\r\n    const cameraInputRef = useRef<HTMLInputElement>(null)\r\n    const galleryInputRef = useRef<HTMLInputElement>(null)\r\n\r\n    const addEntry = useAppStore(state => state.addEntry)\r\n    const updateEntry = useAppStore(state => state.updateEntry)\r\n    const user = useAppStore(state => state.user)\r\n\r\n    const today = format(new Date(), 'yyyy-MM-dd')\r\n    const logs = useAppStore(state => state.logs[today])\r\n    const removeEntry = useAppStore(state => state.removeEntry)\r\n\r\n    const entries = logs?.entries.filter(e => e.mealType === activeTab) || []\r\n\r\n    const dailyTotal = (logs?.entries || []).reduce((acc, e) => acc + e.calories, 0)\r\n\r\n    // Calculate TDEE/BMR (Miffin-St Jeor Equation)\r\n    const target = calculateTDEE(user)\r\n\r\n    const progress = Math.min(100, (dailyTotal / target) * 100)\r\n\r\n    const handleAddEntry = (entry: Omit<MealEntry, 'id' | 'timestamp'> & { id?: string }) => {\r\n        if (entry.id) {\r\n            updateEntry(today, entry as MealEntry)\r\n        } else {\r\n            addEntry(today, entry as Omit<MealEntry, 'id' | 'timestamp'>)\r\n        }\r\n        setScannedData(undefined) // Reset scan data after add/update\r\n        setIsAddingMode(false)\r\n    }\r\n\r\n    const handleScanClick = () => {\r\n        setShowScanModal(true)\r\n    }\r\n\r\n    const handleCameraChoice = () => {\r\n        setShowScanModal(false)\r\n        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent)\r\n\r\n        if (isMobile) {\r\n            if (cameraInputRef.current) cameraInputRef.current.click()\r\n        } else {\r\n            setShowWebCamera(true)\r\n        }\r\n    }\r\n\r\n    const handleGalleryChoice = () => {\r\n        setShowScanModal(false)\r\n        if (galleryInputRef.current) galleryInputRef.current.click()\r\n    }\r\n\r\n    const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0]\r\n        if (!file) return\r\n        processScannedFile(file)\r\n    }\r\n\r\n    const handleWebCapture = (file: File) => {\r\n        setShowWebCamera(false)\r\n        processScannedFile(file)\r\n    }\r\n\r\n    const processScannedFile = async (file: File) => {\r\n        setIsScanning(true)\r\n        try {\r\n            const result = await analyzeImage(file)\r\n            setScannedData(result)\r\n            setIsAddingMode(true)\r\n\r\n            if (result.name !== \"Identified Food\") {\r\n                toast.success(\"Meal Scanned!\", {\r\n                    description: `Identified as ${result.name} with ${result.calories} Cal.`\r\n                })\r\n            }\r\n        } catch (error: any) {\r\n            console.error(\"Scan failed\", error)\r\n            toast.error(\"Scan Failed\", {\r\n                description: error.message || \"Could not analyze the image. Please try again.\"\r\n            })\r\n        } finally {\r\n            setIsScanning(false)\r\n            if (cameraInputRef.current) cameraInputRef.current.value = ''\r\n            if (galleryInputRef.current) galleryInputRef.current.value = ''\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6 pt-6 pb-20 relative\">\r\n            {/* Background Blob */}\r\n            <div className=\"absolute -top-20 -left-20 w-80 h-80 bg-orange-500/5 dark:bg-orange-400/5 rounded-full blur-3xl -z-10 animate-blob\"></div>\r\n            <div className=\"absolute top-1/2 -right-20 w-80 h-80 bg-rose-500/5 dark:bg-rose-400/5 rounded-full blur-3xl -z-10 animate-blob animation-delay-2000\"></div>\r\n\r\n            {/* Daily Summary Header */}\r\n            <div className=\"glass-dark p-6 rounded-3xl text-white overflow-hidden relative\">\r\n                <div className=\"absolute bottom-0 left-0 w-32 h-32 bg-orange-500/10 rounded-full blur-2xl -z-10\"></div>\r\n                <div className=\"flex justify-between items-end mb-4 relative z-10\">\r\n                    <div>\r\n                        <div className=\"text-[10px] text-slate-400 font-black uppercase tracking-widest mb-1.5\">Intake Status</div>\r\n                        <div className=\"text-3xl font-black\">\r\n                            {dailyTotal} <span className=\"text-sm font-medium text-slate-500\">/ {target} kcal</span>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"text-right\">\r\n                        <div className=\"text-[10px] text-slate-400 font-black uppercase tracking-widest mb-1.5\">Remaining</div>\r\n                        <div className=\"text-xl font-black text-orange-400\">{target - dailyTotal}</div>\r\n                    </div>\r\n                </div>\r\n                {/* Progress Bar */}\r\n                <div className=\"h-2 w-full bg-slate-800/50 rounded-full overflow-hidden\">\r\n                    <div\r\n                        className={cn(\"h-full rounded-full transition-all duration-1000 bg-gradient-to-r from-orange-500 to-rose-500\", progress > 100 ? \"from-red-500 to-rose-600\" : \"\")}\r\n                        style={{ width: `${progress}%` }}\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            {/* Tabs - Glass Pill */}\r\n            <div className=\"grid grid-cols-4 gap-2 p-1.5 glass rounded-2xl\">\r\n                {TABS.map(tab => (\r\n                    <button\r\n                        key={tab}\r\n                        onClick={() => {\r\n                            setActiveTab(tab)\r\n                            setIsAddingMode(false)\r\n                            setScannedData(undefined)\r\n                        }}\r\n                        className={cn(\r\n                            \"py-2 text-[10px] font-black uppercase tracking-tighter rounded-xl transition-all whitespace-nowrap flex flex-col items-center justify-center gap-0.5 min-h-[44px]\",\r\n                            activeTab === tab\r\n                                ? \"glass bg-white dark:bg-slate-800 text-orange-600 dark:text-orange-400 shadow-md scale-[1.02]\"\r\n                                : \"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200\"\r\n                        )}\r\n                    >\r\n                        <span>{tab}</span>\r\n                        {(() => {\r\n                            const tabTotal = logs?.entries\r\n                                .filter(e => e.mealType === tab)\r\n                                .reduce((acc, e) => acc + e.calories, 0) || 0;\r\n                            return tabTotal > 0 ? (\r\n                                <span className=\"text-[8px] opacity-70 font-bold\">{tabTotal} cal</span>\r\n                            ) : null;\r\n                        })()}\r\n                    </button>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Content Area */}\r\n            <div className=\"space-y-5 min-h-[300px]\">\r\n                {/* Hidden Inputs */}\r\n                <input\r\n                    type=\"file\"\r\n                    ref={cameraInputRef}\r\n                    className=\"hidden\"\r\n                    accept=\"image/*\"\r\n                    capture=\"environment\"\r\n                    onChange={handleFileChange}\r\n                />\r\n                <input\r\n                    type=\"file\"\r\n                    ref={galleryInputRef}\r\n                    className=\"hidden\"\r\n                    accept=\"image/*\"\r\n                    onChange={handleFileChange}\r\n                />\r\n\r\n                {isAddingMode ? (\r\n                    <div className=\"animate-in fade-in slide-in-from-bottom-4 duration-300\">\r\n                        <AddFoodForm\r\n                            mealType={activeTab}\r\n                            initialValues={scannedData}\r\n                            onClose={() => {\r\n                                setIsAddingMode(false)\r\n                                setScannedData(undefined)\r\n                            }}\r\n                            onSubmit={handleAddEntry}\r\n                        />\r\n                    </div>\r\n                ) : (\r\n                    <>\r\n                        <div className=\"grid grid-cols-2 gap-4\">\r\n                            <button\r\n                                onClick={() => setIsAddingMode(true)}\r\n                                className=\"glass p-5 rounded-3xl flex flex-col items-center justify-center gap-3 hover:scale-[1.02] active:scale-[0.98] transition-all group\"\r\n                            >\r\n                                <div className=\"p-3 bg-orange-100 dark:bg-orange-950/30 text-orange-600 dark:text-orange-400 rounded-2xl group-hover:scale-110 group-hover:bg-orange-500 group-hover:text-white transition-all\">\r\n                                    <Plus size={24} />\r\n                                </div>\r\n                                <span className=\"text-xs font-black uppercase tracking-widest text-slate-600 dark:text-slate-300\">Quick Log</span>\r\n                            </button>\r\n\r\n                            <button\r\n                                onClick={handleScanClick}\r\n                                disabled={isScanning}\r\n                                className=\"glass p-5 rounded-3xl flex flex-col items-center justify-center gap-3 hover:scale-[1.02] active:scale-[0.98] transition-all group disabled:opacity-50\"\r\n                            >\r\n                                <div className=\"p-3 bg-indigo-100 dark:bg-indigo-950/30 text-indigo-600 dark:text-indigo-400 rounded-2xl group-hover:scale-110 group-hover:bg-indigo-500 group-hover:text-white transition-all\">\r\n                                    {isScanning ? <Loader2 size={24} className=\"animate-spin\" /> : <Camera size={24} />}\r\n                                </div>\r\n                                <span className=\"text-xs font-black uppercase tracking-widest text-slate-600 dark:text-slate-300\">AI Scan</span>\r\n                            </button>\r\n                        </div>\r\n\r\n                        {/* List - Entries */}\r\n                        <div className=\"space-y-4 pt-2\">\r\n                            <div className=\"flex items-center gap-2 px-1\">\r\n                                <div className=\"w-1.5 h-6 bg-orange-500 rounded-full\"></div>\r\n                                <h3 className=\"font-black text-slate-800 dark:text-white uppercase tracking-tight text-sm\">{activeTab} History</h3>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-3\">\r\n                                {entries.length === 0 ? (\r\n                                    <div className=\"text-center py-16 glass rounded-3xl text-slate-400 border-2 border-dashed border-slate-100 dark:border-slate-800/50\">\r\n                                        <div className=\"mb-2 flex justify-center opacity-20\"><Plus size={40} /></div>\r\n                                        <p className=\"text-sm font-medium\">Nothing logged yet</p>\r\n                                    </div>\r\n                                ) : (\r\n                                    entries.map(entry => (\r\n                                        <div key={entry.id} className=\"glass p-4 rounded-3xl flex justify-between items-center hover:scale-[1.01] transition-transform group\">\r\n                                            <div className=\"flex items-center gap-4\">\r\n                                                <div className=\"relative\">\r\n                                                    <div className=\"w-12 h-12 bg-orange-50 dark:bg-orange-950/30 text-orange-600 dark:text-orange-400 rounded-2xl flex items-center justify-center font-black\">\r\n                                                        {entry.name.charAt(0)}\r\n                                                    </div>\r\n                                                    {entry.healthScore && (\r\n                                                        <div className={cn(\r\n                                                            \"absolute -top-1 -right-1 w-5 h-5 rounded-full flex items-center justify-center text-[8px] font-black text-white border-2 border-white dark:border-slate-900\",\r\n                                                            entry.healthScore >= 8 ? \"bg-emerald-500\" :\r\n                                                                entry.healthScore >= 5 ? \"bg-amber-500\" :\r\n                                                                    \"bg-rose-500\"\r\n                                                        )}>\r\n                                                            {entry.healthScore}\r\n                                                        </div>\r\n                                                    )}\r\n                                                </div>\r\n                                                <div>\r\n                                                    <div className=\"font-black text-slate-800 dark:text-white leading-tight\">{entry.name}</div>\r\n                                                    <div className=\"text-[10px] text-slate-400 font-bold uppercase tracking-tighter mt-1\">\r\n                                                        P: {entry.protein}g • C: {entry.carbs}g • F: {entry.fat}g\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <div className=\"text-right\">\r\n                                                    <div className=\"font-black text-slate-800 dark:text-slate-200\">{entry.calories}</div>\r\n                                                    <div className=\"text-[8px] text-slate-400 font-black uppercase\">kcal</div>\r\n                                                </div>\r\n                                                <button\r\n                                                    onClick={() => {\r\n                                                        setScannedData(entry)\r\n                                                        setIsAddingMode(true)\r\n                                                    }}\r\n                                                    className=\"p-2.5 text-slate-400 hover:text-orange-500 dark:text-slate-500 dark:hover:text-orange-400 bg-slate-50 dark:bg-slate-950 rounded-xl transition-all\"\r\n                                                >\r\n                                                    <Pencil size={14} />\r\n                                                </button>\r\n                                                <button\r\n                                                    onClick={() => removeEntry(today, entry.id)}\r\n                                                    className=\"p-2.5 text-slate-400 hover:text-red-500 dark:text-slate-500 dark:hover:text-red-400 bg-slate-50 dark:bg-slate-950 rounded-xl transition-all\"\r\n                                                >\r\n                                                    <Trash2 size={14} />\r\n                                                </button>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </>\r\n                )}\r\n            </div>\r\n\r\n            {/* Custom Camera Modal for Desktop */}\r\n            {showWebCamera && (\r\n                <CameraCapture\r\n                    onCapture={handleWebCapture}\r\n                    onClose={() => setShowWebCamera(false)}\r\n                />\r\n            )}\r\n\r\n            {/* Scan Options Modal */}\r\n            {showScanModal && (\r\n                <div className=\"fixed inset-0 bg-slate-950/60 backdrop-blur-sm z-[100] flex items-end sm:items-center justify-center p-4\">\r\n                    <div className=\"w-full max-w-sm glass-dark rounded-[2.5rem] overflow-hidden shadow-2xl animate-in slide-in-from-bottom-8 duration-300\">\r\n                        <div className=\"p-8 space-y-6\">\r\n                            <div className=\"flex justify-between items-center\">\r\n                                <h3 className=\"text-2xl font-black text-white tracking-tight\">AI Food Scan</h3>\r\n                                <button onClick={() => setShowScanModal(false)} className=\"text-slate-500 hover:text-white transition-colors\">\r\n                                    <X size={24} />\r\n                                </button>\r\n                            </div>\r\n                            <div className=\"grid grid-cols-1 gap-4 pt-2\">\r\n                                <button\r\n                                    onClick={handleCameraChoice}\r\n                                    className=\"flex items-center gap-5 p-5 rounded-[1.5rem] bg-white/5 hover:bg-white/10 text-white transition-all border border-white/10 group\"\r\n                                >\r\n                                    <div className=\"w-14 h-14 rounded-2xl bg-orange-500 text-white flex items-center justify-center shadow-lg shadow-orange-500/20 group-hover:scale-110 transition-transform\">\r\n                                        <Camera size={28} />\r\n                                    </div>\r\n                                    <div className=\"text-left\">\r\n                                        <div className=\"font-black text-lg\">Snap Photo</div>\r\n                                        <div className=\"text-[10px] text-slate-400 font-bold uppercase tracking-widest\">Live identification</div>\r\n                                    </div>\r\n                                </button>\r\n\r\n                                <button\r\n                                    onClick={handleGalleryChoice}\r\n                                    className=\"flex items-center gap-5 p-5 rounded-[1.5rem] bg-white/5 hover:bg-white/10 text-white transition-all border border-white/10 group\"\r\n                                >\r\n                                    <div className=\"w-14 h-14 rounded-2xl bg-indigo-500 text-white flex items-center justify-center shadow-lg shadow-indigo-500/20 group-hover:scale-110 transition-transform\">\r\n                                        <Plus size={28} />\r\n                                    </div>\r\n                                    <div className=\"text-left\">\r\n                                        <div className=\"font-black text-lg\">Pick Image</div>\r\n                                        <div className=\"text-[10px] text-slate-400 font-bold uppercase tracking-widest\">From your gallery</div>\r\n                                    </div>\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\pages\\MedicineMode.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1504,1507],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1504,1507],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":87,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3711,3714],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3711,3714],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":107,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4414,4417],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4414,4417],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":131,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":131,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":151,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":151,"endColumn":19}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { useState, useRef, useEffect } from 'react'\r\nimport { format } from 'date-fns'\r\nimport { Card } from '../components/ui/Card'\r\nimport { Button } from '../components/ui/Button'\r\nimport { Pill, Plus, Trash2, Bell, Clock, ArrowLeft, ChevronRight, Settings, Search, Camera, Loader2, X, Upload, Calendar, CheckCircle, Copy } from 'lucide-react'\r\nimport { cn } from '../lib/utils'\r\nimport { useAppStore } from '../store/useAppStore'\r\nimport { toast } from 'sonner'\r\nimport { Link } from 'react-router-dom'\r\nimport { searchMedicine, analyzeMedicineImage, type ScannedMedicine } from '../services/medicine'\r\nimport { CameraCapture } from '../components/log/CameraCapture'\r\n\r\nexport default function MedicineMode() {\r\n    const reminders = useAppStore(state => state.reminders || [])\r\n    const addReminder = useAppStore(state => state.addReminder)\r\n    const removeReminder = useAppStore(state => state.removeReminder)\r\n    const clearAllReminders = useAppStore(state => state.clearAllReminders)\r\n    const medicineMode = useAppStore(state => state.medicineMode)\r\n    const toggleMedicineMode = useAppStore(state => state.toggleMedicineMode)\r\n\r\n    const [isAdding, setIsAdding] = useState(false)\r\n    const [name, setName] = useState('')\r\n    const [time, setTime] = useState('09:00')\r\n    const [notes, setNotes] = useState('')\r\n\r\n    const [isSearching, setIsSearching] = useState(false)\r\n    const [searchQuery, setSearchQuery] = useState('')\r\n    const [searchResults, setSearchResults] = useState<any[]>([])\r\n    const [isScanning, setIsScanning] = useState(false)\r\n    const [showCamera, setShowCamera] = useState(false)\r\n    const [scanResults, setScanResults] = useState<ScannedMedicine[]>([])\r\n    const fileInputRef = useRef<HTMLInputElement>(null)\r\n\r\n    // Mark as Taken State\r\n    const today = format(new Date(), 'yyyy-MM-dd')\r\n    const [takenReminders, setTakenReminders] = useState<Record<string, string>>(() => {\r\n        const saved = localStorage.getItem(`medicine-taken-${today}`)\r\n        return saved ? JSON.parse(saved) : {}\r\n    })\r\n\r\n    // Persistence and Reset logic\r\n    useEffect(() => {\r\n        localStorage.setItem(`medicine-taken-${today}`, JSON.stringify(takenReminders))\r\n    }, [takenReminders, today])\r\n\r\n    useEffect(() => {\r\n        const checkMidnight = () => {\r\n            const lastDate = localStorage.getItem('medicine-last-date')\r\n            if (lastDate && lastDate !== today) {\r\n                // It's a new day! Clear old data\r\n                setTakenReminders({})\r\n                // Optionally clear historical keys if they pile up\r\n                Object.keys(localStorage).forEach(key => {\r\n                    if (key.startsWith('medicine-taken-') && key !== `medicine-taken-${today}`) {\r\n                        localStorage.removeItem(key)\r\n                    }\r\n                })\r\n            }\r\n            localStorage.setItem('medicine-last-date', today)\r\n        }\r\n        checkMidnight()\r\n        // Check every minute for day change\r\n        const interval = setInterval(checkMidnight, 60000)\r\n        return () => clearInterval(interval)\r\n    }, [today])\r\n\r\n    const handleMarkTaken = (id: string) => {\r\n        const now = format(new Date(), 'HH:mm')\r\n        setTakenReminders(prev => ({\r\n            ...prev,\r\n            [id]: now\r\n        }))\r\n        toast.success(\"Medicine marked as taken! 💊\")\r\n    }\r\n\r\n    const handleSearch = async (query: string) => {\r\n        setSearchQuery(query)\r\n        if (query.length > 2) {\r\n            const results = await searchMedicine(query)\r\n            setSearchResults(results)\r\n        } else {\r\n            setSearchResults([])\r\n        }\r\n    }\r\n\r\n    const handleSelectMedicine = (med: any) => {\r\n        setName(med.name)\r\n        setNotes(med.purpose)\r\n        setIsSearching(false)\r\n        setIsAdding(true)\r\n    }\r\n\r\n    const handleScan = async (file: File) => {\r\n        setIsScanning(true)\r\n        setShowCamera(false)\r\n        try {\r\n            const results = await analyzeMedicineImage(file)\r\n            if (results.length > 0) {\r\n                setScanResults(results)\r\n                setIsAdding(false) // Close single add if open\r\n                setIsSearching(false)\r\n                toast.success(`Identified ${results.length} medications!`)\r\n            } else {\r\n                toast.error(\"No medications found in the image.\")\r\n            }\r\n        } catch (e: any) {\r\n            toast.error(\"Scan failed: \" + e.message)\r\n        } finally {\r\n            setIsScanning(false)\r\n        }\r\n    }\r\n\r\n    const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0]\r\n        if (file) {\r\n            handleScan(file)\r\n        }\r\n    }\r\n\r\n    const handleConfirmScanned = async (med: ScannedMedicine) => {\r\n        try {\r\n            await addReminder({\r\n                medicineName: med.name,\r\n                time: med.time,\r\n                notes: med.notes || '',\r\n                enabled: true\r\n            })\r\n            setScanResults(prev => prev.filter(m => m !== med))\r\n            toast.success(`${med.name} added!`)\r\n        } catch (e) {\r\n            toast.error(\"Failed to add reminder\")\r\n        }\r\n    }\r\n\r\n    const handleAdd = async (e: React.FormEvent) => {\r\n        e.preventDefault()\r\n        if (!name) return\r\n\r\n        try {\r\n            await addReminder({\r\n                medicineName: name,\r\n                time,\r\n                notes,\r\n                enabled: true\r\n            })\r\n            setName('')\r\n            setNotes('')\r\n            setIsAdding(false)\r\n            toast.success(\"Reminder added!\")\r\n        } catch (e) {\r\n            toast.error(\"Failed to add reminder\")\r\n        }\r\n    }\r\n\r\n    const scheduleTestNotification = async () => {\r\n        if (!(\"Notification\" in window)) {\r\n            toast.error(\"Notifications not supported\")\r\n            return\r\n        }\r\n        if (Notification.permission !== \"granted\") {\r\n            const perm = await Notification.requestPermission()\r\n            if (perm !== \"granted\") {\r\n                toast.error(\"Permission denied\")\r\n                return\r\n            }\r\n        }\r\n        const supports = 'showTrigger' in Notification.prototype && 'serviceWorker' in navigator\r\n        if (!supports) {\r\n            toast.info(\"Scheduled notifications not supported on this device\")\r\n            return\r\n        }\r\n        const reg = await navigator.serviceWorker.getRegistration()\r\n        if (!reg) {\r\n            toast.error(\"Service worker not registered\")\r\n            return\r\n        }\r\n        type TimestampTriggerCtor = new (timestamp: number) => object\r\n        const Trigger = (window as unknown as { TimestampTrigger?: TimestampTriggerCtor }).TimestampTrigger\r\n        if (!Trigger) {\r\n            toast.info(\"No trigger support found\")\r\n            return\r\n        }\r\n        const fireAt = Date.now() + 30_000\r\n        await reg.showNotification(\"Test: Medicine alert\", {\r\n            body: \"This is a scheduled test in 30s\",\r\n            icon: '/pwa-192x192.png',\r\n            tag: `test-${fireAt}`,\r\n            showTrigger: new Trigger(fireAt)\r\n        } as NotificationOptions)\r\n        toast.success(\"Test scheduled in 30 seconds\")\r\n    }\r\n\r\n    const copyToClipboard = (medicineName: string, time: string, notes: string) => {\r\n        const text = `Medicine Reminder: ${medicineName} at ${time}${notes ? ` (${notes})` : ''}`\r\n        navigator.clipboard.writeText(text)\r\n        toast.success(\"Schedule copied to clipboard! 📋\")\r\n    }\r\n\r\n    // Task 6.2 — Group reminders by time of day\r\n    const groupedReminders = reminders.slice().sort((a, b) => a.time.localeCompare(b.time)).reduce((acc, r) => {\r\n        const [hour] = r.time.split(':').map(Number)\r\n        let group: 'Morning' | 'Afternoon' | 'Evening' = 'Morning'\r\n        if (hour >= 12 && hour < 18) group = 'Afternoon'\r\n        else if (hour >= 18) group = 'Evening'\r\n\r\n        if (!acc[group]) acc[group] = []\r\n        acc[group].push(r)\r\n        return acc\r\n    }, {} as Record<string, typeof reminders>)\r\n\r\n    const GROUPS: ('Morning' | 'Afternoon' | 'Evening')[] = ['Morning', 'Afternoon', 'Evening']\r\n\r\n    const downloadICS = (medicineName: string, time: string, notes: string) => {\r\n        const now = new Date()\r\n        const [h, m] = time.split(':').map(Number)\r\n        const start = new Date()\r\n        start.setHours(h, m, 0, 0)\r\n        if (start.getTime() < Date.now() - 60_000) {\r\n            start.setDate(start.getDate() + 1)\r\n        }\r\n        const toUTC = (d: Date) => {\r\n            const yyyy = d.getUTCFullYear()\r\n            const MM = String(d.getUTCMonth() + 1).padStart(2, '0')\r\n            const dd = String(d.getUTCDate()).padStart(2, '0')\r\n            const HH = String(d.getUTCHours()).padStart(2, '0')\r\n            const mm = String(d.getUTCMinutes()).padStart(2, '0')\r\n            const ss = String(d.getUTCSeconds()).padStart(2, '0')\r\n            return `${yyyy}${MM}${dd}T${HH}${mm}${ss}Z`\r\n        }\r\n        const uid = `${Date.now()}-${Math.random().toString(36).slice(2)}@healthcomp`\r\n        const ics = [\r\n            'BEGIN:VCALENDAR',\r\n            'VERSION:2.0',\r\n            'PRODID:-//HealthComp//EN',\r\n            'BEGIN:VEVENT',\r\n            `UID:${uid}`,\r\n            `DTSTAMP:${toUTC(now)}`,\r\n            `DTSTART:${toUTC(start)}`,\r\n            `SUMMARY:Take ${medicineName}`,\r\n            `DESCRIPTION:${notes || ''}`,\r\n            'RRULE:FREQ=DAILY;INTERVAL=1',\r\n            'END:VEVENT',\r\n            'END:VCALENDAR'\r\n        ].join('\\r\\n')\r\n        const blob = new Blob([ics], { type: 'text/calendar;charset=utf-8' })\r\n        const url = URL.createObjectURL(blob)\r\n        const a = document.createElement('a')\r\n        a.href = url\r\n        a.download = `${medicineName.replace(/\\s+/g, '_')}.ics`\r\n        document.body.appendChild(a)\r\n        a.click()\r\n        a.remove()\r\n        URL.revokeObjectURL(url)\r\n        toast.success(\"Calendar file downloaded\")\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6 pt-6 pb-24 px-1\">\r\n            <header className=\"flex items-center gap-4 mb-8\">\r\n                <Link to=\"/\" className=\"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl transition-colors\">\r\n                    <ArrowLeft size={20} />\r\n                </Link>\r\n                <div className=\"flex items-center gap-3\">\r\n                    <div className=\"p-2.5 bg-rose-500 text-white rounded-xl shadow-lg shadow-rose-500/20\">\r\n                        <Pill size={20} />\r\n                    </div>\r\n                    <div>\r\n                        <h1 className=\"text-2xl font-black text-slate-800 dark:text-white leading-tight\">Medicine Hub</h1>\r\n                        <p className=\"text-xs text-slate-500 font-medium\">Manage your daily schedule</p>\r\n                    </div>\r\n                </div>\r\n            </header>\r\n\r\n            <div className=\"glass p-6 rounded-[2.5rem] bg-gradient-to-br from-rose-500/10 to-orange-500/10 border-rose-100/50 dark:border-rose-900/20\">\r\n                <div className=\"flex items-center justify-between mb-6\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"w-12 h-12 bg-rose-500 text-white rounded-2xl flex items-center justify-center shadow-lg shadow-rose-500/20\">\r\n                            <Bell size={24} />\r\n                        </div>\r\n                        <div>\r\n                            <div className=\"font-black text-slate-800 dark:text-white\">Smart Alerts</div>\r\n                            <div className=\"text-[10px] text-slate-500 font-bold uppercase tracking-widest\">Notification Service</div>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <button\r\n                            onClick={scheduleTestNotification}\r\n                            className=\"p-2 glass rounded-xl text-rose-600 dark:text-rose-400 hover:bg-rose-50 dark:hover:bg-rose-950/30 transition-all\"\r\n                            title=\"Test Notification\"\r\n                        >\r\n                            <Bell size={18} />\r\n                        </button>\r\n                        <button\r\n                            onClick={() => {\r\n                                toggleMedicineMode()\r\n                                if (!medicineMode && \"Notification\" in window) {\r\n                                    Notification.requestPermission()\r\n                                }\r\n                            }}\r\n                            className={`w-14 h-7 rounded-full transition-colors relative p-1 ${medicineMode ? 'bg-rose-500' : 'bg-slate-200 dark:bg-slate-800'}`}\r\n                        >\r\n                            <div className={`w-5 h-5 bg-white rounded-full shadow-sm transition-transform ${medicineMode ? 'translate-x-7' : 'translate-x-0'}`} />\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n                {!medicineMode && (\r\n                    <div className=\"p-3 bg-rose-50 dark:bg-rose-950/30 rounded-2xl flex items-center gap-3 border border-rose-100 dark:border-rose-900/50\">\r\n                        <Settings size={16} className=\"text-rose-500\" />\r\n                        <p className=\"text-[11px] text-rose-600 dark:text-rose-400 font-bold\">Alerts are currently disabled</p>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"flex items-center justify-between px-1\">\r\n                <h3 className=\"font-black text-slate-800 dark:text-white uppercase tracking-tight text-sm\">Your Schedule</h3>\r\n                <div className=\"flex items-center gap-2\">\r\n                    <button\r\n                        onClick={() => setIsSearching(!isSearching)}\r\n                        className={`p-2 glass rounded-xl transition-all ${isSearching ? 'bg-indigo-500 text-white border-indigo-500' : 'text-slate-600 dark:text-slate-400 hover:text-indigo-500'}`}\r\n                        title=\"Manual Database Search\"\r\n                    >\r\n                        <Search size={18} />\r\n                    </button>\r\n\r\n                    <input\r\n                        type=\"file\"\r\n                        ref={fileInputRef}\r\n                        onChange={handleFileUpload}\r\n                        accept=\"image/*\"\r\n                        className=\"hidden\"\r\n                    />\r\n\r\n                    <button\r\n                        onClick={() => fileInputRef.current?.click()}\r\n                        disabled={isScanning}\r\n                        className=\"p-2 glass rounded-xl text-indigo-600 dark:text-indigo-400 hover:bg-indigo-50 dark:hover:bg-indigo-950/30 transition-all flex items-center gap-2 disabled:opacity-50\"\r\n                        title=\"Upload Prescription\"\r\n                    >\r\n                        {isScanning ? <Loader2 size={18} className=\"animate-spin\" /> : <Upload size={18} />}\r\n                    </button>\r\n\r\n                    <button\r\n                        onClick={() => setShowCamera(true)}\r\n                        disabled={isScanning}\r\n                        className=\"p-2 glass rounded-xl text-rose-600 dark:text-rose-400 hover:bg-rose-50 dark:hover:bg-rose-950/30 transition-all flex items-center gap-2 disabled:opacity-50\"\r\n                        title=\"AI Camera Scan\"\r\n                    >\r\n                        {isScanning ? <Loader2 size={18} className=\"animate-spin\" /> : <Camera size={18} />}\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setIsAdding(true)}\r\n                        className=\"flex items-center gap-2 px-4 py-2 bg-slate-900 dark:bg-white text-white dark:text-black rounded-xl text-[10px] font-black uppercase tracking-widest hover:scale-105 transition-transform\"\r\n                    >\r\n                        <Plus size={14} /> Add New\r\n                    </button>\r\n                    {reminders.length > 0 && (\r\n                        <button\r\n                            onClick={async () => {\r\n                                const ok = window.confirm('Are you sure? This will permanently delete all your medicine reminders.')\r\n                                if (ok) {\r\n                                    await clearAllReminders()\r\n                                    toast.success('All reminders cleared')\r\n                                }\r\n                            }}\r\n                            className=\"p-2 glass rounded-xl text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 transition-all\"\r\n                            title=\"Clear All Reminders\"\r\n                        >\r\n                            <Trash2 size={18} />\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {isSearching && (\r\n                <div className=\"space-y-4 animate-in slide-in-from-top-2 duration-200\">\r\n                    <div className=\"relative\">\r\n                        <input\r\n                            value={searchQuery}\r\n                            onChange={(e) => handleSearch(e.target.value)}\r\n                            placeholder=\"Search medicine database...\"\r\n                            className=\"w-full p-4 pl-12 glass rounded-2xl focus:ring-2 focus:ring-rose-500/30 outline-none font-bold text-sm bg-white dark:bg-slate-900\"\r\n                            autoFocus\r\n                        />\r\n                        <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400\" size={18} />\r\n                        {searchQuery && (\r\n                            <button onClick={() => handleSearch('')} className=\"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-rose-500 transition-colors\">\r\n                                <X size={18} />\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                    {searchResults.length > 0 && (\r\n                        <div className=\"glass rounded-2xl overflow-hidden divide-y divide-slate-100 dark:divide-slate-800 bg-white/50 dark:bg-slate-900/50 backdrop-blur-md\">\r\n                            {searchResults.map((result, idx) => (\r\n                                <button\r\n                                    key={idx}\r\n                                    onClick={() => handleSelectMedicine(result)}\r\n                                    className=\"w-full p-4 text-left hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors group\"\r\n                                >\r\n                                    <div className=\"font-black text-slate-800 dark:text-white group-hover:text-rose-500 transition-colors\">{result.name}</div>\r\n                                    <div className=\"text-[10px] text-slate-500 dark:text-slate-400 font-bold uppercase tracking-widest mt-1 line-clamp-1\">{result.purpose}</div>\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {scanResults.length > 0 && (\r\n                <div className=\"space-y-4 animate-in slide-in-from-bottom-4 duration-300\">\r\n                    <div className=\"flex items-center justify-between px-1\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <div className=\"w-1.5 h-6 bg-indigo-500 rounded-full\"></div>\r\n                            <h3 className=\"font-black text-slate-800 dark:text-white uppercase tracking-tight text-sm\">Review Scan Results</h3>\r\n                        </div>\r\n                        <button onClick={() => setScanResults([])} className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest hover:text-rose-500 transition-colors\">Clear All</button>\r\n                    </div>\r\n                    <div className=\"grid gap-3\">\r\n                        {scanResults.map((med, idx) => (\r\n                            <div key={idx} className=\"glass dark:bg-slate-900 p-4 rounded-3xl border-indigo-500/20 flex items-center justify-between\">\r\n                                <div className=\"space-y-1\">\r\n                                    <div className=\"font-black text-slate-800 dark:text-white flex items-center gap-2\">\r\n                                        {med.name}\r\n                                        <span className=\"text-[10px] bg-indigo-100 dark:bg-indigo-950/50 text-indigo-600 dark:text-indigo-400 px-2 py-0.5 rounded-full font-bold uppercase\">{med.time}</span>\r\n                                    </div>\r\n                                    <div className=\"text-[10px] text-slate-500 dark:text-slate-400 font-bold italic line-clamp-1\">{med.notes}</div>\r\n                                </div>\r\n                                <button\r\n                                    onClick={() => handleConfirmScanned(med)}\r\n                                    className=\"p-3 bg-indigo-500 text-white rounded-xl shadow-lg shadow-indigo-500/20 active:scale-95 transition-transform\"\r\n                                >\r\n                                    <Plus size={18} />\r\n                                </button>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {isAdding && (\r\n                <Card className=\"p-6 rounded-[2rem] border-none shadow-2xl animate-in fade-in slide-in-from-top-4 duration-300\">\r\n                    <form onSubmit={handleAdd} className=\"space-y-4\">\r\n                        <div className=\"space-y-1.5\">\r\n                            <label className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest px-1\">Medicine Name</label>\r\n                            <input\r\n                                value={name} onChange={e => setName(e.target.value)}\r\n                                placeholder=\"e.g. Daily Multivitamin\"\r\n                                className=\"w-full p-4 bg-slate-50 dark:bg-slate-950 border border-slate-100 dark:border-slate-800 rounded-2xl focus:outline-none focus:ring-2 focus:ring-rose-500/30 font-bold text-sm\"\r\n                                autoFocus\r\n                            />\r\n                        </div>\r\n                        <div className=\"space-y-1.5\">\r\n                            <label className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest px-1\">Time</label>\r\n                            <input\r\n                                type=\"time\"\r\n                                value={time} onChange={e => setTime(e.target.value)}\r\n                                className=\"w-full p-4 bg-slate-50 dark:bg-slate-950 border border-slate-100 dark:border-slate-800 rounded-2xl focus:outline-none focus:ring-2 focus:ring-rose-500/30 font-bold text-sm\"\r\n                            />\r\n                        </div>\r\n                        <div className=\"space-y-1.5\">\r\n                            <label className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest px-1\">Optional Notes</label>\r\n                            <input\r\n                                value={notes} onChange={e => setNotes(e.target.value)}\r\n                                placeholder=\"e.g. Take with food\"\r\n                                className=\"w-full p-4 bg-slate-50 dark:bg-slate-950 border border-slate-100 dark:border-slate-800 rounded-2xl focus:outline-none focus:ring-2 focus:ring-rose-500/30 font-bold text-sm\"\r\n                            />\r\n                        </div>\r\n                        <div className=\"flex gap-3 pt-2\">\r\n                            <Button type=\"button\" variant=\"outline\" fullWidth onClick={() => setIsAdding(false)} className=\"rounded-xl font-bold border-none bg-slate-100 dark:bg-slate-800\">Cancel</Button>\r\n                            <Button type=\"submit\" fullWidth className=\"rounded-xl font-bold bg-rose-500 hover:bg-rose-600 text-white shadow-lg shadow-rose-500/20\">Save Reminder</Button>\r\n                        </div>\r\n                    </form>\r\n                </Card>\r\n            )}\r\n\r\n            <div className=\"space-y-8\">\r\n                {reminders.length === 0 ? (\r\n                    <div className=\"text-center py-12 glass rounded-[2.5rem] border-dashed border-2 border-slate-100 dark:border-slate-800/50\">\r\n                        <div className=\"w-16 h-16 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4 text-slate-300\">\r\n                            <Pill size={32} />\r\n                        </div>\r\n                        <p className=\"text-sm font-bold text-slate-400 uppercase tracking-widest px-8\">No active reminders in your schedule</p>\r\n                    </div>\r\n                ) : (\r\n                    GROUPS.map(group => {\r\n                        const items = groupedReminders[group]\r\n                        if (!items || items.length === 0) return null\r\n\r\n                        return (\r\n                            <div key={group} className=\"space-y-4\">\r\n                                <div className=\"sticky top-0 z-10 py-2 glass bg-white/80 dark:bg-slate-950/80 backdrop-blur-md px-4 rounded-2xl inline-block border border-slate-100 dark:border-slate-800\">\r\n                                    <h4 className=\"text-[10px] font-black uppercase tracking-[0.2em] text-rose-500\">{group}</h4>\r\n                                </div>\r\n\r\n                                <div className=\"grid gap-3\">\r\n                                    {items.map(reminder => {\r\n                                        const takenTime = takenReminders[reminder.id]\r\n                                        return (\r\n                                            <div\r\n                                                key={reminder.id}\r\n                                                className={cn(\r\n                                                    \"glass p-5 rounded-3xl flex items-center justify-between group transition-all duration-300\",\r\n                                                    takenTime ? \"opacity-60 bg-emerald-50/10 dark:bg-emerald-950/5 border-emerald-100/50 dark:border-emerald-900/20\" : \"hover:scale-[1.01]\"\r\n                                                )}\r\n                                            >\r\n                                                <div className=\"flex items-center gap-4\">\r\n                                                    <button\r\n                                                        onClick={() => !takenTime && handleMarkTaken(reminder.id)}\r\n                                                        className={cn(\r\n                                                            \"w-12 h-12 rounded-2xl flex items-center justify-center transition-all shadow-sm border\",\r\n                                                            takenTime\r\n                                                                ? \"bg-emerald-500 text-white border-emerald-400\"\r\n                                                                : \"bg-white dark:bg-slate-800 text-slate-400 dark:text-slate-500 border-slate-100 dark:border-slate-700 hover:border-emerald-500 hover:text-emerald-500\"\r\n                                                        )}\r\n                                                    >\r\n                                                        {takenTime ? <CheckCircle size={24} /> : <Clock size={20} />}\r\n                                                    </button>\r\n                                                    <div>\r\n                                                        <div className={cn(\"font-black text-slate-800 dark:text-white transition-all\", takenTime && \"line-through text-slate-400\")}>\r\n                                                            {reminder.medicineName}\r\n                                                        </div>\r\n                                                        <div className=\"flex items-center gap-2\">\r\n                                                            <span className={cn(\"text-xs font-black\", takenTime ? \"text-emerald-500\" : \"text-rose-500\")}>\r\n                                                                {takenTime ? `Taken at ${takenTime}` : reminder.time}\r\n                                                            </span>\r\n                                                            {reminder.notes && <span className=\"text-[10px] text-slate-400 font-medium whitespace-nowrap overflow-hidden text-ellipsis max-w-[150px]\">• {reminder.notes}</span>}\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n                                                <div className=\"flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                                    <button\r\n                                                        onClick={() => copyToClipboard(reminder.medicineName, reminder.time, reminder.notes)}\r\n                                                        className=\"p-3 bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 rounded-xl hover:bg-amber-500 hover:text-white\"\r\n                                                        title=\"Copy Schedule\"\r\n                                                    >\r\n                                                        <Copy size={16} />\r\n                                                    </button>\r\n                                                    <button\r\n                                                        onClick={() => downloadICS(reminder.medicineName, reminder.time, reminder.notes)}\r\n                                                        className=\"p-3 bg-indigo-50 dark:bg-indigo-950/30 text-indigo-600 dark:text-indigo-400 rounded-xl hover:bg-indigo-500 hover:text-white\"\r\n                                                        title=\"Add to Calendar\"\r\n                                                    >\r\n                                                        <Calendar size={16} />\r\n                                                    </button>\r\n                                                    <button\r\n                                                        onClick={() => removeReminder(reminder.id)}\r\n                                                        className=\"p-3 bg-red-50 dark:bg-red-950/30 text-red-500 dark:text-red-400 rounded-xl hover:bg-red-500 hover:text-white\"\r\n                                                        title=\"Delete\"\r\n                                                    >\r\n                                                        <Trash2 size={16} />\r\n                                                    </button>\r\n                                                </div>\r\n                                            </div>\r\n                                        )\r\n                                    })}\r\n                                </div>\r\n                            </div>\r\n                        )\r\n                    })\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"pt-6\">\r\n                <div className=\"p-5 glass rounded-3xl border-indigo-100 dark:border-indigo-900/30 bg-indigo-50/20\">\r\n                    <div className=\"flex items-center gap-4 mb-3\">\r\n                        <div className=\"p-2 bg-indigo-100 dark:bg-indigo-900/50 rounded-xl text-indigo-600 dark:text-indigo-400\">\r\n                            <ChevronRight size={18} />\r\n                        </div>\r\n                        <h4 className=\"font-black text-slate-800 dark:text-white text-xs uppercase tracking-widest\">Pro Tip</h4>\r\n                    </div>\r\n                    <p className=\"text-xs text-slate-500 dark:text-slate-400 font-medium leading-relaxed\">\r\n                        Consistency is key. Use the <strong className=\"text-rose-500\">Smart Alerts</strong> to get notified 15 minutes before your scheduled time.\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            {showCamera && (\r\n                <CameraCapture\r\n                    onCapture={handleScan}\r\n                    onClose={() => setShowCamera(false)}\r\n                    label=\"Position the prescription or medicine list in the center to scan all items.\"\r\n                />\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\pages\\Plans.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3949,3952],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3949,3952],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\"\r\nimport { WeeklyCalendar } from \"../components/plans/WeeklyCalendar\"\r\nimport { useAppStore, type MealEntry } from \"../store/useAppStore\"\r\nimport { format } from \"date-fns\"\r\nimport { Plus, Sparkles, Loader2, ShoppingCart, X, Check, ChefHat, Trash2 } from \"lucide-react\"\r\nimport { cn } from \"../lib/utils\"\r\nimport { AddFoodForm } from \"../components/log/AddFoodForm\"\r\nimport { ExerciseModal } from \"../components/workout/ExerciseModal\"\r\nimport { generateMealPlan, getApiKey } from \"../lib/ai\"\r\nimport { toast } from \"sonner\"\r\n\r\nexport default function Plans() {\r\n    const [selectedDate, setSelectedDate] = useState(format(new Date(), 'yyyy-MM-dd'))\r\n    const [activeTab, setActiveTab] = useState<MealEntry['mealType']>('breakfast')\r\n    const [isAddingMode, setIsAddingMode] = useState(false)\r\n    const [editingMeal, setEditingMeal] = useState<MealEntry | null>(null)\r\n    const [isGenerating, setIsGenerating] = useState(false)\r\n    const [showShoppingList, setShowShoppingList] = useState(false)\r\n    const [showIngredientsInput, setShowIngredientsInput] = useState(false)\r\n    const [availableIngredients, setAvailableIngredients] = useState('')\r\n\r\n    const [checkedItems, setCheckedItems] = useState<string[]>([])\r\n\r\n    const [showExerciseModal, setShowExerciseModal] = useState(false)\r\n\r\n    const plans = useAppStore(state => state.plans[selectedDate])\r\n    const logs = useAppStore(state => state.logs[selectedDate])\r\n    const user = useAppStore(state => state.user)\r\n    const addPlanEntry = useAppStore(state => state.addPlanEntry)\r\n    const updatePlanEntry = useAppStore(state => state.updatePlanEntry)\r\n    const removePlanEntry = useAppStore(state => state.removePlanEntry)\r\n    const exerciseLog = useAppStore(state => state.exerciseLogs?.[selectedDate])\r\n    const addExerciseEntry = useAppStore(state => state.addExerciseEntry)\r\n    const removeExerciseEntry = useAppStore(state => state.removeExerciseEntry)\r\n\r\n    const entries = plans?.entries.filter(e => e.mealType === activeTab) || []\r\n\r\n    const allIngredients = (plans?.entries || []).reduce((acc, entry) => {\r\n        if (entry && Array.isArray(entry.ingredients)) {\r\n            entry.ingredients.forEach(ing => {\r\n                if (ing && !acc.includes(ing)) acc.push(ing)\r\n            })\r\n        }\r\n        return acc\r\n    }, [] as string[])\r\n\r\n    // Final Calculations\r\n    const plannedCalories = (plans?.entries || []).reduce((acc, e) => acc + e.calories, 0)\r\n    const actualCalories = (logs?.entries || []).reduce((acc, e) => acc + e.calories, 0)\r\n\r\n    const totalExerciseMinutes = (exerciseLog?.entries || []).reduce((acc, e) => acc + e.durationMinutes, 0)\r\n\r\n    const toggleItem = (item: string) => {\r\n        setCheckedItems(prev =>\r\n            prev.includes(item) ? prev.filter(i => i !== item) : [...prev, item]\r\n        )\r\n    }\r\n\r\n    const handleGenerateAI = async () => {\r\n        const apiKey = getApiKey()\r\n\r\n        if (!apiKey) {\r\n            toast.error(\"AI Features Restricted\", {\r\n                description: \"Please configure your Gemini API Key in the Profile section to enable Smart Planning.\"\r\n            })\r\n            return\r\n        }\r\n        setIsGenerating(true)\r\n        try {\r\n            const suggestedMeals = await generateMealPlan(user, showIngredientsInput ? availableIngredients : undefined)\r\n            // Add all suggested meals to the plan\r\n            for (const meal of suggestedMeals) {\r\n                await addPlanEntry(selectedDate, meal)\r\n            }\r\n            toast.success(showIngredientsInput ? \"Menu Custom-Made!\" : \"Meal Plan Generated!\", {\r\n                description: showIngredientsInput\r\n                    ? `AI used your ${availableIngredients.split(',').length} ingredients.`\r\n                    : \"AI has created a balanced menu for your day.\"\r\n            })\r\n            if (showIngredientsInput) setShowIngredientsInput(false)\r\n        } catch (e: any) {\r\n            console.error(\"Meal planning failed:\", e)\r\n            toast.error(\"Generation Failed\", {\r\n                description: e.message || \"Please check your API key and connection.\"\r\n            })\r\n        } finally {\r\n            setIsGenerating(false)\r\n        }\r\n    }\r\n\r\n    const handleShareWhatsApp = () => {\r\n        const dateStr = format(new Date(selectedDate), 'EEEE, MMM do')\r\n        const items = allIngredients.map(ing => `- ${checkedItems.includes(ing) ? '[DONE] ' : ''}${ing}`).join('\\n')\r\n        const message = `🛒 Shopping List for ${dateStr}\\n\\n${items}\\n\\nGenerated by Health Companion AI`\r\n        window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank')\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6 pt-6 pb-20 relative\">\r\n            {/* Background Blob */}\r\n            <div className=\"absolute -top-20 -right-20 w-80 h-80 bg-indigo-500/5 dark:bg-indigo-400/5 rounded-full blur-3xl -z-10 animate-blob\"></div>\r\n            <div className=\"absolute top-1/2 -left-20 w-80 h-80 bg-purple-500/5 dark:bg-purple-400/5 rounded-full blur-3xl -z-10 animate-blob animation-delay-2000\"></div>\r\n\r\n            <header className=\"space-y-4 px-1\">\r\n                <div className=\"flex justify-between items-center\">\r\n                    <div className=\"space-y-1\">\r\n                        <h1 className=\"text-2xl font-black bg-gradient-to-r from-slate-900 to-slate-700 dark:from-white dark:to-slate-300 bg-clip-text text-transparent tracking-tight\">\r\n                            Meal Planner\r\n                        </h1>\r\n                        <p className=\"text-[10px] text-slate-400 dark:text-slate-500 font-bold uppercase tracking-widest\">\r\n                            Design your perfect day\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-2 gap-3\">\r\n                    <button\r\n                        onClick={handleGenerateAI}\r\n                        disabled={isGenerating}\r\n                        className={cn(\r\n                            \"col-span-2 glass dark:bg-indigo-500/10 dark:border-indigo-500/20 text-indigo-600 dark:text-indigo-400 p-4 rounded-3xl text-sm font-black flex items-center justify-center gap-3 hover:scale-[1.02] active:scale-[0.98] transition-all shadow-xl shadow-indigo-500/5\",\r\n                            showIngredientsInput && \"hidden\"\r\n                        )}\r\n                    >\r\n                        {isGenerating ? <Loader2 size={20} className=\"animate-spin text-indigo-500\" /> : <Sparkles size={20} className=\"text-indigo-500\" />}\r\n                        {isGenerating ? \"AI Planning...\" : \"Smart AI Plan\"}\r\n                    </button>\r\n\r\n                    <button\r\n                        onClick={() => setShowIngredientsInput(!showIngredientsInput)}\r\n                        className={cn(\r\n                            \"glass p-4 rounded-3xl text-[11px] font-black flex items-center justify-center gap-2 transition-all border-2\",\r\n                            showIngredientsInput\r\n                                ? \"bg-white border-slate-200 text-slate-900 shadow-xl shadow-white/10 col-span-2\"\r\n                                : \"text-slate-600 dark:text-slate-300 border-transparent hover:border-slate-200 dark:hover:border-slate-800\",\r\n                            !showIngredientsInput && \"flex-1\"\r\n                        )}\r\n                    >\r\n                        {showIngredientsInput ? (\r\n                            <>\r\n                                <X size={18} className=\"text-slate-900\" />\r\n                                <span className=\"uppercase tracking-widest\">Close Fridge Mode</span>\r\n                            </>\r\n                        ) : (\r\n                            <>\r\n                                <ChefHat size={18} className=\"text-orange-500\" />\r\n                                <span className=\"uppercase tracking-widest\">Fridge Mode</span>\r\n                            </>\r\n                        )}\r\n                    </button>\r\n\r\n                    {!showIngredientsInput && (\r\n                        <button\r\n                            onClick={() => {\r\n                                setShowShoppingList(true)\r\n                                setCheckedItems([]) // Reset list when opening\r\n                            }}\r\n                            className=\"glass p-4 rounded-3xl text-indigo-500 hover:text-indigo-600 dark:hover:text-indigo-400 transition-all hover:scale-[1.05] active:scale-[0.95] relative flex flex-col items-center justify-center gap-2 border-2 border-transparent hover:border-indigo-100 dark:hover:border-indigo-900/30\"\r\n                            title=\"Shopping List\"\r\n                        >\r\n                            <ShoppingCart size={18} className=\"text-indigo-500\" />\r\n                            <span className=\"text-[11px] font-black uppercase tracking-widest text-slate-600 dark:text-slate-300\">Grocery List</span>\r\n                            {allIngredients.length > 0 && (\r\n                                <span className=\"absolute top-3 right-8 bg-orange-500 text-white text-[9px] font-black w-5 h-5 rounded-full flex items-center justify-center border-2 border-white dark:border-slate-900 animate-in zoom-in shadow-lg shadow-orange-500/30\">\r\n                                    {allIngredients.length}\r\n                                </span>\r\n                            )}\r\n                        </button>\r\n                    )}\r\n\r\n                    {showIngredientsInput && (\r\n                        <div className=\"col-span-2 glass p-5 rounded-[2rem] space-y-4 animate-in slide-in-from-top-4 duration-300\">\r\n                            <div className=\"flex items-center gap-2 px-1\">\r\n                                <div className=\"w-1 h-3 bg-orange-500 rounded-full\"></div>\r\n                                <label className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest\">What's in your Fridge?</label>\r\n                            </div>\r\n                            <textarea\r\n                                placeholder=\"Eggs, spinach, chicken breast, rice...\"\r\n                                className=\"w-full p-4 bg-white/50 dark:bg-slate-950/50 border border-slate-100 dark:border-slate-800 rounded-2xl focus:outline-none focus:ring-2 focus:ring-orange-500/20 transition-all font-bold text-xs min-h-[100px] resize-none\"\r\n                                value={availableIngredients}\r\n                                onChange={(e) => setAvailableIngredients(e.target.value)}\r\n                            />\r\n                            <button\r\n                                onClick={handleGenerateAI}\r\n                                disabled={isGenerating || !availableIngredients.trim()}\r\n                                className=\"w-full bg-slate-900 dark:bg-orange-500 text-white p-4 rounded-2xl text-xs font-black uppercase tracking-widest shadow-xl shadow-orange-500/20 active:scale-[0.98] transition-all disabled:opacity-50 flex items-center justify-center gap-2\"\r\n                            >\r\n                                {isGenerating ? <Loader2 size={16} className=\"animate-spin\" /> : <Sparkles size={16} />}\r\n                                {isGenerating ? \"AI Cooking...\" : \"Get Suggestions\"}\r\n                            </button>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </header>\r\n\r\n            <WeeklyCalendar selectedDate={selectedDate} onSelect={setSelectedDate} />\r\n\r\n            {/* Shopping List Modal */}\r\n            {showShoppingList && (\r\n                <div className=\"fixed inset-0 bg-slate-950/60 backdrop-blur-sm z-[60] flex items-center justify-center p-4 animate-in fade-in duration-200\">\r\n                    <div className=\"w-full max-w-md glass-dark rounded-[2.5rem] overflow-hidden shadow-2xl\">\r\n                        <div className=\"p-8 space-y-6\">\r\n                            <div className=\"flex justify-between items-center\">\r\n                                <div className=\"space-y-1\">\r\n                                    <h3 className=\"text-2xl font-black text-white tracking-tight\">Shopping List</h3>\r\n                                    <p className=\"text-[10px] text-slate-400 font-bold uppercase tracking-widest\">{format(new Date(selectedDate), 'EEEE, MMM do')}</p>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-4\">\r\n                                    <button\r\n                                        onClick={handleShareWhatsApp}\r\n                                        className=\"text-emerald-500 hover:scale-110 active:scale-90 transition-all\"\r\n                                        title=\"Share to WhatsApp\"\r\n                                    >\r\n                                        <ShoppingCart size={20} />\r\n                                    </button>\r\n                                    <button onClick={() => setShowShoppingList(false)} className=\"text-slate-500 hover:text-white transition-colors\">\r\n                                        <X size={24} />\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-4 max-h-[350px] overflow-y-auto pr-2 custom-scrollbar\">\r\n                                {allIngredients.length === 0 ? (\r\n                                    <div className=\"text-center py-12 px-6 space-y-4\">\r\n                                        <div className=\"bg-slate-900/50 w-16 h-16 rounded-3xl flex items-center justify-center mx-auto mb-4 border border-white/5\">\r\n                                            <ShoppingCart size={32} className=\"text-slate-600\" />\r\n                                        </div>\r\n                                        <div className=\"space-y-2\">\r\n                                            <p className=\"text-base font-black text-white\">List is Empty</p>\r\n                                            <p className=\"text-xs text-slate-500 font-medium leading-relaxed\">\r\n                                                {plans?.entries.length ? \"Your planned meals don't have ingredients listed. Click on a meal to add them manually.\" : \"No meals planned for this day yet. Generate a plan to see ingredients!\"}\r\n                                            </p>\r\n                                        </div>\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"grid grid-cols-1 gap-2\">\r\n                                        {allIngredients.map((ing, i) => (\r\n                                            <div\r\n                                                key={i}\r\n                                                onClick={() => toggleItem(ing)}\r\n                                                className={cn(\r\n                                                    \"flex items-center gap-3 p-4 rounded-2xl border transition-all cursor-pointer group\",\r\n                                                    checkedItems.includes(ing)\r\n                                                        ? \"bg-indigo-500/10 border-indigo-500/20 opacity-60\"\r\n                                                        : \"bg-white/5 border-white/5 hover:bg-white/10\"\r\n                                                )}\r\n                                            >\r\n                                                <div className={cn(\r\n                                                    \"w-6 h-6 rounded-lg border-2 flex items-center justify-center transition-all\",\r\n                                                    checkedItems.includes(ing)\r\n                                                        ? \"bg-indigo-500 border-indigo-500\"\r\n                                                        : \"border-slate-700 group-hover:border-indigo-500/50\"\r\n                                                )}>\r\n                                                    {checkedItems.includes(ing) && <Check size={14} className=\"text-white\" />}\r\n                                                </div>\r\n                                                <span className={cn(\r\n                                                    \"text-sm font-medium transition-all\",\r\n                                                    checkedItems.includes(ing) ? \"text-slate-400 line-through\" : \"text-slate-200\"\r\n                                                )}>\r\n                                                    {ing}\r\n                                                </span>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            <div className=\"flex gap-3 pt-2\">\r\n                                <button\r\n                                    onClick={() => setShowShoppingList(false)}\r\n                                    className=\"flex-1 py-4 bg-slate-800 hover:bg-slate-700 text-white rounded-2xl font-black text-xs uppercase tracking-widest transition-all active:scale-[0.98]\"\r\n                                >\r\n                                    Dismiss\r\n                                </button>\r\n                                <button\r\n                                    onClick={handleShareWhatsApp}\r\n                                    className=\"px-6 py-4 bg-emerald-600 hover:bg-emerald-700 text-white rounded-2xl font-black text-xs uppercase tracking-widest transition-all active:scale-[0.98] flex items-center gap-2\"\r\n                                >\r\n                                    Share\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Summary Card - Dark Glass */}\r\n            <div className=\"glass-dark p-6 rounded-3xl text-white overflow-hidden relative\">\r\n                <div className=\"absolute top-0 right-0 w-32 h-32 bg-orange-500/10 rounded-full blur-2xl -z-10\"></div>\r\n                <div className=\"grid grid-cols-2 gap-8 relative z-10\">\r\n                    <div>\r\n                        <div className=\"text-[10px] text-slate-400 font-black uppercase tracking-widest mb-1.5\">Planned</div>\r\n                        <div className=\"text-3xl font-black\">{plannedCalories} <span className=\"text-xs font-medium text-slate-500\">kcal</span></div>\r\n                    </div>\r\n                    <div className=\"text-right\">\r\n                        <div className=\"text-[10px] text-slate-400 font-black uppercase tracking-widest mb-1.5\">Actual</div>\r\n                        <div className={cn(\"text-3xl font-black\", actualCalories > plannedCalories ? \"text-red-400\" : \"text-emerald-400\")}>\r\n                            {actualCalories} <span className=\"text-xs font-medium text-slate-500\">kcal</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                {/* Visual Bar */}\r\n                <div className=\"mt-6 h-1.5 bg-slate-800/50 rounded-full overflow-hidden flex\">\r\n                    <div\r\n                        className=\"h-full bg-gradient-to-r from-orange-500 to-rose-500 transition-all duration-1000\"\r\n                        style={{ width: `${Math.min(100, (actualCalories / (plannedCalories || 2000)) * 100)}%` }}\r\n                    />\r\n                </div>\r\n                <div className=\"mt-4 flex items-center justify-between text-[11px] text-slate-400 font-medium\">\r\n                    <span>Movement planned today</span>\r\n                    <span>{totalExerciseMinutes} min</span>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Meal Sections */}\r\n            <div className=\"space-y-5\">\r\n                <div className=\"grid grid-cols-4 gap-2 px-1\">\r\n                    {(['breakfast', 'lunch', 'dinner', 'snack'] as const).map(tab => (\r\n                        <button\r\n                            key={tab}\r\n                            onClick={() => setActiveTab(tab)}\r\n                            className={cn(\r\n                                \"py-2 rounded-xl text-[10px] font-black uppercase tracking-tighter transition-all capitalize whitespace-nowrap border-2 flex items-center justify-center\",\r\n                                activeTab === tab\r\n                                    ? \"bg-slate-900 border-slate-900 text-white dark:bg-white dark:border-white dark:text-black shadow-lg shadow-slate-200 dark:shadow-none\"\r\n                                    : \"bg-white/50 border-slate-100 text-slate-400 dark:bg-slate-900/50 dark:border-slate-800 hover:border-slate-200 dark:hover:border-slate-700\"\r\n                            )}\r\n                        >\r\n                            {tab}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n\r\n                <div className=\"glass p-5 rounded-3xl min-h-[160px]\">\r\n                    <div className=\"flex justify-between items-center mb-5\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <div className=\"w-1.5 h-6 bg-orange-500 rounded-full\"></div>\r\n                            <h3 className=\"font-black text-slate-800 dark:text-white capitalize tracking-tight\">{activeTab} Entry</h3>\r\n                        </div>\r\n                        <button\r\n                            className=\"h-9 w-9 p-0 rounded-xl bg-orange-500 text-white flex items-center justify-center shadow-lg shadow-orange-500/20 active:scale-90 transition-transform\"\r\n                            onClick={() => {\r\n                                setEditingMeal(null)\r\n                                setIsAddingMode(true)\r\n                            }}\r\n                        >\r\n                            <Plus size={20} />\r\n                        </button>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-3\">\r\n                        {entries.length === 0 ? (\r\n                            <div className=\"text-center py-10 text-slate-400 font-medium text-sm border-2 border-dashed border-slate-100 dark:border-slate-800/50 rounded-2xl\">\r\n                                Empty menu\r\n                            </div>\r\n                        ) : (\r\n                            entries.map(entry => (\r\n                                <div\r\n                                    key={entry.id}\r\n                                    className=\"group relative flex justify-between items-center p-4 bg-white/50 dark:bg-slate-950/50 border border-slate-100 dark:border-slate-800/50 rounded-2xl hover:scale-[1.01] transition-transform\"\r\n                                >\r\n                                    <div\r\n                                        onClick={() => {\r\n                                            setEditingMeal(entry)\r\n                                            setIsAddingMode(true)\r\n                                        }}\r\n                                        className=\"flex-1 cursor-pointer\"\r\n                                    >\r\n                                        <span className=\"font-bold text-slate-700 dark:text-slate-200\">{entry.name}</span>\r\n                                        <div className=\"flex items-center gap-3 mt-1\">\r\n                                            <span className=\"text-[11px] font-black text-slate-400 uppercase tracking-tighter\">{entry.calories} Cal</span>\r\n                                            {entry.ingredients && entry.ingredients.length > 0 && (\r\n                                                <span className=\"text-[9px] font-bold text-indigo-400 uppercase tracking-widest flex items-center gap-1\">\r\n                                                    <ShoppingCart size={8} /> {entry.ingredients.length} items\r\n                                                </span>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                    <button\r\n                                        onClick={(e) => {\r\n                                            e.stopPropagation()\r\n                                            removePlanEntry(selectedDate, entry.id)\r\n                                            toast.success(\"Entry removed\")\r\n                                        }}\r\n                                        className=\"p-2 text-slate-300 hover:text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-500/10 rounded-xl transition-all opacity-0 group-hover:opacity-100\"\r\n                                        title=\"Remove entry\"\r\n                                    >\r\n                                        <Trash2 size={16} />\r\n                                    </button>\r\n                                </div>\r\n                            ))\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Exercise Planner */}\r\n            <div className=\"space-y-4\">\r\n                <div className=\"flex items-center justify-between px-1\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <div className=\"w-1.5 h-6 bg-emerald-500 rounded-full\"></div>\r\n                        <h3 className=\"font-black text-slate-800 dark:text-white capitalize tracking-tight text-sm\">Movement Plan</h3>\r\n                    </div>\r\n                    <button\r\n                        className=\"h-9 px-3 rounded-xl bg-emerald-500 text-white flex items-center justify-center text-[10px] font-black uppercase tracking-widest shadow-lg shadow-emerald-500/20 active:scale-95 transition-transform\"\r\n                        onClick={() => setShowExerciseModal(true)}\r\n                    >\r\n                        <Plus size={16} className=\"mr-1\" />\r\n                        Add Session\r\n                    </button>\r\n                </div>\r\n\r\n                <div className=\"glass p-5 rounded-3xl min-h-[120px]\">\r\n                    {(!exerciseLog?.entries || exerciseLog.entries.length === 0) ? (\r\n                        <div className=\"text-center py-8 text-slate-400 text-sm border-2 border-dashed border-slate-800/40 rounded-2xl\">\r\n                            No movement planned yet. Add a short walk, workout, or stretch.\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"space-y-3\">\r\n                            {exerciseLog.entries.map(entry => (\r\n                                <div\r\n                                    key={entry.id}\r\n                                    className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-2xl border border-slate-800/60\"\r\n                                >\r\n                                    <div>\r\n                                        <div className=\"font-bold text-slate-50\">\r\n                                            {entry.name}\r\n                                        </div>\r\n                                        <div className=\"text-[11px] text-slate-400 font-medium mt-1\">\r\n                                            {entry.type} • {entry.durationMinutes} min • {entry.intensity}\r\n                                        </div>\r\n                                    </div>\r\n                                    <button\r\n                                        onClick={() => {\r\n                                            removeExerciseEntry(selectedDate, entry.id)\r\n                                            toast.success(\"Exercise removed\")\r\n                                        }}\r\n                                        className=\"p-2 text-slate-500 hover:text-rose-400 hover:bg-rose-500/10 rounded-xl transition-colors\"\r\n                                    >\r\n                                        <Trash2 size={16} />\r\n                                    </button>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Meal Modal */}\r\n            {isAddingMode && (\r\n                <div className=\"fixed inset-0 bg-slate-950/60 backdrop-blur-sm z-50 flex items-end sm:items-center justify-center p-4 animate-in fade-in duration-200\">\r\n                    <div className=\"w-full max-w-sm mb-20 sm:mb-0\">\r\n                        <AddFoodForm\r\n                            mealType={activeTab}\r\n                            initialValues={editingMeal || undefined}\r\n                            onClose={() => {\r\n                                setIsAddingMode(false)\r\n                                setEditingMeal(null)\r\n                            }}\r\n                            onSubmit={(entry) => {\r\n                                if (editingMeal) {\r\n                                    updatePlanEntry(selectedDate, { ...editingMeal, ...entry })\r\n                                } else {\r\n                                    addPlanEntry(selectedDate, entry)\r\n                                }\r\n                                setIsAddingMode(false)\r\n                                setEditingMeal(null)\r\n                            }}\r\n                        />\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Exercise Modal */}\r\n            {showExerciseModal && (\r\n                <ExerciseModal\r\n                    onClose={() => setShowExerciseModal(false)}\r\n                    onSubmit={async (name, type, minutes, intensity) => {\r\n                        await addExerciseEntry(selectedDate, {\r\n                            name,\r\n                            type,\r\n                            durationMinutes: minutes,\r\n                            intensity\r\n                        })\r\n                        setShowExerciseModal(false)\r\n                        toast.success(\"Movement added to your plan\")\r\n                    }}\r\n                />\r\n            )}\r\n\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\pages\\Profile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\pages\\Settings.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":30,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":63,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":63,"endColumn":19}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\"\r\nimport { ArrowLeft, Key, Download, Activity } from \"lucide-react\"\r\nimport { Button } from \"../components/ui/Button\"\r\nimport { Link } from \"react-router-dom\"\r\nimport { useAppStore } from \"../store/useAppStore\"\r\nimport { getApiKey } from \"../lib/ai\"\r\nimport { format } from \"date-fns\"\r\nimport { toast } from \"sonner\"\r\nimport { db } from \"../lib/firebase\"\r\nimport { getDoc, doc } from \"firebase/firestore\"\r\nimport { cn } from \"../lib/utils\"\r\n\r\nexport default function Settings() {\r\n    const [resetting, setResetting] = useState(false)\r\n    const [isFirebaseConnected, setIsFirebaseConnected] = useState<boolean | null>(null)\r\n    const store = useAppStore()\r\n    const apiKey = getApiKey()\r\n    const lastSyncedAt = useAppStore(state => state.lastSyncedAt)\r\n\r\n    useEffect(() => {\r\n        const checkFirebase = async () => {\r\n            if (!store.user.isAuthenticated || !store.user.uid) {\r\n                setIsFirebaseConnected(false)\r\n                return\r\n            }\r\n            try {\r\n                // Lightweight read check\r\n                await getDoc(doc(db, 'users', store.user.uid!))\r\n                setIsFirebaseConnected(true)\r\n            } catch (e) {\r\n                setIsFirebaseConnected(false)\r\n            }\r\n        }\r\n        checkFirebase()\r\n    }, [store.user.isAuthenticated, store.user.uid])\r\n\r\n    const handleExport = () => {\r\n        try {\r\n            const data = {\r\n                user: store.user,\r\n                logs: store.logs,\r\n                plans: store.plans,\r\n                exerciseLogs: store.exerciseLogs,\r\n                reminders: store.reminders,\r\n                theme: store.theme,\r\n                lastSyncedAt: store.lastSyncedAt,\r\n                exportedAt: new Date().toISOString()\r\n            }\r\n\r\n            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' })\r\n            const url = URL.createObjectURL(blob)\r\n            const a = document.createElement('a')\r\n            const today = format(new Date(), 'yyyy-MM-dd')\r\n\r\n            a.href = url\r\n            a.download = `health-companion-export-${today}.json`\r\n            document.body.appendChild(a)\r\n            a.click()\r\n            document.body.removeChild(a)\r\n            URL.revokeObjectURL(url)\r\n\r\n            toast.success(\"Data exported successfully! 📂\")\r\n        } catch (e) {\r\n            toast.error(\"Export failed. Please try again.\")\r\n        }\r\n    }\r\n\r\n    const resetCache = async () => {\r\n        try {\r\n            setResetting(true)\r\n            if ('serviceWorker' in navigator) {\r\n                const regs = await navigator.serviceWorker.getRegistrations()\r\n                for (const r of regs) {\r\n                    await r.unregister()\r\n                }\r\n            }\r\n            if ('caches' in window) {\r\n                const names = await caches.keys()\r\n                await Promise.all(names.map(n => caches.delete(n)))\r\n            }\r\n            localStorage.clear()\r\n            sessionStorage.clear()\r\n        } finally {\r\n            location.reload()\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-8 pt-6 pb-24 px-1 min-h-screen relative overflow-hidden\">\r\n            {/* Background Blobs */}\r\n            <div className=\"absolute -top-20 -right-20 w-80 h-80 bg-orange-500/10 rounded-full blur-3xl -z-10 animate-blob\"></div>\r\n            <div className=\"absolute top-1/2 -left-20 w-80 h-80 bg-indigo-500/5 rounded-full blur-3xl -z-10 animate-blob animation-delay-4000\"></div>\r\n\r\n            <div className=\"flex items-center gap-4 mb-2 relative z-10\">\r\n                <Link to=\"/profile\" className=\"w-12 h-12 glass rounded-2xl flex items-center justify-center text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-all hover:scale-105 active:scale-95 shadow-lg border-white/20\">\r\n                    <ArrowLeft size={20} />\r\n                </Link>\r\n                <div className=\"space-y-1\">\r\n                    <h1 className=\"text-2xl font-black text-slate-800 dark:text-white uppercase tracking-tight\">System Core</h1>\r\n                    <p className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest\">Global Configuration</p>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"flex-1 flex flex-col items-center justify-center py-16 space-y-8 relative z-10\">\r\n                <div className=\"relative group\">\r\n                    <div className=\"absolute -inset-4 bg-gradient-to-r from-orange-500 to-indigo-500 rounded-full blur-2xl opacity-20 group-hover:opacity-40 transition duration-1000\"></div>\r\n                    <div className=\"w-32 h-32 glass dark:glass-dark text-orange-500 dark:text-orange-400 rounded-full flex items-center justify-center shadow-2xl border-white/40 dark:border-slate-800/50 relative overflow-hidden\">\r\n                        <div className=\"absolute inset-0 bg-gradient-to-br from-orange-500/10 to-transparent\"></div>\r\n                        <Key size={48} className=\"drop-shadow-[0_0_15px_rgba(249,115,22,0.5)] animate-bounce-slight\" />\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"text-center space-y-4 max-w-xs\">\r\n                    <div className={cn(\r\n                        \"inline-flex items-center gap-2 px-4 py-1.5 glass rounded-full mb-2\",\r\n                        apiKey ? \"border-green-500/20 bg-green-500/5\" : \"border-rose-500/20 bg-rose-500/5 text-rose-500\"\r\n                    )}>\r\n                        <div className={cn(\r\n                            \"w-2 h-2 rounded-full animate-pulse\",\r\n                            apiKey ? \"bg-green-500\" : \"bg-rose-500\"\r\n                        )}></div>\r\n                        <span className={cn(\r\n                            \"text-[10px] font-black uppercase tracking-widest\",\r\n                            apiKey ? \"text-green-600\" : \"text-rose-600\"\r\n                        )}>\r\n                            {apiKey ? \"AI Intelligence Active\" : \"AI Not Configured — Add key in Profile\"}\r\n                        </span>\r\n                    </div>\r\n                    <h3 className=\"text-2xl font-black text-slate-800 dark:text-white uppercase tracking-tight leading-none\">\r\n                        {apiKey ? \"Neural Link Synced\" : \"Cognitive Lock Restricted\"}\r\n                    </h3>\r\n                    <p className=\"text-[11px] text-slate-500 dark:text-slate-400 font-bold uppercase tracking-widest leading-relaxed\">\r\n                        {apiKey\r\n                            ? \"Your cloud-based nutritionist is now active for all meal scans, health insights, and clinical monitoring.\"\r\n                            : \"Unlock deep scan analytics and advanced health coaching by configuring your neural API gateway.\"}\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"px-4\">\r\n                <Button\r\n                    onClick={handleExport}\r\n                    variant=\"ghost\"\r\n                    fullWidth\r\n                    className=\"glass p-5 h-auto rounded-3xl flex items-center justify-between group hover:border-indigo-500/30 transition-all\"\r\n                >\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <div className=\"w-12 h-12 rounded-2xl bg-indigo-500/10 text-indigo-500 flex items-center justify-center\">\r\n                            <Download size={24} />\r\n                        </div>\r\n                        <div className=\"text-left\">\r\n                            <div className=\"font-black text-slate-800 dark:text-white leading-tight\">Export My Data</div>\r\n                            <div className=\"text-[10px] text-slate-400 font-bold uppercase tracking-widest mt-0.5\">Download JSON Backup</div>\r\n                        </div>\r\n                    </div>\r\n                    <Activity size={18} className=\"text-slate-300 group-hover:text-indigo-500 transition-colors\" />\r\n                </Button>\r\n            </div>\r\n\r\n            <div className=\"mt-auto pt-12 relative z-10\">\r\n                <div className=\"glass dark:glass-dark rounded-3xl p-6 border-white/20 dark:border-slate-800/50 shadow-xl space-y-4\">\r\n                    <div className=\"flex justify-between items-center text-[10px] font-black uppercase tracking-widest text-slate-400\">\r\n                        <span>Framework</span>\r\n                        <span className=\"text-slate-800 dark:text-slate-200\">Health Companion v2.0.4</span>\r\n                    </div>\r\n                    <div className=\"h-px bg-white/10 dark:bg-slate-800/50\"></div>\r\n                    <div className=\"flex justify-between items-center text-[10px] font-black uppercase tracking-widest text-slate-400\">\r\n                        <span>Database</span>\r\n                        <span className={cn(\r\n                            \"flex items-center gap-2\",\r\n                            isFirebaseConnected ? \"text-green-500\" : isFirebaseConnected === false ? \"text-rose-500\" : \"text-slate-500\"\r\n                        )}>\r\n                            <div className={cn(\r\n                                \"w-1.5 h-1.5 rounded-full\",\r\n                                isFirebaseConnected ? \"bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.5)]\" : isFirebaseConnected === false ? \"bg-rose-500\" : \"bg-slate-500\"\r\n                            )}></div>\r\n                            {isFirebaseConnected ? \"Connected\" : isFirebaseConnected === false ? \"Disconnected\" : \"Checking...\"}\r\n                        </span>\r\n                    </div>\r\n                    <div className=\"h-px bg-white/10 dark:bg-slate-800/50\"></div>\r\n                    <div className=\"flex justify-between items-center text-[10px] font-black uppercase tracking-widest text-slate-400\">\r\n                        <span>Cloud Sync</span>\r\n                        <span className=\"text-slate-800 dark:text-slate-200\">\r\n                            {lastSyncedAt ? format(new Date(lastSyncedAt), 'MMM d, HH:mm') : 'Never'}\r\n                        </span>\r\n                    </div>\r\n                    <div className=\"h-px bg-white/10 dark:bg-slate-800/50\"></div>\r\n                    <div className=\"flex justify-between items-center text-[10px] font-black uppercase tracking-widest text-slate-400\">\r\n                        <span>Environment</span>\r\n                        <span className=\"text-orange-500\">Production Mode</span>\r\n                    </div>\r\n                    <div className=\"h-px bg-white/10 dark:bg-slate-800/50\"></div>\r\n                    <Button\r\n                        onClick={() => {\r\n                            if (window.confirm('WARNING: This will delete all your locally stored data including food logs, plans, and reminders. Continue?')) {\r\n                                resetCache()\r\n                            }\r\n                        }}\r\n                        disabled={resetting}\r\n                        variant=\"danger\"\r\n                        fullWidth\r\n                        className=\"py-3 rounded-xl font-black uppercase tracking-widest\"\r\n                    >\r\n                        {resetting ? 'Resetting…' : 'Reset App Cache'}\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"text-center text-[8px] text-slate-500/50 font-black uppercase tracking-[0.4em] mt-12 mb-8\">\r\n                Designed for the next evolution of human performance\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\pages\\Social.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\pages\\Splash.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\pages\\Stats.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'data' and 'user'. Either include them or remove the dependency array.","line":108,"column":8,"nodeType":"ArrayExpression","endLine":108,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [aiInsights, data, lastFetched, user]","fix":{"range":[4584,4609],"text":"[aiInsights, data, lastFetched, user]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from \"react\"\r\nimport { useAppStore } from \"../store/useAppStore\"\r\nimport { AreaChart, Area, XAxis, YAxis, Tooltip, ResponsiveContainer, ReferenceLine, CartesianGrid, LineChart, Line } from 'recharts'\r\nimport { startOfWeek, endOfWeek, eachDayOfInterval, format, isSameDay } from \"date-fns\"\r\nimport { calculateTDEE } from \"../lib/calories\"\r\nimport { getAIHealthInsights } from \"../lib/ai\"\r\nimport { Sparkles, Brain, Loader2, Zap, Target, Flame, TrendingUp, Scale, Activity, AlertTriangle, Trophy, Share2 } from \"lucide-react\"\r\nimport { Button } from \"../components/ui/Button\"\r\nimport { ShareCard } from \"../components/ShareCard\"\r\nimport html2canvas from 'html2canvas'\r\nimport { toast } from 'sonner'\r\nimport { cn } from \"../lib/utils\"\r\n\r\nexport default function Stats() {\r\n    const logs = useAppStore(state => state.logs)\r\n    const exerciseLogs = useAppStore(state => state.exerciseLogs || {})\r\n    const weightHistory = useAppStore(state => state.weightHistory || [])\r\n    const user = useAppStore(state => state.user)\r\n    const shareCardRef = useRef<HTMLDivElement>(null)\r\n    const [isSharing, setIsSharing] = useState(false)\r\n\r\n    // Weekly Data Logic\r\n    const today = new Date()\r\n    const start = startOfWeek(today, { weekStartsOn: 1 }) // Monday start\r\n    const end = endOfWeek(today, { weekStartsOn: 1 })\r\n    const days = eachDayOfInterval({ start, end })\r\n\r\n    const targetCalories = calculateTDEE(user)\r\n\r\n    const data = days.map(day => {\r\n        const dateStr = format(day, 'yyyy-MM-dd')\r\n        const log = logs[dateStr]\r\n        const exLog = exerciseLogs[dateStr]\r\n\r\n        const totalEaten = (log?.entries || []).reduce((acc, e) => acc + e.calories, 0)\r\n        const totalBurned = (exLog?.entries || []).reduce((acc, e) => acc + (e.calories || 0), 0)\r\n\r\n        return {\r\n            day: format(day, 'EEE'), // Mon, Tue\r\n            calories: totalEaten,\r\n            burned: totalBurned,\r\n            net: totalEaten - totalBurned,\r\n            isToday: isSameDay(day, today),\r\n            fullDate: dateStr\r\n        }\r\n    })\r\n\r\n    // Filter out future days (0 calories) from average calculation unless it's genuinely 0? \r\n    // For simplicity, let's average over days passed so far in the week including today.\r\n    const daysPassed = days.filter(d => d <= today).length || 1\r\n    const totalCaloriesSoFar = data.filter(d => new Date(d.fullDate) <= today).reduce((acc, d) => acc + d.calories, 0)\r\n    const weeklyAverage = Math.round(totalCaloriesSoFar / daysPassed)\r\n\r\n    const totalNetSoFar = data.filter(d => new Date(d.fullDate) <= today).reduce((acc, d) => acc + d.net, 0)\r\n    const netAverage = Math.round(totalNetSoFar / daysPassed)\r\n\r\n    // Calculate Weekly Macro Averages\r\n    let totalProtein = 0\r\n    let totalCarbs = 0\r\n    let totalFat = 0\r\n\r\n    days.forEach(day => {\r\n        const dateStr = format(day, 'yyyy-MM-dd')\r\n        const log = logs[dateStr]\r\n        if (log) {\r\n            log.entries.forEach(e => {\r\n                totalProtein += e.protein\r\n                totalCarbs += e.carbs\r\n                totalFat += e.fat\r\n            })\r\n        }\r\n    })\r\n\r\n    const avgProtein = Math.round(totalProtein / daysPassed)\r\n    const avgCarbs = Math.round(totalCarbs / daysPassed)\r\n    const avgFat = Math.round(totalFat / daysPassed)\r\n\r\n    // Rough Macr Targets (e.g. 30/35/35 split of TDEE)\r\n    // P: 4 cal/g, C: 4 cal/g, F: 9 cal/g\r\n    const targetProtein = Math.round((targetCalories * 0.3) / 4)\r\n    const targetCarbs = Math.round((targetCalories * 0.35) / 4)\r\n    const targetFat = Math.round((targetCalories * 0.35) / 9)\r\n\r\n    const [aiInsights, setAiInsights] = useState<{ wins: string, watchOut: string, focusThisWeek: string } | string | null>(null)\r\n    const [isLoadingAI, setIsLoadingAI] = useState(false)\r\n    const [lastFetched, setLastFetched] = useState<number>(0)\r\n\r\n    useEffect(() => {\r\n        const fetchInsights = async () => {\r\n            // Task 7.3 — Cache AI insights (60 min threshold)\r\n            const now = Date.now()\r\n            if (aiInsights && (now - lastFetched < 60 * 60 * 1000)) {\r\n                return\r\n            }\r\n\r\n            setIsLoadingAI(true)\r\n            try {\r\n                const insights = await getAIHealthInsights(data, user)\r\n                setAiInsights(insights)\r\n                setLastFetched(now)\r\n            } catch (e) {\r\n                console.error(\"Failed to fetch AI insights:\", e)\r\n            } finally {\r\n                setIsLoadingAI(false)\r\n            }\r\n        }\r\n        fetchInsights()\r\n    }, [aiInsights, lastFetched])\r\n\r\n    // Weight Data Processing\r\n    const thirtyDaysAgo = new Date()\r\n    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30)\r\n\r\n    const weightData = weightHistory\r\n        .filter(entry => new Date(entry.date) >= thirtyDaysAgo)\r\n        .map(entry => ({\r\n            date: format(new Date(entry.date), 'MMM d'),\r\n            weight: entry.weight\r\n        }))\r\n\r\n    // Task 12.5 - Sharing Logic\r\n    const handleShare = async () => {\r\n        if (!shareCardRef.current) return\r\n\r\n        try {\r\n            setIsSharing(true)\r\n            const canvas = await html2canvas(shareCardRef.current, {\r\n                useCORS: true,\r\n                scale: 1, // Full 1080x1080\r\n                backgroundColor: '#020617'\r\n            })\r\n\r\n            const blob = await new Promise<Blob | null>(resolve => canvas.toBlob(resolve, 'image/png', 1.0))\r\n            if (!blob) throw new Error(\"Canvas generation failed\")\r\n\r\n            const file = new File([blob], 'my-weekly-stats.png', { type: 'image/png' })\r\n\r\n            if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {\r\n                await navigator.share({\r\n                    files: [file],\r\n                    title: 'My Weekly Health Stats',\r\n                    text: `Check out my progress on Health Companion! 🔥 My avg daily calories: ${weeklyAverage}kcal.`\r\n                })\r\n            } else {\r\n                // Fallback: Download\r\n                const url = URL.createObjectURL(blob)\r\n                const a = document.createElement('a')\r\n                a.href = url\r\n                a.download = 'my-weekly-health-summary.png'\r\n                a.click()\r\n                URL.revokeObjectURL(url)\r\n                toast.success(\"Summary image downloaded! 📸\")\r\n            }\r\n        } catch (e) {\r\n            console.error(\"Sharing failed\", e)\r\n            toast.error(\"Share failed. Please try again.\")\r\n        } finally {\r\n            setIsSharing(false)\r\n        }\r\n    }\r\n\r\n    // Derive top 3 meals this week by calories\r\n    const weeklyEntries = days.flatMap(day => {\r\n        const dateStr = format(day, 'yyyy-MM-dd')\r\n        return logs[dateStr]?.entries || []\r\n    })\r\n\r\n    const topMeals = weeklyEntries\r\n        .sort((a, b) => (b.calories || 0) - (a.calories || 0))\r\n        .slice(0, 3)\r\n        .map(m => m.name)\r\n\r\n    const bmi = Number((user.weight / ((user.height / 100) ** 2)).toFixed(1))\r\n\r\n    // Task 7.1 — BMI Zone Logic\r\n    let bmiZone = \"Normal\"\r\n    let bmiColor = \"text-emerald-500\"\r\n    let bmiBarColor = \"bg-emerald-500\"\r\n    if (bmi < 18.5) {\r\n        bmiZone = \"Underweight\"\r\n        bmiColor = \"text-blue-500\"\r\n        bmiBarColor = \"bg-blue-500\"\r\n    } else if (bmi >= 25 && bmi < 30) {\r\n        bmiZone = \"Overweight\"\r\n        bmiColor = \"text-amber-500\"\r\n        bmiBarColor = \"bg-amber-500\"\r\n    } else if (bmi >= 30) {\r\n        bmiZone = \"Obese\"\r\n        bmiColor = \"text-rose-500\"\r\n        bmiBarColor = \"bg-rose-500\"\r\n    }\r\n\r\n    // BMI scale percentage (15 to 40)\r\n    const bmiPercent = Math.min(100, Math.max(0, ((bmi - 15) / (40 - 15)) * 100))\r\n\r\n    return (\r\n        <div className=\"space-y-6 pt-6 pb-24 px-1 min-h-screen bg-transparent text-slate-200 relative overflow-hidden\">\r\n            {/* Background Blobs */}\r\n            <div className=\"absolute -top-20 -right-20 w-80 h-80 bg-orange-600/10 rounded-full blur-3xl -z-10 animate-blob\"></div>\r\n            <div className=\"absolute top-1/2 -left-20 w-80 h-80 bg-cyan-600/10 rounded-full blur-3xl -z-10 animate-blob animation-delay-2000\"></div>\r\n\r\n            <header className=\"pt-8 px-2 space-y-2\">\r\n                <div className=\"flex items-center gap-2.5 text-orange-500 mb-1\">\r\n                    <div className=\"w-6 h-6 rounded-lg bg-orange-500/10 flex items-center justify-center\">\r\n                        <Zap size={14} fill=\"currentColor\" className=\"animate-pulse\" />\r\n                    </div>\r\n                    <span className=\"text-[10px] font-black uppercase tracking-[0.3em] text-orange-500/80\">Performance Center</span>\r\n                </div>\r\n                <h1 className=\"text-4xl font-black text-orange-500 tracking-tight leading-none\">\r\n                    Health Metrics\r\n                </h1>\r\n                <p className=\"text-xs text-slate-500 font-bold uppercase tracking-widest pl-1\">Weekly progress analysis</p>\r\n            </header>\r\n\r\n            {/* AI Health Coach Card (Glassmorphism) */}\r\n            <div className=\"relative group\">\r\n                <div className=\"absolute -inset-1 bg-gradient-to-r from-orange-500 to-purple-600 rounded-[2rem] blur opacity-10 group-hover:opacity-25 transition duration-1000\"></div>\r\n                <div className=\"relative glass-dark rounded-[2rem] p-6 overflow-hidden\">\r\n                    <div className=\"absolute top-0 right-0 p-4 opacity-5 text-white\">\r\n                        <Brain size={140} />\r\n                    </div>\r\n                    <div className=\"relative z-10\">\r\n                        <div className=\"flex items-center gap-3 mb-4\">\r\n                            <div className=\"bg-orange-500 text-white p-2 rounded-xl shadow-lg shadow-orange-500/20\">\r\n                                <Sparkles size={18} />\r\n                            </div>\r\n                            <h3 className=\"font-black text-[10px] uppercase tracking-widest text-slate-400\">AI Health Advisor</h3>\r\n                        </div>\r\n                        {isLoadingAI ? (\r\n                            <div className=\"flex items-center gap-3 text-slate-400 text-xs font-bold italic\">\r\n                                <Loader2 size={16} className=\"animate-spin text-orange-500\" />\r\n                                Processing weekly trends...\r\n                            </div>\r\n                        ) : typeof aiInsights === 'object' && aiInsights !== null ? (\r\n                            <div className=\"space-y-3\">\r\n                                <div className=\"flex items-start gap-3 bg-white/5 p-3 rounded-2xl border border-white/5\">\r\n                                    <div className=\"p-1.5 bg-emerald-500/20 rounded-lg text-emerald-500 mt-0.5\">\r\n                                        <Trophy size={14} />\r\n                                    </div>\r\n                                    <div>\r\n                                        <div className=\"text-[10px] font-black uppercase tracking-widest text-emerald-500 mb-0.5\">Weekly Win</div>\r\n                                        <p className=\"text-xs text-slate-300 font-medium\">{aiInsights.wins}</p>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex items-start gap-3 bg-white/5 p-3 rounded-2xl border border-white/5\">\r\n                                    <div className=\"p-1.5 bg-amber-500/20 rounded-lg text-amber-500 mt-0.5\">\r\n                                        <AlertTriangle size={14} />\r\n                                    </div>\r\n                                    <div>\r\n                                        <div className=\"text-[10px] font-black uppercase tracking-widest text-amber-500 mb-0.5\">Watch Out</div>\r\n                                        <p className=\"text-xs text-slate-300 font-medium\">{aiInsights.watchOut}</p>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex items-start gap-3 bg-white/5 p-3 rounded-2xl border border-white/5\">\r\n                                    <div className=\"p-1.5 bg-blue-500/20 rounded-lg text-blue-500 mt-0.5\">\r\n                                        <Target size={14} />\r\n                                    </div>\r\n                                    <div>\r\n                                        <div className=\"text-[10px] font-black uppercase tracking-widest text-blue-500 mb-0.5\">Weekly Focus</div>\r\n                                        <p className=\"text-xs text-slate-300 font-medium\">{aiInsights.focusThisWeek}</p>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ) : (\r\n                            <p className=\"text-slate-400 italic text-xs font-bold\">\r\n                                {typeof aiInsights === 'string' ? aiInsights : \"Start logging your meals to unlock your AI health coach.\"}\r\n                            </p>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Core Body Metrics (Vital Stats) - NEW prominent section */}\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n                <div className=\"glass-dark rounded-[2rem] p-5 flex flex-col justify-between group hover:bg-slate-900/60 transition-colors border-slate-800/40\">\r\n                    <div className=\"flex justify-between items-start mb-4\">\r\n                        <div className=\"p-2.5 bg-blue-500/10 rounded-xl\">\r\n                            <Scale size={20} className=\"text-blue-500\" />\r\n                        </div>\r\n                        <div className=\"text-[9px] font-black uppercase tracking-widest text-slate-500\">Weight</div>\r\n                    </div>\r\n                    <div>\r\n                        <div className=\"text-3xl font-black text-white tabular-nums group-hover:scale-105 transition-transform origin-left\">\r\n                            {user.weight} <span className=\"text-xs text-slate-500\">kg</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"glass-dark rounded-[2rem] p-5 border-slate-800/40 relative overflow-hidden\">\r\n                    <div className=\"flex justify-between items-start mb-4\">\r\n                        <div className=\"p-2.5 bg-emerald-500/10 rounded-xl\">\r\n                            <Activity size={20} className=\"text-emerald-500\" />\r\n                        </div>\r\n                        <div className=\"text-[9px] font-black uppercase tracking-widest text-slate-500\">BMI Index</div>\r\n                    </div>\r\n                    <div>\r\n                        <div className=\"text-3xl font-black text-white origin-left mb-2\">\r\n                            {bmi}\r\n                        </div>\r\n                        {/* Task 7.1 — BMI Scale UI */}\r\n                        <div className=\"space-y-2\">\r\n                            <div className=\"h-1.5 w-full bg-slate-800 rounded-full flex overflow-hidden relative border border-white/5\">\r\n                                <div className=\"h-full w-[14%] bg-blue-500/30\" />\r\n                                <div className=\"h-full w-[26%] bg-emerald-500/30\" />\r\n                                <div className=\"h-full w-[20%] bg-amber-500/30\" />\r\n                                <div className=\"h-full w-[40%] bg-rose-500/30\" />\r\n                                <div\r\n                                    className={cn(\"absolute top-0 w-2 h-2 rounded-full border border-white shadow-lg -translate-x-1/2\", bmiBarColor)}\r\n                                    style={{ left: `${bmiPercent}%` }}\r\n                                />\r\n                            </div>\r\n                            <div className={cn(\"text-[10px] font-black uppercase tracking-widest\", bmiColor)}>\r\n                                {bmiZone} Range\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Task 7.4 — Net Calories Card */}\r\n            <div className=\"glass-dark rounded-[2rem] p-6 border-slate-800/40 border-l-4 border-l-cyan-500\">\r\n                <div className=\"flex items-center justify-between mb-4\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"p-2 bg-cyan-500/10 rounded-xl\">\r\n                            <Flame size={20} className=\"text-cyan-500\" />\r\n                        </div>\r\n                        <div>\r\n                            <h3 className=\"font-black text-white uppercase text-[10px] tracking-widest\">Net Calories</h3>\r\n                            <p className=\"text-[8px] text-slate-500 font-bold uppercase\">Eaten minus Burned</p>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"text-right\">\r\n                        <div className={cn(\r\n                            \"text-2xl font-black tabular-nums\",\r\n                            netAverage <= targetCalories ? \"text-emerald-500\" : \"text-rose-500\"\r\n                        )}>\r\n                            {netAverage} <span className=\"text-[10px] opacity-60\">avg</span>\r\n                        </div>\r\n                        <div className=\"text-[9px] text-slate-500 font-bold uppercase\">Target: {targetCalories}</div>\r\n                    </div>\r\n                </div>\r\n                <div className=\"h-1.5 w-full bg-slate-900/50 rounded-full overflow-hidden border border-white/5\">\r\n                    <div\r\n                        className={cn(\r\n                            \"h-full transition-all duration-1000\",\r\n                            netAverage <= targetCalories ? \"bg-emerald-500\" : \"bg-rose-500\"\r\n                        )}\r\n                        style={{ width: `${Math.min(100, (netAverage / targetCalories) * 100)}%` }}\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            {/* Calories Chart (Area Chart) */}\r\n            <div className=\"glass-dark rounded-[2rem] p-6 border-slate-800/50\">\r\n                <div className=\"flex justify-between items-center mb-10\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"p-2 bg-orange-500/10 rounded-xl\">\r\n                            <Flame size={20} className=\"text-orange-500\" />\r\n                        </div>\r\n                        <h3 className=\"font-black text-white uppercase text-[10px] tracking-[0.15em]\">Calorie Burn</h3>\r\n                    </div>\r\n                    <div className=\"text-right\">\r\n                        <div className=\"text-[9px] text-slate-500 font-black uppercase mb-0.5 tracking-tighter\">Weekly Avg</div>\r\n                        <div className=\"text-2xl font-black text-white\">{weeklyAverage} <span className=\"text-[10px] text-orange-500\">kcal</span></div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"h-[220px] w-full\">\r\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                        <AreaChart data={data} margin={{ top: 10, right: 10, left: -20, bottom: 0 }}>\r\n                            <defs>\r\n                                <linearGradient id=\"colorCal\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                    <stop offset=\"5%\" stopColor=\"#f97316\" stopOpacity={0.3} />\r\n                                    <stop offset=\"95%\" stopColor=\"#f97316\" stopOpacity={0} />\r\n                                </linearGradient>\r\n                            </defs>\r\n                            <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#1e293b\" opacity={0.3} />\r\n                            <XAxis\r\n                                dataKey=\"day\"\r\n                                axisLine={false}\r\n                                tickLine={false}\r\n                                tick={{ fontSize: 9, fill: '#64748b', fontWeight: 900 }}\r\n                                dy={10}\r\n                            />\r\n                            <Tooltip\r\n                                contentStyle={{ backgroundColor: '#0f172a', border: '1px solid #1e293b', borderRadius: '16px', color: '#fff' }}\r\n                                itemStyle={{ color: '#f97316' }}\r\n                                cursor={{ stroke: '#f97316', strokeWidth: 1, strokeDasharray: '5 5' }}\r\n                            />\r\n                            <ReferenceLine y={targetCalories} stroke=\"#334155\" strokeDasharray=\"5 5\" label={{ value: 'GOAL', position: 'right', fill: '#475569', fontSize: 9, fontWeight: 900 }} />\r\n                            <Area\r\n                                type=\"monotone\"\r\n                                dataKey=\"calories\"\r\n                                stroke=\"#f97316\"\r\n                                strokeWidth={4}\r\n                                fillOpacity={1}\r\n                                fill=\"url(#colorCal)\"\r\n                                animationDuration={2000}\r\n                            />\r\n                        </AreaChart>\r\n                    </ResponsiveContainer>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Averages (Modern Macro Grid) */}\r\n            <div className=\"space-y-4\">\r\n                <div className=\"flex items-center gap-2 px-1\">\r\n                    <TrendingUp size={16} className=\"text-cyan-500\" />\r\n                    <h3 className=\"font-black text-white uppercase text-[10px] tracking-[0.2em]\">Nutritional Trends</h3>\r\n                </div>\r\n                <div className=\"grid grid-cols-1 gap-4\">\r\n                    <StatRow label=\"Protein\" value={avgProtein} target={targetProtein} unit=\"g\" color=\"bg-emerald-500\" shadow=\"shadow-emerald-500/20\" />\r\n                    <StatRow label=\"Carbs\" value={avgCarbs} target={targetCarbs} unit=\"g\" color=\"bg-cyan-500\" shadow=\"shadow-cyan-500/20\" />\r\n                    <StatRow label=\"Fat\" value={avgFat} target={targetFat} unit=\"g\" color=\"bg-orange-500\" shadow=\"shadow-orange-500/20\" />\r\n                </div>\r\n            </div>\r\n\r\n            {/* Weight Trend Section */}\r\n            {weightHistory.length >= 2 && (\r\n                <div className=\"glass-dark rounded-[2rem] p-6 border-slate-800/50\">\r\n                    <div className=\"flex justify-between items-center mb-10\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"p-2 bg-blue-500/10 rounded-xl\">\r\n                                <Scale size={20} className=\"text-blue-500\" />\r\n                            </div>\r\n                            <h3 className=\"font-black text-white uppercase text-[10px] tracking-[0.15em]\">Weight Trend</h3>\r\n                        </div>\r\n                        <div className=\"text-right\">\r\n                            <div className=\"text-[9px] text-slate-500 font-black uppercase mb-0.5 tracking-tighter\">Current</div>\r\n                            <div className=\"text-2xl font-black text-white\">{user.weight} <span className=\"text-[10px] text-blue-500\">kg</span></div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"h-[220px] w-full\">\r\n                        <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                            <LineChart data={weightData} margin={{ top: 10, right: 10, left: -20, bottom: 0 }}>\r\n                                <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#1e293b\" opacity={0.3} />\r\n                                <XAxis\r\n                                    dataKey=\"date\"\r\n                                    axisLine={false}\r\n                                    tickLine={false}\r\n                                    tick={{ fontSize: 9, fill: '#64748b', fontWeight: 900 }}\r\n                                    dy={10}\r\n                                />\r\n                                <YAxis\r\n                                    hide\r\n                                    domain={['dataMin - 2', 'dataMax + 2']}\r\n                                />\r\n                                <Tooltip\r\n                                    contentStyle={{ backgroundColor: '#0f172a', border: '1px solid #1e293b', borderRadius: '16px', color: '#fff' }}\r\n                                    itemStyle={{ color: '#3b82f6' }}\r\n                                    labelStyle={{ fontSize: '10px', fontWeight: 'bold', color: '#94a3b8', marginBottom: '4px' }}\r\n                                />\r\n                                <Line\r\n                                    type=\"monotone\"\r\n                                    dataKey=\"weight\"\r\n                                    stroke=\"#3b82f6\"\r\n                                    strokeWidth={4}\r\n                                    dot={{ r: 4, fill: '#3b82f6', strokeWidth: 2, stroke: '#0f172a' }}\r\n                                    activeDot={{ r: 6, fill: '#3b82f6', strokeWidth: 0 }}\r\n                                    animationDuration={2000}\r\n                                />\r\n                            </LineChart>\r\n                        </ResponsiveContainer>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Consistency Tracker (Dark Style) */}\r\n            <div className=\"glass border-dashed border-slate-700 dark:border-slate-800 rounded-[2rem] p-6\">\r\n                <div className=\"flex items-center gap-3 mb-6\">\r\n                    <div className=\"p-2 bg-purple-500/10 rounded-xl\">\r\n                        <Target size={20} className=\"text-purple-500\" />\r\n                    </div>\r\n                    <h3 className=\"font-black text-white uppercase text-[10px] tracking-[0.2em]\">Lifestyle Consistency</h3>\r\n                </div>\r\n                <div className=\"flex justify-between gap-2 overflow-hidden\">\r\n                    {Array.from({ length: 4 }).map((_, w) => (\r\n                        <div key={w} className=\"flex-1 space-y-2\">\r\n                            <div className=\"h-16 bg-slate-900/40 rounded-xl p-1.5 flex items-end justify-center gap-1 border border-white/5 shadow-inner\">\r\n                                {Array.from({ length: 7 }).map((_, d) => {\r\n                                    // Calculate date for this cell (4 weeks * 7 days = 28 days back from today)\r\n                                    const daysAgo = (3 - w) * 7 + (6 - d)\r\n                                    const date = new Date(today)\r\n                                    date.setDate(date.getDate() - daysAgo)\r\n                                    const dateStr = format(date, 'yyyy-MM-dd')\r\n                                    const hasActivity = (logs[dateStr]?.entries.length || 0) > 0 || (useAppStore.getState().exerciseLogs[dateStr]?.entries.length || 0) > 0\r\n\r\n                                    return (\r\n                                        <div\r\n                                            key={d}\r\n                                            className={cn(\r\n                                                \"w-full rounded-sm transition-all duration-1000\",\r\n                                                hasActivity ? 'bg-orange-500 h-full opacity-80 shadow-[0_0_10px_rgba(249,115,22,0.3)]' : 'bg-slate-700 h-1/4'\r\n                                            )}\r\n                                        ></div>\r\n                                    )\r\n                                })}\r\n                            </div>\r\n                            <div className=\"text-[8px] text-center text-slate-500 font-black uppercase tracking-tighter\">Week {w + 1}</div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n                {/* Legend */}\r\n                <div className=\"mt-4 flex items-center justify-center gap-4\">\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                        <div className=\"w-2 h-2 rounded-full bg-orange-500 shadow-[0_0_5px_rgba(249,115,22,0.5)]\"></div>\r\n                        <span className=\"text-[9px] font-black text-slate-400 uppercase tracking-widest\">Active</span>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                        <div className=\"w-2 h-2 rounded-full bg-slate-700\"></div>\r\n                        <span className=\"text-[9px] font-black text-slate-400 uppercase tracking-widest\">Inactive</span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Hidden Share Card for Capture */}\r\n            <div style={{ position: 'absolute', left: '-9999px', top: '0', opacity: 0, pointerEvents: 'none' }}>\r\n                <ShareCard\r\n                    ref={shareCardRef}\r\n                    userName={user.name}\r\n                    avgCalories={weeklyAverage}\r\n                    streak={12}\r\n                    goal={user.goal}\r\n                    topMeals={topMeals}\r\n                />\r\n            </div>\r\n\r\n            {/* Share Button (Fixed at bottom above nav) */}\r\n            <div className=\"fixed bottom-24 left-0 right-0 px-6 z-40\">\r\n                <Button\r\n                    variant=\"primary\"\r\n                    fullWidth\r\n                    className=\"h-14 rounded-2xl shadow-2xl bg-gradient-to-r from-orange-500 to-rose-500 font-black uppercase tracking-widest text-xs py-0\"\r\n                    onClick={handleShare}\r\n                    disabled={isSharing}\r\n                >\r\n                    {isSharing ? (\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                            Generating Summary...\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"flex items-center gap-2 justify-center\">\r\n                            <Share2 size={18} />\r\n                            Share My Week\r\n                        </div>\r\n                    )}\r\n                </Button>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\ninterface StatRowProps {\r\n    label: string\r\n    value: number\r\n    target: number\r\n    unit: string\r\n    color: string\r\n}\r\n\r\nfunction StatRow({ label, value, target, unit, color, shadow }: StatRowProps & { shadow: string }) {\r\n    const pct = Math.min(100, (value / target) * 100)\r\n    const diff = Math.round(((value - target) / target) * 100)\r\n    const isOver = diff > 0\r\n\r\n    return (\r\n        <div className=\"glass-dark rounded-[1.5rem] p-5 relative overflow-hidden group border-slate-800/50\">\r\n            <div className=\"flex justify-between items-center mb-4 relative z-10\">\r\n                <div className=\"space-y-1\">\r\n                    <span className=\"text-[9px] font-black text-slate-500 uppercase tracking-[0.15em] block\">{label} Intake</span>\r\n                    <div className=\"flex items-baseline gap-1.5\">\r\n                        <span className=\"text-3xl font-black text-white tabular-nums\">{value}</span>\r\n                        <span className=\"text-[10px] font-bold text-slate-500\">/ {target}{unit}</span>\r\n                    </div>\r\n                </div>\r\n                <div className={cn(\r\n                    \"px-2.5 py-1.5 rounded-lg text-[9px] font-black uppercase tracking-tighter transition-colors\",\r\n                    isOver ? 'bg-orange-500/10 text-orange-400 border border-orange-500/20' : 'bg-emerald-500/10 text-emerald-400 border border-emerald-500/20'\r\n                )}>\r\n                    {isOver ? '+' : ''}{diff}%\r\n                </div>\r\n            </div>\r\n            <div className=\"h-1.5 w-full bg-slate-900/50 rounded-full overflow-hidden relative border border-white/5\">\r\n                <div\r\n                    className={cn(\"h-full transition-all duration-1000 shadow-lg\", color, shadow)}\r\n                    style={{ width: `${pct}%` }}\r\n                />\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\pages\\Workout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\services\\medicine.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[572,575],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[572,575],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1140,1143],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1140,1143],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":127,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4632,4635],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4632,4635],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getApiKey } from \"../lib/ai\";\r\nimport { extractTextFromImage } from \"./ocr\";\r\n\r\nconst GEMINI_API_URL = \"https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent\";\r\n\r\nconst fileToBase64 = (file: File): Promise<string> => {\r\n    return new Promise((resolve, reject) => {\r\n        const reader = new FileReader();\r\n        reader.readAsDataURL(file);\r\n        reader.onload = () => resolve((reader.result as string).split(',')[1]);\r\n        reader.onerror = error => reject(error);\r\n    });\r\n};\r\n\r\nconst apiCache = new Map<string, any[]>();\r\n\r\nexport async function searchMedicine(query: string) {\r\n    if (!query || query.length < 3) return [];\r\n\r\n    // Caching logic\r\n    if (apiCache.has(query)) {\r\n        return apiCache.get(query)!;\r\n    }\r\n\r\n    try {\r\n        // Targeted FDA API query as requested\r\n        const response = await fetch(`https://api.fda.gov/drug/label.json?search=openfda.brand_name:\"${query}\"&limit=10`);\r\n\r\n        if (!response.ok) {\r\n            return [];\r\n        }\r\n\r\n        const data = await response.json();\r\n        const results = (data.results || []).map((r: any) => ({\r\n            name: r.openfda?.brand_name?.[0] || r.openfda?.generic_name?.[0] || \"Unknown Medicine\",\r\n            purpose: r.purpose?.[0] || \"General medication\",\r\n            usage: r.dosage_and_administration?.[0] || \"\"\r\n        }));\r\n\r\n        apiCache.set(query, results);\r\n        return results;\r\n    } catch (e) {\r\n        console.error(\"Medicine search failed:\", e);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport interface ScannedMedicine {\r\n    name: string;\r\n    notes?: string;\r\n    time: string; // HH:mm format\r\n}\r\n\r\n/**\r\n * Combined function to scan an image and search for matching food/medicine.\r\n */\r\nexport async function scanAndSearchFood(file: File) {\r\n    try {\r\n        const scannedText = await extractTextFromImage(file);\r\n\r\n        // Split text into words and filter for potential brand names (at least 3 chars)\r\n        const queries = scannedText\r\n            .split(/\\W+/)\r\n            .filter(word => word.length >= 3)\r\n            .slice(0, 5); // Limit queries for performance\r\n\r\n        const allResults = await Promise.all(\r\n            queries.map(q => searchMedicine(q))\r\n        );\r\n\r\n        // Flatten and deduplicate results by name\r\n        const medicineResults = Array.from(\r\n            new Map(allResults.flat().map(item => [item.name, item])).values()\r\n        );\r\n\r\n        return {\r\n            scannedText,\r\n            medicineResults\r\n        };\r\n    } catch (error) {\r\n        console.error(\"Scan and search failed:\", error);\r\n        throw error;\r\n    }\r\n}\r\n\r\nexport async function analyzeMedicineImage(file: File): Promise<ScannedMedicine[]> {\r\n    const apiKey = getApiKey();\r\n\r\n    if (!apiKey) throw new Error(\"No API key found. Please configure it in your Profile.\");\r\n\r\n    const base64Image = await fileToBase64(file);\r\n    const response = await fetch(`${GEMINI_API_URL}?key=${apiKey}`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n            contents: [{\r\n                parts: [\r\n                    {\r\n                        text: `ACT AS A PHARMACIST. \r\n                               TASK: Identify ALL medications in the provided prescription or medicine list image.\r\n                               EXTRACT: \r\n                               1. name: Brand or generic name.\r\n                               2. notes: Brief dosage/instruction (e.g., '1 tab after food').\r\n                               3. time: Suggest a logical daily time in 24h format (e.g., '09:00', '14:00', '21:00') based on common practices (morning/afternoon/night) or explicit instructions.\r\n                               \r\n                               Return ONLY a JSON array:\r\n                               [\r\n                                 {\r\n                                   \"name\": \"string\",\r\n                                   \"notes\": \"string\",\r\n                                   \"time\": \"HH:mm\"\r\n                                 }\r\n                               ]`\r\n                    },\r\n                    {\r\n                        inline_data: { mime_type: file.type, data: base64Image }\r\n                    }\r\n                ]\r\n            }]\r\n        })\r\n    });\r\n\r\n    if (!response.ok) throw new Error(\"AI analysis failed\");\r\n    const result = await response.json();\r\n    const content = result.candidates[0].content.parts[0].text;\r\n    const data = JSON.parse(content.replace(/```json|```/g, \"\").trim());\r\n    return (data || []).map((m: any) => ({\r\n        name: m.name || \"Unknown Medicine\",\r\n        notes: m.notes || \"\",\r\n        time: m.time || \"09:00\"\r\n    }));\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\services\\ocr.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\services\\social.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1768,1771],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1768,1771],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1858,1861],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1858,1861],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":186,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5467,5470],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5467,5470],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":189,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5557,5560],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5557,5560],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport {\r\n    collection,\r\n    addDoc,\r\n    getDocs,\r\n    query,\r\n    orderBy,\r\n    limit,\r\n    setDoc,\r\n    doc,\r\n    deleteDoc,\r\n    getDoc,\r\n    updateDoc,\r\n    arrayUnion,\r\n    arrayRemove,\r\n    increment\r\n} from \"firebase/firestore\";\r\n\r\nimport { db } from \"../lib/firebase\";\r\n\r\nexport interface Post {\r\n    id: string;\r\n    authorId: string;\r\n    authorName: string;\r\n    authorPhoto?: string;\r\n    timestamp: number; // or Firestore Timestamp\r\n    title: string;\r\n    description: string;\r\n    image?: string;\r\n    calories: number;\r\n    healthScore?: number; // v2.2\r\n    reasoning?: string;   // v2.2\r\n    macros: {\r\n        protein: number;\r\n        carbs: number;\r\n        fat: number;\r\n    };\r\n    ingredients: string[];\r\n    likes: number;\r\n    likedBy: string[]; // Array of user IDs/emails who liked the post\r\n}\r\n\r\n\r\nexport interface RecipeBookItem {\r\n    id: string; // The ID in the user's recipeBook subcollection\r\n    originalPostId?: string; // If saved from a post\r\n    name: string;\r\n    calories: number;\r\n    protein: number;\r\n    carbs: number;\r\n    fat: number;\r\n    ingredients?: string[]; // Added for shopping list\r\n    healthScore?: number; // v2.2\r\n    reasoning?: string;   // v2.2\r\n    source: \"community\" | \"manual\";\r\n    addedAt: number;\r\n}\r\n\r\n// Collection References\r\nconst POSTS_COLLECTION = \"posts\";\r\nconst USERS_COLLECTION = \"users\";\r\n\r\n// --- Posts / Feed ---\r\n\r\nexport async function createPost(postData: Omit<Post, 'id' | 'timestamp' | 'likes' | 'likedBy'>) {\r\n    try {\r\n        const postsRef = collection(db, \"posts\")\r\n\r\n        // Sanitize data to remove undefined values\r\n        const safeData = Object.entries(postData).reduce((acc, [key, value]) => {\r\n            if (value !== undefined) {\r\n                (acc as any)[key] = value\r\n            }\r\n            return acc\r\n        }, {} as Record<string, any>)\r\n\r\n        const docRef = await addDoc(postsRef, {\r\n            ...safeData,\r\n            timestamp: Date.now(),\r\n            likes: 0,\r\n            likedBy: []\r\n        })\r\n        return docRef.id\r\n    } catch (error) {\r\n        console.error(\"Error creating post:\", error)\r\n        throw error\r\n    }\r\n}\r\n\r\nexport const fetchFeed = async (limitCount = 20) => {\r\n    try {\r\n        const q = query(\r\n            collection(db, POSTS_COLLECTION),\r\n            orderBy(\"timestamp\", \"desc\"),\r\n            limit(limitCount)\r\n        );\r\n        const querySnapshot = await getDocs(q);\r\n        return querySnapshot.docs.map(doc => ({\r\n            id: doc.id,\r\n            ...doc.data()\r\n        })) as Post[];\r\n    } catch (error) {\r\n        console.error(\"Error fetching feed:\", error);\r\n        throw error;\r\n    }\r\n};\r\n\r\n// --- Recipe Book ---\r\n\r\nexport const addToRecipeBook = async (userId: string, item: Omit<RecipeBookItem, \"id\" | \"addedAt\">) => {\r\n    try {\r\n        // Use originalPostId as doc ID if available to prevent duplicates, otherwise auto-gen\r\n        const docId = item.originalPostId || doc(collection(db, USERS_COLLECTION, userId, \"recipeBook\")).id;\r\n\r\n        await setDoc(doc(db, USERS_COLLECTION, userId, \"recipeBook\", docId), {\r\n            ...item,\r\n            id: docId,\r\n            addedAt: Date.now()\r\n        });\r\n        return docId;\r\n    } catch (error) {\r\n        console.error(\"Error adding to recipe book:\", error);\r\n        throw error;\r\n    }\r\n};\r\n\r\nexport const getRecipeBook = async (userId: string) => {\r\n    try {\r\n        const q = query(collection(db, USERS_COLLECTION, userId, \"recipeBook\"), orderBy(\"addedAt\", \"desc\"));\r\n        const querySnapshot = await getDocs(q);\r\n        return querySnapshot.docs.map(doc => doc.data() as RecipeBookItem);\r\n    } catch (error) {\r\n        console.error(\"Error fetching recipe book:\", error);\r\n        throw error;\r\n    }\r\n};\r\n\r\nexport const removeFromRecipeBook = async (userId: string, recipeId: string) => {\r\n    try {\r\n        await deleteDoc(doc(db, USERS_COLLECTION, userId, \"recipeBook\", recipeId));\r\n    } catch (error) {\r\n        console.error(\"Error removing from recipe book:\", error);\r\n        throw error;\r\n    }\r\n};\r\n\r\nexport const isRecipeSaved = async (userId: string, originalPostId: string): Promise<boolean> => {\r\n    try {\r\n        const docRef = doc(db, USERS_COLLECTION, userId, \"recipeBook\", originalPostId);\r\n        const docSnap = await getDoc(docRef);\r\n        return docSnap.exists();\r\n    } catch (error) {\r\n        console.error(\"Error checking saved status:\", error);\r\n        return false;\r\n    }\r\n};\r\n\r\nexport const toggleLikePost = async (postId: string, userId: string, isLiked: boolean) => {\r\n    try {\r\n        const postRef = doc(db, POSTS_COLLECTION, postId);\r\n        await updateDoc(postRef, {\r\n            likes: increment(isLiked ? -1 : 1),\r\n            likedBy: isLiked ? arrayRemove(userId) : arrayUnion(userId)\r\n        });\r\n    } catch (error) {\r\n        console.error(\"Error toggling like:\", error);\r\n        throw error;\r\n    }\r\n};\r\n\r\nexport async function deletePost(postId: string) {\r\n    try {\r\n        const postRef = doc(db, \"posts\", postId)\r\n        await deleteDoc(postRef)\r\n    } catch (error) {\r\n        console.error(\"Error deleting post:\", error)\r\n        throw error\r\n    }\r\n}\r\n\r\nexport async function updatePost(postId: string, data: Partial<Post>) {\r\n    try {\r\n        const postRef = doc(db, \"posts\", postId)\r\n        const safeData = Object.entries(data).reduce((acc, [key, value]) => {\r\n            if (value !== undefined) {\r\n                (acc as any)[key] = value\r\n            }\r\n            return acc\r\n        }, {} as Record<string, any>)\r\n\r\n        await updateDoc(postRef, safeData)\r\n    } catch (error) {\r\n        console.error(\"Error updating post:\", error)\r\n        throw error\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\src\\store\\useAppStore.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'newStreaks' is never reassigned. Use 'const' instead.","line":225,"column":21,"nodeType":"Identifier","messageId":"useConst","endLine":225,"endColumn":31,"fix":{"range":[7542,7579],"text":"const newStreaks = { ...state.streaks }"}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":509,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":509,"endColumn":31}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { create } from 'zustand'\r\nimport { persist, createJSONStorage } from 'zustand/middleware'\r\nimport { auth, db } from '../lib/firebase'\r\nimport { onAuthStateChanged, signOut } from 'firebase/auth'\r\nimport { doc, setDoc, getDoc, collection, getDocs, deleteDoc, addDoc } from 'firebase/firestore'\r\nimport { type RecipeBookItem, addToRecipeBook as firestoreAddRecipe, getRecipeBook as firestoreGetRecipes, removeFromRecipeBook as firestoreRemoveRecipe } from '../services/social'\r\n\r\n\r\n\r\nexport type Gender = 'male' | 'female' | 'other'\r\nexport type ActivityLevel = 'sedentary' | 'light' | 'moderate' | 'active' | 'athlete'\r\nexport type Goal = 'lose' | 'maintain' | 'gain'\r\n\r\nexport interface UserProfile {\r\n    isAuthenticated: boolean\r\n    uid?: string\r\n    name: string\r\n    email: string // Added email\r\n    phoneNumber?: string // Added phone number for WhatsApp reminders\r\n    height: number // cm\r\n    weight: number // kg\r\n    age: number\r\n    gender: Gender\r\n    activityLevel: ActivityLevel\r\n    goal: Goal\r\n    onboardingCompleted: boolean\r\n    photoURL?: string\r\n    waterGoal: number // ml\r\n}\r\n\r\nexport interface MealEntry {\r\n    id: string\r\n    mealType: 'breakfast' | 'lunch' | 'dinner' | 'snack'\r\n    name: string\r\n    calories: number\r\n    protein: number\r\n    carbs: number\r\n    fat: number\r\n    ingredients?: string[] // Added for shopping list\r\n    healthScore?: number   // v2.2\r\n    reasoning?: string     // v2.2\r\n    timestamp: number\r\n}\r\n\r\nexport interface DayLog {\r\n    date: string // YYYY-MM-DD\r\n    entries: MealEntry[]\r\n    waterIntake: number // ml\r\n}\r\n\r\nexport interface DayPlan {\r\n    date: string\r\n    entries: MealEntry[]\r\n    totalCalories: number\r\n}\r\n\r\nexport type ExerciseType = 'walk' | 'run' | 'bike' | 'strength' | 'yoga' | 'other'\r\n\r\nexport interface ExerciseEntry {\r\n    id: string\r\n    name: string\r\n    type: ExerciseType\r\n    durationMinutes: number\r\n    intensity: 'low' | 'moderate' | 'high'\r\n    calories?: number\r\n    timestamp: number\r\n}\r\n\r\nexport interface DayExerciseLog {\r\n    date: string\r\n    entries: ExerciseEntry[]\r\n}\r\n\r\nexport interface Reminder {\r\n    id: string\r\n    medicineName: string\r\n    time: string\r\n    notes: string\r\n    enabled: boolean\r\n    phoneNumber?: string\r\n    createdAt: number\r\n}\r\n\r\nexport interface WeightEntry {\r\n    date: string\r\n    weight: number\r\n    timestamp: number\r\n}\r\n\r\n\r\n\r\n\r\ninterface AppState {\r\n    user: UserProfile\r\n    logs: Record<string, DayLog> // key is YYYY-MM-DD\r\n    plans: Record<string, DayPlan>\r\n    exerciseLogs: Record<string, DayExerciseLog>\r\n    recipeBook: RecipeBookItem[]\r\n    reminders: Reminder[]\r\n    medicineMode: boolean\r\n    weightHistory: WeightEntry[]\r\n\r\n\r\n\r\n    streaks: {\r\n        current: number\r\n        longest: number\r\n        lastLoggedDate?: string\r\n    }\r\n\r\n    apiKey: string | null // Personal key\r\n    sharedApiKey: string | null // Global shared key from owner\r\n    theme: 'light' | 'dark' | 'system'\r\n    lastSyncedAt: string | null // ISO string of last successful cloud sync\r\n\r\n    // Actions\r\n    login: () => void\r\n    logout: () => Promise<void>\r\n    setUser: (profile: Partial<UserProfile>) => Promise<void>\r\n    setTheme: (theme: 'light' | 'dark' | 'system') => void\r\n    toggleMedicineMode: () => void\r\n    setApiKey: (key: string | null) => void // New action for API key\r\n    addEntry: (date: string, entry: Omit<MealEntry, 'id' | 'timestamp'>) => Promise<void>\r\n    updateEntry: (date: string, updatedEntry: MealEntry) => Promise<void>\r\n    removeEntry: (date: string, entryId: string) => Promise<void>\r\n    addPlanEntry: (date: string, entry: Omit<MealEntry, 'id' | 'timestamp'>) => Promise<void>\r\n    updatePlanEntry: (date: string, updatedEntry: MealEntry) => Promise<void>\r\n    removePlanEntry: (date: string, entryId: string) => Promise<void>\r\n    addExerciseEntry: (date: string, entry: Omit<ExerciseEntry, 'id' | 'timestamp'>) => Promise<void>\r\n    removeExerciseEntry: (date: string, entryId: string) => Promise<void>\r\n    syncWithFirestore: () => Promise<void>\r\n    loadRecipeBook: () => Promise<void>\r\n    addToRecipeBook: (item: Omit<RecipeBookItem, 'id' | 'addedAt'>) => Promise<void>\r\n    removeFromRecipeBook: (id: string) => Promise<void>\r\n    addReminder: (reminder: Omit<Reminder, 'id' | 'createdAt'>) => Promise<void>\r\n    removeReminder: (id: string) => Promise<void>\r\n    clearAllReminders: () => Promise<void>\r\n    updateWaterIntake: (date: string, amount: number) => Promise<void>\r\n    logWeight: (weight: number) => Promise<void>\r\n}\r\n\r\n\r\nexport const useAppStore = create<AppState>()(\r\n    persist(\r\n        (set) => ({\r\n            user: {\r\n                isAuthenticated: false,\r\n                name: 'Guest',\r\n                email: '', // Initial email\r\n                phoneNumber: '', // Initial phone number\r\n                height: 170,\r\n                weight: 70,\r\n                age: 30,\r\n                gender: 'male',\r\n                activityLevel: 'moderate',\r\n                goal: 'maintain',\r\n                onboardingCompleted: false,\r\n                waterGoal: 2000\r\n            },\r\n            logs: {},\r\n            plans: {},\r\n            exerciseLogs: {},\r\n            recipeBook: [],\r\n            reminders: [],\r\n            medicineMode: false,\r\n            weightHistory: [],\r\n\r\n            streaks: {\r\n                current: 0,\r\n                longest: 0\r\n            },\r\n\r\n            apiKey: null,\r\n            sharedApiKey: null,\r\n            theme: 'system',\r\n            lastSyncedAt: null,\r\n\r\n            login: () => set((state) => ({ user: { ...state.user, isAuthenticated: true } })),\r\n            logout: async () => {\r\n                await signOut(auth);\r\n                set((state) => ({ user: { ...state.user, isAuthenticated: false, email: '', uid: undefined } }));\r\n            },\r\n            setUser: async (profile) => {\r\n                set((state) => ({ user: { ...state.user, ...profile } }))\r\n                const latestState = useAppStore.getState()\r\n                if (latestState.user.isAuthenticated && latestState.user.uid) {\r\n                    try {\r\n                        await setDoc(doc(db, 'users', latestState.user.uid!), latestState.user, { merge: true })\r\n                    } catch (e) {\r\n                        console.error(\"Firestore profile sync error:\", e)\r\n                    }\r\n                }\r\n            },\r\n\r\n            setApiKey: (key) => set({ apiKey: key }),\r\n            setTheme: (theme) => set({ theme }),\r\n            toggleMedicineMode: () => set((state) => ({ medicineMode: !state.medicineMode })),\r\n\r\n            addEntry: async (date, entry) => {\r\n                const newEntry: MealEntry = {\r\n                    ...entry,\r\n                    id: crypto.randomUUID(),\r\n                    timestamp: Date.now()\r\n                }\r\n\r\n                const state = useAppStore.getState()\r\n                const existingLog = state.logs[date] || { date, entries: [], waterIntake: 0 }\r\n                const updatedLog = {\r\n                    ...existingLog,\r\n                    entries: [...existingLog.entries, newEntry]\r\n                }\r\n\r\n                set({\r\n                    logs: {\r\n                        ...state.logs,\r\n                        [date]: updatedLog\r\n                    }\r\n                })\r\n\r\n                // Streak Logic\r\n                const yesterday = new Date()\r\n                yesterday.setDate(yesterday.getDate() - 1)\r\n                const yesterdayStr = yesterday.toISOString().split('T')[0]\r\n\r\n                let newStreaks = { ...state.streaks }\r\n                if (state.streaks.lastLoggedDate !== date) {\r\n                    if (state.streaks.lastLoggedDate === yesterdayStr) {\r\n                        newStreaks.current += 1\r\n                    } else if (!state.streaks.lastLoggedDate || state.streaks.lastLoggedDate < yesterdayStr) {\r\n                        newStreaks.current = 1\r\n                    }\r\n                    newStreaks.longest = Math.max(newStreaks.longest, newStreaks.current)\r\n                    newStreaks.lastLoggedDate = date\r\n                    set({ streaks: newStreaks })\r\n\r\n                    // Sync streaks to user profile in firestore\r\n                    if (state.user.isAuthenticated && state.user.uid) {\r\n                        await setDoc(doc(db, 'users', state.user.uid!), { streaks: newStreaks }, { merge: true })\r\n                    }\r\n                }\r\n\r\n                // Firestore Sync\r\n                if (state.user.isAuthenticated && state.user.uid) {\r\n                    try {\r\n                        await setDoc(doc(db, 'users', state.user.uid!, 'logs', date), updatedLog)\r\n                    } catch (e) {\r\n                        console.error(\"Firestore sync error:\", e)\r\n                    }\r\n                }\r\n            },\r\n\r\n            updateEntry: async (date, updatedEntry) => {\r\n                const state = useAppStore.getState()\r\n                const log = state.logs[date]\r\n                if (!log) return\r\n\r\n                const updatedLog = {\r\n                    ...log,\r\n                    entries: log.entries.map(e => e.id === updatedEntry.id ? { ...e, ...updatedEntry } : e)\r\n                }\r\n\r\n                set({\r\n                    logs: {\r\n                        ...state.logs,\r\n                        [date]: updatedLog\r\n                    }\r\n                })\r\n\r\n                // Firestore Sync\r\n                if (state.user.isAuthenticated && state.user.uid) {\r\n                    try {\r\n                        await setDoc(doc(db, 'users', state.user.uid!, 'logs', date), updatedLog)\r\n                    } catch (e) {\r\n                        console.error(\"Firestore sync error:\", e)\r\n                    }\r\n                }\r\n            },\r\n\r\n            removeEntry: async (date, entryId) => {\r\n                const state = useAppStore.getState()\r\n                const log = state.logs[date]\r\n                if (!log) return\r\n\r\n                const updatedLog = {\r\n                    ...log,\r\n                    entries: log.entries.filter(e => e.id !== entryId)\r\n                }\r\n\r\n                set({\r\n                    logs: {\r\n                        ...state.logs,\r\n                        [date]: updatedLog\r\n                    }\r\n                })\r\n\r\n                // Firestore Sync\r\n                if (state.user.isAuthenticated && state.user.uid) {\r\n                    try {\r\n                        await setDoc(doc(db, 'users', state.user.uid!, 'logs', date), updatedLog)\r\n                    } catch (e) {\r\n                        console.error(\"Firestore sync error:\", e)\r\n                    }\r\n                }\r\n            },\r\n\r\n            addPlanEntry: async (date, entry) => {\r\n                const newEntry: MealEntry = {\r\n                    ...entry,\r\n                    id: crypto.randomUUID(),\r\n                    timestamp: Date.now()\r\n                }\r\n\r\n                const state = useAppStore.getState()\r\n                const existingPlan = state.plans[date] || { date, entries: [], totalCalories: 0 }\r\n                const updatedPlan = {\r\n                    ...existingPlan,\r\n                    entries: [...existingPlan.entries, newEntry]\r\n                }\r\n\r\n                set({\r\n                    plans: {\r\n                        ...state.plans,\r\n                        [date]: updatedPlan\r\n                    }\r\n                })\r\n\r\n                if (state.user.isAuthenticated && state.user.uid) {\r\n                    try {\r\n                        await setDoc(doc(db, 'users', state.user.uid!, 'plans', date), updatedPlan)\r\n                    } catch (e) {\r\n                        console.error(\"Firestore sync error:\", e)\r\n                    }\r\n                }\r\n            },\r\n\r\n            updatePlanEntry: async (date, updatedEntry) => {\r\n                const state = useAppStore.getState()\r\n                const plan = state.plans[date]\r\n                if (!plan) return\r\n\r\n                const updatedPlan = {\r\n                    ...plan,\r\n                    entries: plan.entries.map(e => e.id === updatedEntry.id ? updatedEntry : e)\r\n                }\r\n\r\n                set({\r\n                    plans: {\r\n                        ...state.plans,\r\n                        [date]: updatedPlan\r\n                    }\r\n                })\r\n\r\n                if (state.user.isAuthenticated && state.user.uid) {\r\n                    try {\r\n                        await setDoc(doc(db, 'users', state.user.uid!, 'plans', date), updatedPlan)\r\n                    } catch (e) {\r\n                        console.error(\"Firestore sync error:\", e)\r\n                    }\r\n                }\r\n            },\r\n\r\n            removePlanEntry: async (date, entryId) => {\r\n                const state = useAppStore.getState()\r\n                const plan = state.plans[date]\r\n                if (!plan) return\r\n\r\n                const updatedPlan = {\r\n                    ...plan,\r\n                    entries: plan.entries.filter(e => e.id !== entryId)\r\n                }\r\n\r\n                set({\r\n                    plans: {\r\n                        ...state.plans,\r\n                        [date]: updatedPlan\r\n                    }\r\n                })\r\n\r\n                if (state.user.isAuthenticated && state.user.uid) {\r\n                    try {\r\n                        await setDoc(doc(db, 'users', state.user.uid!, 'plans', date), updatedPlan)\r\n                    } catch (e) {\r\n                        console.error(\"Firestore sync error:\", e)\r\n                    }\r\n                }\r\n            },\r\n\r\n            addExerciseEntry: async (date, entry) => {\r\n                const newEntry: ExerciseEntry = {\r\n                    ...entry,\r\n                    id: crypto.randomUUID(),\r\n                    timestamp: Date.now()\r\n                }\r\n\r\n                const state = useAppStore.getState()\r\n                const existingLog = state.exerciseLogs[date] || { date, entries: [] }\r\n                const updatedLog: DayExerciseLog = {\r\n                    ...existingLog,\r\n                    entries: [...existingLog.entries, newEntry]\r\n                }\r\n\r\n                set({\r\n                    exerciseLogs: {\r\n                        ...state.exerciseLogs,\r\n                        [date]: updatedLog\r\n                    }\r\n                })\r\n\r\n                if (state.user.isAuthenticated && state.user.uid) {\r\n                    try {\r\n                        await setDoc(doc(db, 'users', state.user.uid!, 'exercises', date), updatedLog)\r\n                    } catch (e) {\r\n                        console.error(\"Firestore exercise sync error:\", e)\r\n                    }\r\n                }\r\n            },\r\n\r\n            removeExerciseEntry: async (date, entryId) => {\r\n                const state = useAppStore.getState()\r\n                const log = state.exerciseLogs[date]\r\n                if (!log) return\r\n\r\n                const updatedLog: DayExerciseLog = {\r\n                    ...log,\r\n                    entries: log.entries.filter(e => e.id !== entryId)\r\n                }\r\n\r\n                set({\r\n                    exerciseLogs: {\r\n                        ...state.exerciseLogs,\r\n                        [date]: updatedLog\r\n                    }\r\n                })\r\n\r\n                if (state.user.isAuthenticated && state.user.uid) {\r\n                    try {\r\n                        await setDoc(doc(db, 'users', state.user.uid!, 'exercises', date), updatedLog)\r\n                    } catch (e) {\r\n                        console.error(\"Firestore exercise sync error:\", e)\r\n                    }\r\n                }\r\n            },\r\n\r\n            syncWithFirestore: async () => {\r\n                const state = useAppStore.getState()\r\n                if (!state.user.isAuthenticated || !state.user.uid) return\r\n\r\n                try {\r\n                    // 1. Fetch Profile\r\n                    const userDoc = await getDoc(doc(db, 'users', state.user.uid!))\r\n                    if (userDoc.exists()) {\r\n                        set({ user: { ...state.user, ...userDoc.data() } as UserProfile })\r\n                    }\r\n\r\n                    // 2. Fetch Logs\r\n                    const logsColl = collection(db, 'users', state.user.uid!, 'logs')\r\n                    const logsSnap = await getDocs(logsColl)\r\n                    const fetchedLogs: Record<string, DayLog> = {}\r\n                    logsSnap.forEach(doc => {\r\n                        fetchedLogs[doc.id] = doc.data() as DayLog\r\n                    })\r\n\r\n                    // 3. Fetch Plans\r\n                    const plansColl = collection(db, 'users', state.user.uid!, 'plans')\r\n                    const plansSnap = await getDocs(plansColl)\r\n                    const fetchedPlans: Record<string, DayPlan> = {}\r\n                    plansSnap.forEach(planDoc => {\r\n                        fetchedPlans[planDoc.id] = planDoc.data() as DayPlan\r\n                    })\r\n\r\n                    // 4. Fetch Exercises\r\n                    const exercisesColl = collection(db, 'users', state.user.uid!, 'exercises')\r\n                    const exercisesSnap = await getDocs(exercisesColl)\r\n                    const fetchedExercises: Record<string, DayExerciseLog> = {}\r\n                    exercisesSnap.forEach(exerciseDoc => {\r\n                        fetchedExercises[exerciseDoc.id] = exerciseDoc.data() as DayExerciseLog\r\n                    })\r\n\r\n                    // 5. Fetch Reminders\r\n                    const remindersColl = collection(db, 'users', state.user.uid!, 'reminders')\r\n                    const remindersSnap = await getDocs(remindersColl)\r\n                    const fetchedReminders: Reminder[] = []\r\n                    remindersSnap.forEach(reminderDoc => {\r\n                        fetchedReminders.push({ ...reminderDoc.data(), id: reminderDoc.id } as Reminder)\r\n                    })\r\n\r\n                    set({\r\n                        logs: { ...state.logs, ...fetchedLogs },\r\n                        plans: { ...state.plans, ...fetchedPlans },\r\n                        exerciseLogs: { ...state.exerciseLogs, ...fetchedExercises },\r\n                        reminders: fetchedReminders,\r\n                        lastSyncedAt: new Date().toISOString()\r\n                    })\r\n\r\n                    // 6. Fetch Weight History\r\n                    const weightColl = collection(db, 'users', state.user.uid!, 'weightHistory')\r\n                    const weightSnap = await getDocs(weightColl)\r\n                    const fetchedWeight: WeightEntry[] = []\r\n                    weightSnap.forEach(doc => {\r\n                        fetchedWeight.push({ ...doc.data(), date: doc.id } as WeightEntry)\r\n                    })\r\n                    // Sort by timestamp\r\n                    fetchedWeight.sort((a, b) => a.timestamp - b.timestamp)\r\n                    set({ weightHistory: fetchedWeight })\r\n\r\n                    // 7. Fetch Global Shared API Key (Placeholder - functionality removed to prevent console warnings)\r\n                    try {\r\n                        // Shared API key fetching logic removed as per Task 1.4\r\n                    } catch (e) {\r\n                        // Silent fail for shared key\r\n                    }\r\n                } catch (e) {\r\n                    console.error(\"Firestore hydration error:\", e)\r\n                }\r\n            },\r\n\r\n            loadRecipeBook: async () => {\r\n                const state = useAppStore.getState()\r\n                if (!state.user.isAuthenticated || !state.user.uid) return\r\n                try {\r\n                    // Start fetching\r\n                    const recipes = await firestoreGetRecipes(state.user.uid!)\r\n                    set({ recipeBook: recipes })\r\n                } catch (error) {\r\n                    console.error(\"Failed to load recipe book\", error)\r\n                }\r\n            },\r\n\r\n            addToRecipeBook: async (item) => {\r\n                const state = useAppStore.getState()\r\n                if (!state.user.isAuthenticated || !state.user.uid) {\r\n                    // Local only fall back? or force auth\r\n                    return\r\n                }\r\n\r\n                try {\r\n                    // Optimistic update?\r\n                    // For now, wait for server\r\n                    const id = await firestoreAddRecipe(state.user.uid!, item)\r\n                    const newItem: RecipeBookItem = { ...item, id: id, addedAt: Date.now() }\r\n\r\n                    set(state => ({\r\n                        recipeBook: [newItem, ...state.recipeBook]\r\n                    }))\r\n                } catch (error) {\r\n                    console.error(\"Failed to add to recipe book\", error)\r\n                    throw error\r\n                }\r\n            },\r\n\r\n            removeFromRecipeBook: async (id) => {\r\n                const state = useAppStore.getState()\r\n                if (!state.user.isAuthenticated || !state.user.uid) return\r\n\r\n                try {\r\n                    await firestoreRemoveRecipe(state.user.uid!, id)\r\n                    set(state => ({\r\n                        recipeBook: state.recipeBook.filter(i => i.id !== id)\r\n                    }))\r\n                } catch (error) {\r\n                    console.error(\"Failed to remove from recipe book\", error)\r\n                    throw error\r\n                }\r\n            },\r\n\r\n\r\n\r\n\r\n            addReminder: async (reminderData) => {\r\n                const state = useAppStore.getState()\r\n                if (!state.user.isAuthenticated || !state.user.uid) return\r\n\r\n                const newReminder: Reminder = {\r\n                    ...reminderData,\r\n                    id: crypto.randomUUID(),\r\n                    createdAt: Date.now()\r\n                }\r\n\r\n                set(state => ({ reminders: [...state.reminders, newReminder] }))\r\n\r\n                try {\r\n                    const docRef = await addDoc(collection(db, 'users', state.user.uid!, 'reminders'), {\r\n                        ...newReminder\r\n                    })\r\n                    set(state => ({\r\n                        reminders: state.reminders.map(r => r.id === newReminder.id ? { ...r, id: docRef.id } : r)\r\n                    }))\r\n                } catch (e) {\r\n                    console.error(\"Failed to add reminder\", e)\r\n                }\r\n            },\r\n\r\n            removeReminder: async (id) => {\r\n                const state = useAppStore.getState()\r\n                if (!state.user.isAuthenticated || !state.user.uid) return\r\n\r\n                set(state => ({ reminders: state.reminders.filter(r => r.id !== id) }))\r\n\r\n                try {\r\n                    await deleteDoc(doc(db, 'users', state.user.uid!, 'reminders', id))\r\n                } catch (e) {\r\n                    console.error(\"Failed to remove reminder\", e)\r\n                }\r\n            },\r\n\r\n            clearAllReminders: async () => {\r\n                const state = useAppStore.getState()\r\n                if (!state.user.isAuthenticated || !state.user.uid) return\r\n\r\n                const ids = state.reminders.map(r => r.id)\r\n                set({ reminders: [] })\r\n                try {\r\n                    await Promise.all(ids.map(id => deleteDoc(doc(db, 'users', state.user.uid!, 'reminders', id))))\r\n                } catch (e) {\r\n                    console.error(\"Failed to clear reminders\", e)\r\n                }\r\n            },\r\n\r\n            updateWaterIntake: async (date, amount) => {\r\n                const state = useAppStore.getState()\r\n                const existingLog = state.logs[date] || { date, entries: [], waterIntake: 0 }\r\n                const updatedLog = {\r\n                    ...existingLog,\r\n                    waterIntake: amount\r\n                }\r\n\r\n                set({\r\n                    logs: {\r\n                        ...state.logs,\r\n                        [date]: updatedLog\r\n                    }\r\n                })\r\n\r\n                if (state.user.isAuthenticated && state.user.uid) {\r\n                    try {\r\n                        await setDoc(doc(db, 'users', state.user.uid!, 'logs', date), updatedLog)\r\n                    } catch (e) {\r\n                        console.error(\"Firestore water sync error:\", e)\r\n                    }\r\n                }\r\n            },\r\n\r\n            logWeight: async (weight) => {\r\n                const date = new Date().toISOString().split('T')[0]\r\n                const timestamp = Date.now()\r\n                const newEntry: WeightEntry = { date, weight, timestamp }\r\n\r\n                const state = useAppStore.getState()\r\n                set(state => {\r\n                    const filtered = state.weightHistory.filter(w => w.date !== date)\r\n                    const updatedHistory = [...filtered, newEntry].sort((a, b) => a.timestamp - b.timestamp)\r\n\r\n                    return {\r\n                        weightHistory: updatedHistory,\r\n                        user: { ...state.user, weight }\r\n                    }\r\n                })\r\n\r\n                if (state.user.isAuthenticated && state.user.uid) {\r\n                    try {\r\n                        // Update history\r\n                        await setDoc(doc(db, 'users', state.user.uid!, 'weightHistory', date), newEntry)\r\n                        // Update user profile weight\r\n                        await setDoc(doc(db, 'users', state.user.uid!), { weight }, { merge: true })\r\n                    } catch (e) {\r\n                        console.error(\"Failed to log weight to Firestore\", e)\r\n                    }\r\n                }\r\n            },\r\n        }),\r\n        {\r\n            name: 'nutri-track-storage-v2',\r\n\r\n            storage: createJSONStorage(() => localStorage),\r\n        }\r\n    )\r\n)\r\n\r\n// Initialize Firebase Auth listener\r\nonAuthStateChanged(auth, async (firebaseUser) => {\r\n    if (firebaseUser) {\r\n        await useAppStore.getState().setUser({\r\n            isAuthenticated: true,\r\n            uid: firebaseUser.uid,\r\n            email: firebaseUser.email || '',\r\n            name: firebaseUser.displayName || 'User'\r\n        })\r\n        // Trigger Cloud Sync\r\n        await useAppStore.getState().syncWithFirestore()\r\n        await useAppStore.getState().loadRecipeBook()\r\n\r\n    } else {\r\n        useAppStore.getState().setUser({\r\n            isAuthenticated: false,\r\n            email: '',\r\n            name: 'Guest'\r\n        })\r\n    }\r\n})\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\tailwind.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\NOYEL\\pwa_food\\pwa_food\\pwa\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]